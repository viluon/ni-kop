<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Ondřej Kvapil" />
  <title>NI-KOP – úkol 5</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- Bootstrap 4.5.0 stylesheet -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="css/mods.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<!-- <script data-main="scripts/main" src="js/require.js"></script> -->
  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
<!--  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script> -->


</head>
<body class="d-flex flex-column">

<nav id="TOC" class="navbar navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a href="#" class="ml-5 mr-auto navbar-brand">NI-KOP – úkol 5<br><span style="font-size: smaller">
        by <i>Ondřej Kvapil</i></span></a>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
<ul>
<li><a href="#kombinatorická-optimalizace-problém-vážené-splnitelnosti-booleovské-formule">Kombinatorická optimalizace: problém vážené splnitelnosti booleovské formule</a>
<ul>
<li><a href="#zadání">Zadání</a>
<ul>
<li><a href="#pokyny">Pokyny</a></li>
<li><a href="#hodnocení">Hodnocení</a></li>
<li><a href="#instance">Instance</a></li>
</ul></li>
<li><a href="#řešení">Řešení</a></li>
<li><a href="#instrukce-k-sestavení-programu">Instrukce k sestavení programu</a></li>
<li><a href="#benchmarking">Benchmarking</a>
<ul>
<li><a href="#white-box-průzkum-chování-algoritmu">White box: průzkum chování algoritmu</a></li>
<li><a href="#black-box-vyhodnocení-hustoty-chyb">Black box: vyhodnocení hustoty chyb</a></li>
</ul></li>
<li><a href="#implementace">Implementace</a>
<ul>
<li><a href="#algoritmy">Algoritmy</a></li>
</ul></li>
<li><a href="#závěr">Závěr</a></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#měření-výkonu">Měření výkonu</a></li>
<li><a href="#spouštění-jednotlivých-řešičů">Spouštění jednotlivých řešičů</a></li>
<li><a href="#automatické-testy">Automatické testy</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</nav>

<!-- <nav class="navbar navbar-dark navbar-expand-md bg-dark mb-4">
<p class="author">Ondřej Kvapil</p>
</nav>
 -->

<main role="main" class="flex-fill"><div class="container my-5">
<h1 id="kombinatorická-optimalizace-problém-vážené-splnitelnosti-booleovské-formule">Kombinatorická optimalizace: problém vážené splnitelnosti booleovské formule</h1>
<h2 id="zadání">Zadání</h2>
<h3 id="pokyny">Pokyny</h3>
<p>Problém řešte některou z pokročilých heuristik:</p>
<ul>
<li>simulované ochlazování</li>
<li>genetický algoritmus</li>
<li>tabu prohledávání</li>
</ul>
<p>Po nasazení heuristiky ověřte její vlastnosti experimentálním vyhodnocením, které přesvědčivě doloží, jakou třídu (rozsah, velikosti…) instancí heuristika zpracovává. Zejména v případě použití nestandardních, např. originálních technik doložte jejich účinnost experimentálně (což vyloučí případné diskuse o jejich vhodnosti).</p>
<p>Zpráva by měla dokládat Váš racionální přístup k řešení problému, tedy celý pracovní postup. Ve zprávě prosím také popište obě fáze nasazení heuristiky, jak nastavení, (white box fáze), tak závěrečné vyhodnocení heuristiky (black box fáze). Prosím používejte definované formáty pro instance a řešení, usnadníte tak lepší přizpůsobení zkušebních instancí.</p>
<h3 id="hodnocení">Hodnocení</h3>
<p>Tato úloha je součástí hodnocení zkoušky - až 30 bodů ze 100 za předmět celkem. Práce by měla doložit Vaši schopnost nasadit pokročilé heuristiky na netriviální optimalizační problém. Nasazená heuristika by měla zpracovávat rozumně široké spektrum instancí s rozumnou chybou. Co je “rozumně”, bychom se měli dočíst v závěru Vaší práce.</p>
<p>V hodnocení je kladen důraz na racionální postup celé práce. Pokud postup vyhovuje, méně uspokojivé výsledky heuristiky příliš nevadí, vzhledem k tomu, že řešený problém (jak jistě víte) patří k nejtěžším ve třídě NPO. Proto potřebujeme znát jak pracovní postup ve white box fázi, tak výsledky a závěr black box fáze.</p>
<p>Hodnocení je rozděleno do tří kategorií:</p>
<ul>
<li>Algoritmus a implementace (5 pt.)
<ul>
<li>Byly použity techniky (algoritmy, datové struktury) adekvátní problému?</li>
<li>Byly použity pokročilé techniky? (např. adaptační mechanismy)</li>
<li>Jsou některé postupy originálním přínosem autora?</li>
</ul></li>
<li>Nastavení heuristiky (13 pt.)
<ul>
<li>Jakou metodou autor hledal nastavení parametrů?</li>
<li>Jak byly plánovány experimenty a jaké byly jejich otázky?</li>
<li>Jestliže byl proveden faktorový návrh (což příliš nedoporučujeme), jak kompletní byl (změna vždy jen jednoho parametru nestačí)?</li>
<li>Na jak velkých instancích je heuristika schopna pracovat?</li>
<li>Jestliže práce heuristiky není uspokojivá, jak systematické byly snahy autora zjednat nápravu?</li>
</ul></li>
<li>Experimentální vyhodnocení heuristiky (12 pt.)
<ul>
<li>Jak dalece jsou závěry vyhodnocení doloženy experimentálně?</li>
<li>Je interpretace experimentů přesvědčivá?</li>
<li>Pokud je algoritmus randomizovaný, byla tato skutečnost vzata v úvahu při plánování experimentů?</li>
<li>Je možno z experimentů usoudit na iterativní sílu heuristiky?</li>
<li>Byly nestandardní postupy experimentálně porovnány se standardními?</li>
<li>Jsou výsledky experimentů srozumitelně prezentovány (grafy, tabulky, statistické metody)?</li>
</ul></li>
</ul>
<p>Práce bez experimentální části nemůže být přijata k hodnocení.</p>
<h3 id="instance">Instance</h3>
<ul>
<li>SAT instance lze generovat náhodně. Klíčovým parametrem je poměr počtu klauzulí k počtu proměnných pro 3-SAT (viz ai-phys1.pdf - doporučujeme). Váhy lze generovat náhodně. V takovém případě je vhodné prokázat, že instance, kde všechny váhy byly vynásobeny velkým číslem, jsou zpracovávány stejně úspěšně.</li>
<li>Lze vyjít z <a href="http://www.cs.ubc.ca/~hoos/SATLIB/benchm.html">DIMACS</a> SAT instancí. Nemají váhy, jejich generování viz výše.Tyto instance jsou na hraně fázového přechodu, jsou tedy značně obtížné. Obtížnost můžete snížit zkrácením (vynechání klauzulí).</li>
<li>Připravili jsme sady zkušebních instancí. Vycházejí z instancí SATLIB, jsou ale zkráceny tak, aby měly co nejvíce řešení (počty řešení přikládáme). Váhy nejsou náhodné, mají ale náhodnou složku. Za upozornění na chyby, nekonzistence atd. budeme vděčni.
<ul>
<li><code>wuf-M</code> a <code>wuf-N</code>: Váhy by měly podporovat nalezení řešení. Heuristika, která řeší určitou instanci v sadě <code>wuf-M</code>, by měla řešit odpovídající instanci v sadě <code>wuf-N</code> stejně snadno. Vzhledem k počtu řešení jednotlivých instací (až 108), není možné efektivně najít optimální řešení</li>
<li><code>wuf-Q</code> a <code>wuf-R</code>: Jako výše, váhy ale vytvářejí (mírně) zavádějící úlohu.</li>
<li><code>wuf-A</code>: z dílny prof. Zlomyslného. Instance vycházejí z nezkrácených (nebo jen mírně zkrácených) instancí, takže jsou obtížné. Váhy vytvářejí zavádějící úlohu. Nicméně, malý počet řešení dovoluje ve většině případů uvést optimální řešení.</li>
</ul></li>
</ul>
<h2 id="řešení">Řešení</h2>
<p>Úkoly předmětu NI-KOP jsem se rozhodl implementovat v jazyce Rust za pomoci nástrojů na <em>literate programming</em> – přístup k psaní zdrojového kódu, který upřednostňuje lidsky čitelný popis před seznamem příkazů pro počítač. Tento dokument obsahuje veškerý zdrojový kód nutný k reprodukci mojí práce. Výsledek je dostupný online jako statická <a href="http://viluon.me/ni-kop/">webová stránka</a> a <a href="http://viluon.me/ni-kop/report.pdf">ke stažení v PDF</a>.</p>
<h2 id="instrukce-k-sestavení-programu">Instrukce k sestavení programu</h2>
<p>Program využívá standardních nástrojů jazyka Rust. O sestavení stačí požádat <code>cargo</code>.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#build-instructions-container" aria-controls="build-instructions-container">&lt;&lt;build-instructions&gt;&gt;=</button>
<div id="build-instructions-container" class="collapse">
<div class="sourceCode" id="build-instructions" style="max-height: 50vh"><pre class="sourceCode zsh eval bootstrap-fold overflow-auto"><code class="sourceCode zsh"><span id="build-instructions-1"><a href="#build-instructions-1" aria-hidden="true" tabindex="-1"></a><span class="kw">cd</span> solver</span>
<span id="build-instructions-2"><a href="#build-instructions-2" aria-hidden="true" tabindex="-1"></a>cargo build --release --color always</span></code></pre></div>
</div>
</div>
</div>
<div class="doctestResult">
<div class="programOutput">
<pre class="ansi2html-content"><span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">    Updating</span> crates.io index
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00"> Downloading</span> crates ...
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> aho-corasick v0.7.18
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> log v0.4.14
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> permutation v0.2.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> env_logger v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> tap v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> quickcheck v1.0.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> proc-macro2 v1.0.29
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> radium v0.6.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> wyz v0.4.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> syn v1.0.80
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> libc v0.2.103
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> arrayvec v0.7.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> anyhow v1.0.44
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> quickcheck_macros v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> funty v1.2.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> bitvec v0.22.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> libc v0.2.103
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> cfg-if v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> memchr v2.4.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> proc-macro2 v1.0.29
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> unicode-xid v0.2.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> log v0.4.14
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> radium v0.6.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> ppv-lite86 v0.2.15
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> syn v1.0.80
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> regex-syntax v0.6.25
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> anyhow v1.0.44
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> tap v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> funty v1.2.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> permutation v0.2.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> arrayvec v0.7.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> wyz v0.4.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> aho-corasick v0.7.18
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> getrandom v0.2.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quote v1.0.10
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> bitvec v0.22.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand_core v0.6.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> regex v1.5.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand_chacha v0.3.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> env_logger v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quickcheck_macros v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quickcheck v1.0.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> solver v0.1.0 (/__w/ni-kop/ni-kop/5-weighted-sat/solver)
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: unused imports: `BTreeMap`, `cmp::max`, `self`</span>
 <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:4:16
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">4</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>use std::{cmp, cmp::max,
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>               <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^^^</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">...</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">7</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    io::{BufRead, BufReader, self},
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>                             <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">8</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    collections::{BTreeMap, HashMap},
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>                  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^^^</span>
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">= </span><span style="font-weight: bold">note</span>: `#[warn(unused_imports)]` on by default

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: unused import: `BitVec`</span>
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:13:31
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">13</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>use bitvec::prelude::{BitArr, BitVec};
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>                              <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^</span>

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: associated function is never used: `with`</span>
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:114:8
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">114</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    fn with(mut self, i: usize) -&gt; Solution&lt;'a&gt; {
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^</span>
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">= </span><span style="font-weight: bold">note</span>: `#[warn(dead_code)]` on by default

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: associated function is never used: `without`</span>
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:118:8
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">118</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    fn without(mut self, i: usize) -&gt; Solution&lt;'a&gt; {
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^^</span>

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: associated function is never used: `invert`</span>
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:122:8
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">122</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    fn invert(mut self) -&gt; Solution&lt;'a&gt; {
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^</span>

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: associated function is never used: `set`</span>
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:129:8
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">129</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    fn set(&amp;mut self, i: usize, set: bool) -&gt; Solution&lt;'a&gt; {
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^</span>

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: associated function is never used: `default`</span>
   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/lib.rs:139:8
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">139</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>    fn default(inst: &amp;'a Instance) -&gt; Solution&lt;'a&gt; {
    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^^</span>

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">:</span> `solver` (lib) generated 7 warnings
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">: unused import: `anyhow`</span>
 <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">--&gt; </span>src/bin/main.rs:8:22
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">8</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>use anyhow::{Result, anyhow};
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">| </span>                     <span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">^^^^^^</span>
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">|</span>
  <span style="font-weight: bold"></span><span style="font-weight: bold; color: #5c5cff">= </span><span style="font-weight: bold">note</span>: `#[warn(unused_imports)]` on by default

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #aa5500">warning</span><span style="font-weight: bold">:</span> `solver` (bin "main") generated 1 warning
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">    Finished</span> release [optimized + debuginfo] target(s) in 1m 38s
</pre>
</div>
</div>
</div>
<h2 id="benchmarking">Benchmarking</h2>
<p>Stejně jako v předchozí úloze jsem se ani tentokrát s měřením výkonu nespoléhal na existující Rust knihovny a namísto toho provedl měření v Pythonu.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#machine-info-container" aria-controls="machine-info-container">&lt;&lt;machine-info&gt;&gt;=</button>
<div id="machine-info-container" class="collapse">
<div class="sourceCode" id="machine-info" style="max-height: 50vh"><pre class="sourceCode zsh eval bootstrap-fold overflow-auto"><code class="sourceCode zsh"><span id="machine-info-1"><a href="#machine-info-1" aria-hidden="true" tabindex="-1"></a>uname -a</span>
<span id="machine-info-2"><a href="#machine-info-2" aria-hidden="true" tabindex="-1"></a>./cpufetch --logo-short --color ibm</span></code></pre></div>
</div>
</div>
</div>
<div class="doctestResult">
<div class="programOutput">
<pre class="ansi2html-content">Linux e852750c2f5b 5.11.0-1025-azure #27~20.04.1-Ubuntu SMP Fri Jan 7 15:02:06 UTC 2022 x86_64 GNU/Linux

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">                   .#################.          </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Name:</span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Intel Xeon E5-2673 v</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">              .####                   ####.     </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Hypervisor:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Microsoft Hyper-V</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">          .##                             ###   </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">uArch:</span>      <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Broadwell</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">       ##                          :##     ###  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Technology:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">14nm</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">    #                ##            :##      ##  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Max Freq:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Unknown</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">  ##   ##  ######.   ####  ######  :##      ##  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Cores:</span>      <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">2 cores</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7"> ##    ##  ##:  ##:  ##   ##   ### :##     ###  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">AVX:</span>        <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">AVX,AVX2</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##     ##  ##:  ##:  ##  :######## :##    ##    </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">FMA:</span>        <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">FMA3</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##     ##  ##:  ##:  ##   ##.   .  :## ####     </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L1i Size:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">32KB (64KB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##      #  ##:  ##:  ####  #####:   ##          </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L1d Size:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">32KB (64KB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7"> ##                                             </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L2 Size:</span>    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">256KB (512KB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">  ###.                         ..o####.         </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L3 Size:</span>    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">50MB</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">   ######oo...         ..oo#######              </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Peak Perf.:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Unknown</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">          o###############o                     </span>

</pre>
</div>
</div>
</div>
<h3 id="white-box-průzkum-chování-algoritmu">White box: průzkum chování algoritmu</h3>
<p>Průzkumná fáze práce má za cíl odhalit vztahy mezi jednotlivými parametry algoritmu a najít pro ně vhodné hodnoty. Výchozí parametry jsou vidět v kódu níže, modifikátor teploty je <span class="math inline">\(0.7\)</span> a maximální počet iterací je <span class="math inline">\(8 000\)</span>. Modifikátor teploty je koeficient, kterým se násobí cena řešení heuristické metody greedy redux. Toto číslo určuje počáteční teplotu.</p>
<p>Průzkum jsem provedl na prvních dvaceti instancích sady <code>NK35</code>.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#python-imports-container" aria-controls="python-imports-container">&lt;&lt;python-imports&gt;&gt;=</button>
<div id="python-imports-container" class="collapse">
<div class="sourceCode" id="python-imports" style="max-height: 50vh"><pre class="sourceCode python bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="python-imports-1"><a href="#python-imports-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="python-imports-2"><a href="#python-imports-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="python-imports-3"><a href="#python-imports-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="python-imports-4"><a href="#python-imports-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="python-imports-5"><a href="#python-imports-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> st</span>
<span id="python-imports-6"><a href="#python-imports-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="python-imports-7"><a href="#python-imports-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="python-imports-8"><a href="#python-imports-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="python-imports-9"><a href="#python-imports-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.core.tools.numeric <span class="im">import</span> to_numeric</span>
<span id="python-imports-10"><a href="#python-imports-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> subprocess <span class="im">import</span> run, PIPE</span>
<span id="python-imports-11"><a href="#python-imports-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product, chain</span>
<span id="python-imports-12"><a href="#python-imports-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap <span class="im">as</span> tr</span></code></pre></div>
</div>
</div>
<p>Skript <code>charts.py</code> je zodpovědný nejen za vykreslování grafů, ale také za načítání vstupních instancí, spouštění řešiče a měření času, který problém řešiči zabere.</p>
<div class="doctest" data-status="ERROR">
<div class="doctestInput">
<div class="sourceCode" id="cb1"><pre class="sourceCode python eval"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>python<span class="op">-</span>imports<span class="op">&gt;&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>performance<span class="op">-</span>chart<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
<div class="doctestError">
<div class="programOutput">
<pre class="ansi2html-content"><span style="color: #aa0000">---------------------------------------------------------------------------</span>
<span style="color: #aa0000">FileNotFoundError</span>                         Traceback (most recent call last)
<span style="color: #00aa00">/tmp/ipykernel_1641/1103332206.py</span> in <span style="color: #00aaaa">&lt;module&gt;</span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    101</span> <span style="color: #aa0000"># load the input</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    102</span> input <span style="color: #0000aa">=</span> <span style="color: #00aa00">None</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="color: #00aa00">--&gt; 103</span><span style="color: #aa0000"> </span><span style="color: #00aa00">with</span> open<span style="color: #0000aa">(</span><span style="color: #0000aa">"solver/ds/NK35_inst.dat"</span><span style="color: #0000aa">,</span> <span style="color: #0000aa">"r"</span><span style="color: #0000aa">)</span> <span style="color: #00aa00">as</span> f<span style="color: #0000aa">:</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    104</span>     input <span style="color: #0000aa">=</span> f<span style="color: #0000aa">.</span>read<span style="color: #0000aa">(</span><span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    105</span> <span style="color: #0000aa"></span>

<span style="color: #aa0000">FileNotFoundError</span>: [Errno 2] No such file or directory: 'solver/ds/NK35_inst.dat'</pre>
</div>
</div>
</div>
<p>Výkon každého algoritmu je na instancích měřen jednotlivě, tj. vstupní soubor rozdělíme na řádky a řešiči předáme jedinou instanci.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#performance-chart-container" aria-controls="performance-chart-container">&lt;&lt;performance-chart&gt;&gt;=</button>
<div id="performance-chart-container" class="collapse">
<div class="sourceCode" id="performance-chart" style="max-height: 50vh"><pre class="sourceCode python bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="performance-chart-1"><a href="#performance-chart-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the measurements</span></span>
<span id="performance-chart-2"><a href="#performance-chart-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-3"><a href="#performance-chart-3" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>)</span>
<span id="performance-chart-4"><a href="#performance-chart-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-5"><a href="#performance-chart-5" aria-hidden="true" tabindex="-1"></a>show_progress <span class="op">=</span> os.environ.get(<span class="st">&quot;JUPYTER&quot;</span>) <span class="op">==</span> <span class="va">None</span></span>
<span id="performance-chart-6"><a href="#performance-chart-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-7"><a href="#performance-chart-7" aria-hidden="true" tabindex="-1"></a><span class="co"># adapted from https://stackoverflow.com/questions/3173320/text-progress-bar-in-the-console</span></span>
<span id="performance-chart-8"><a href="#performance-chart-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> progress_bar(iteration, total, length <span class="op">=</span> <span class="dv">60</span>):</span>
<span id="performance-chart-9"><a href="#performance-chart-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> show_progress:</span>
<span id="performance-chart-10"><a href="#performance-chart-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="performance-chart-11"><a href="#performance-chart-11" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (<span class="st">&quot;</span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>).<span class="bu">format</span>(<span class="dv">100</span> <span class="op">*</span> (iteration <span class="op">/</span> <span class="bu">float</span>(total)))</span>
<span id="performance-chart-12"><a href="#performance-chart-12" aria-hidden="true" tabindex="-1"></a>    filledLength <span class="op">=</span> <span class="bu">int</span>(length <span class="op">*</span> iteration <span class="op">//</span> total)</span>
<span id="performance-chart-13"><a href="#performance-chart-13" aria-hidden="true" tabindex="-1"></a>    bar <span class="op">=</span> <span class="st">&#39;=&#39;</span> <span class="op">*</span> filledLength <span class="op">+</span> <span class="st">&#39; &#39;</span> <span class="op">*</span> (length <span class="op">-</span> filledLength)</span>
<span id="performance-chart-14"><a href="#performance-chart-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="ch">\r</span><span class="ss">[</span><span class="sc">{</span>bar<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>percent<span class="sc">}</span><span class="ss">%&#39;</span>, end <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\r</span><span class="st">&quot;</span>)</span>
<span id="performance-chart-15"><a href="#performance-chart-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> iteration <span class="op">==</span> total:</span>
<span id="performance-chart-16"><a href="#performance-chart-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="performance-chart-17"><a href="#performance-chart-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-18"><a href="#performance-chart-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invoke_solver(<span class="bu">input</span>, cfg):</span>
<span id="performance-chart-19"><a href="#performance-chart-19" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> run(</span>
<span id="performance-chart-20"><a href="#performance-chart-20" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="performance-chart-21"><a href="#performance-chart-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;target/release/main&quot;</span>,</span>
<span id="performance-chart-22"><a href="#performance-chart-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;sa&quot;</span>,</span>
<span id="performance-chart-23"><a href="#performance-chart-23" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(cfg[<span class="st">&quot;max_iterations&quot;</span>]),</span>
<span id="performance-chart-24"><a href="#performance-chart-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(cfg[<span class="st">&quot;scaling_factor&quot;</span>]),</span>
<span id="performance-chart-25"><a href="#performance-chart-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(cfg[<span class="st">&quot;temperature_modifier&quot;</span>]),</span>
<span id="performance-chart-26"><a href="#performance-chart-26" aria-hidden="true" tabindex="-1"></a>            <span class="bu">str</span>(cfg[<span class="st">&quot;equilibrium_width&quot;</span>]),</span>
<span id="performance-chart-27"><a href="#performance-chart-27" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="performance-chart-28"><a href="#performance-chart-28" aria-hidden="true" tabindex="-1"></a>        stdout <span class="op">=</span> PIPE,</span>
<span id="performance-chart-29"><a href="#performance-chart-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">input</span> <span class="op">=</span> <span class="bu">input</span>,</span>
<span id="performance-chart-30"><a href="#performance-chart-30" aria-hidden="true" tabindex="-1"></a>        encoding <span class="op">=</span> <span class="st">&quot;ascii&quot;</span>,</span>
<span id="performance-chart-31"><a href="#performance-chart-31" aria-hidden="true" tabindex="-1"></a>        cwd <span class="op">=</span> <span class="st">&quot;solver/&quot;</span></span>
<span id="performance-chart-32"><a href="#performance-chart-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="performance-chart-33"><a href="#performance-chart-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> solver.returncode <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="performance-chart-34"><a href="#performance-chart-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(solver)</span>
<span id="performance-chart-35"><a href="#performance-chart-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&quot;solver failed&quot;</span>)</span>
<span id="performance-chart-36"><a href="#performance-chart-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-37"><a href="#performance-chart-37" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> solver.stdout.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="performance-chart-38"><a href="#performance-chart-38" aria-hidden="true" tabindex="-1"></a>    [_, time, _] <span class="op">=</span> lines[<span class="op">-</span><span class="dv">3</span>].split()</span>
<span id="performance-chart-39"><a href="#performance-chart-39" aria-hidden="true" tabindex="-1"></a>    [cost, err]  <span class="op">=</span> lines[<span class="op">-</span><span class="dv">2</span>].split()</span>
<span id="performance-chart-40"><a href="#performance-chart-40" aria-hidden="true" tabindex="-1"></a>    cost_temperature_progression <span class="op">=</span> [<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">float</span>, entry.split())) <span class="cf">for</span> entry <span class="kw">in</span> lines[:<span class="op">-</span><span class="dv">4</span>]]</span>
<span id="performance-chart-41"><a href="#performance-chart-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="bu">float</span>(time), <span class="bu">float</span>(cost), <span class="bu">float</span>(err), cost_temperature_progression)</span>
<span id="performance-chart-42"><a href="#performance-chart-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-43"><a href="#performance-chart-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dataset(<span class="bu">id</span>, <span class="op">**</span>kwargs):</span>
<span id="performance-chart-44"><a href="#performance-chart-44" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> <span class="bu">dict</span>({</span>
<span id="performance-chart-45"><a href="#performance-chart-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># defaults</span></span>
<span id="performance-chart-46"><a href="#performance-chart-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;id&quot;</span>: [<span class="bu">id</span>],</span>
<span id="performance-chart-47"><a href="#performance-chart-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;precise_plot&quot;</span>: [<span class="va">True</span>],</span>
<span id="performance-chart-48"><a href="#performance-chart-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;n_instances&quot;</span>: [<span class="dv">15</span>],</span>
<span id="performance-chart-49"><a href="#performance-chart-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;max_iterations&quot;</span>: [<span class="dv">8000</span>],</span>
<span id="performance-chart-50"><a href="#performance-chart-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;scaling_factor&quot;</span>: [<span class="fl">0.996</span>],</span>
<span id="performance-chart-51"><a href="#performance-chart-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;temperature_modifier&quot;</span>: [<span class="fl">0.7</span>],</span>
<span id="performance-chart-52"><a href="#performance-chart-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;equilibrium_width&quot;</span>: [<span class="dv">10</span>],</span>
<span id="performance-chart-53"><a href="#performance-chart-53" aria-hidden="true" tabindex="-1"></a>    }, <span class="op">**</span>kwargs)</span>
<span id="performance-chart-54"><a href="#performance-chart-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-55"><a href="#performance-chart-55" aria-hidden="true" tabindex="-1"></a>    key_order <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> params]</span>
<span id="performance-chart-56"><a href="#performance-chart-56" aria-hidden="true" tabindex="-1"></a>    cartesian <span class="op">=</span> <span class="bu">list</span>(product(</span>
<span id="performance-chart-57"><a href="#performance-chart-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>[params[key] <span class="cf">for</span> key <span class="kw">in</span> key_order]</span>
<span id="performance-chart-58"><a href="#performance-chart-58" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="performance-chart-59"><a href="#performance-chart-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-60"><a href="#performance-chart-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="performance-chart-61"><a href="#performance-chart-61" aria-hidden="true" tabindex="-1"></a>        key: [row[key_order.index(key)] <span class="cf">for</span> row <span class="kw">in</span> cartesian] <span class="cf">for</span> key <span class="kw">in</span> params</span>
<span id="performance-chart-62"><a href="#performance-chart-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="performance-chart-63"><a href="#performance-chart-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-64"><a href="#performance-chart-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_datasets(<span class="op">*</span>dss):</span>
<span id="performance-chart-65"><a href="#performance-chart-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="performance-chart-66"><a href="#performance-chart-66" aria-hidden="true" tabindex="-1"></a>        k: <span class="bu">list</span>(chain(<span class="op">*</span>(ds[k] <span class="cf">for</span> ds <span class="kw">in</span> dss)))</span>
<span id="performance-chart-67"><a href="#performance-chart-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> dss[<span class="dv">0</span>]</span>
<span id="performance-chart-68"><a href="#performance-chart-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="performance-chart-69"><a href="#performance-chart-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-70"><a href="#performance-chart-70" aria-hidden="true" tabindex="-1"></a>configs <span class="op">=</span> merge_datasets(dataset(</span>
<span id="performance-chart-71"><a href="#performance-chart-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;scaling_factor_exploration&quot;</span>,</span>
<span id="performance-chart-72"><a href="#performance-chart-72" aria-hidden="true" tabindex="-1"></a>    scaling_factor <span class="op">=</span> [<span class="fl">0.85</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.992</span>, <span class="fl">0.994</span>, <span class="fl">0.996</span>, <span class="fl">0.997</span>, <span class="fl">0.998</span>, <span class="fl">0.999</span>],</span>
<span id="performance-chart-73"><a href="#performance-chart-73" aria-hidden="true" tabindex="-1"></a>), dataset(</span>
<span id="performance-chart-74"><a href="#performance-chart-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;temperature modifier exploration&quot;</span>,</span>
<span id="performance-chart-75"><a href="#performance-chart-75" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> [<span class="dv">30</span>],</span>
<span id="performance-chart-76"><a href="#performance-chart-76" aria-hidden="true" tabindex="-1"></a>    temperature_modifier <span class="op">=</span> [<span class="fl">0.0001</span>, <span class="fl">0.01</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">10000</span>],</span>
<span id="performance-chart-77"><a href="#performance-chart-77" aria-hidden="true" tabindex="-1"></a>), dataset(</span>
<span id="performance-chart-78"><a href="#performance-chart-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;equilibrium width exploration&quot;</span>,</span>
<span id="performance-chart-79"><a href="#performance-chart-79" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> [<span class="dv">40</span>],</span>
<span id="performance-chart-80"><a href="#performance-chart-80" aria-hidden="true" tabindex="-1"></a>    precise_plot <span class="op">=</span> [<span class="va">False</span>],</span>
<span id="performance-chart-81"><a href="#performance-chart-81" aria-hidden="true" tabindex="-1"></a>    equilibrium_width <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>],</span>
<span id="performance-chart-82"><a href="#performance-chart-82" aria-hidden="true" tabindex="-1"></a>), dataset(</span>
<span id="performance-chart-83"><a href="#performance-chart-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;black box&quot;</span>,</span>
<span id="performance-chart-84"><a href="#performance-chart-84" aria-hidden="true" tabindex="-1"></a>    precise_plot <span class="op">=</span> [<span class="va">False</span>],</span>
<span id="performance-chart-85"><a href="#performance-chart-85" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> [<span class="dv">500</span>],</span>
<span id="performance-chart-86"><a href="#performance-chart-86" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="performance-chart-87"><a href="#performance-chart-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-88"><a href="#performance-chart-88" aria-hidden="true" tabindex="-1"></a><span class="co"># load the input</span></span>
<span id="performance-chart-89"><a href="#performance-chart-89" aria-hidden="true" tabindex="-1"></a><span class="bu">input</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="performance-chart-90"><a href="#performance-chart-90" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;solver/ds/NK35_inst.dat&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="im">as</span> f:</span>
<span id="performance-chart-91"><a href="#performance-chart-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span> <span class="op">=</span> f.read()</span>
<span id="performance-chart-92"><a href="#performance-chart-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-93"><a href="#performance-chart-93" aria-hidden="true" tabindex="-1"></a>errors <span class="op">=</span> []</span>
<span id="performance-chart-94"><a href="#performance-chart-94" aria-hidden="true" tabindex="-1"></a>cfgs <span class="op">=</span> [<span class="bu">dict</span>(<span class="bu">zip</span>(configs, v)) <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>configs.values())]</span>
<span id="performance-chart-95"><a href="#performance-chart-95" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="performance-chart-96"><a href="#performance-chart-96" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">sum</span>([cfg[<span class="st">&quot;n_instances&quot;</span>] <span class="cf">for</span> cfg <span class="kw">in</span> cfgs])</span>
<span id="performance-chart-97"><a href="#performance-chart-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-98"><a href="#performance-chart-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config <span class="kw">in</span> cfgs:</span>
<span id="performance-chart-99"><a href="#performance-chart-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_progress:</span>
<span id="performance-chart-100"><a href="#performance-chart-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(end <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\033</span><span class="st">[2K&quot;</span>)</span>
<span id="performance-chart-101"><a href="#performance-chart-101" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(config)</span>
<span id="performance-chart-102"><a href="#performance-chart-102" aria-hidden="true" tabindex="-1"></a>    progress_bar(iteration, total)</span>
<span id="performance-chart-103"><a href="#performance-chart-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-104"><a href="#performance-chart-104" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> <span class="st">&quot;-&quot;</span>.join([<span class="bu">str</span>(v) <span class="cf">for</span> _, v <span class="kw">in</span> config.items()])</span>
<span id="performance-chart-105"><a href="#performance-chart-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> instance <span class="kw">in</span> <span class="bu">input</span>.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)[:config[<span class="st">&quot;n_instances&quot;</span>]]:</span>
<span id="performance-chart-106"><a href="#performance-chart-106" aria-hidden="true" tabindex="-1"></a>        <span class="bu">id</span> <span class="op">=</span> instance.split()[<span class="dv">0</span>]</span>
<span id="performance-chart-107"><a href="#performance-chart-107" aria-hidden="true" tabindex="-1"></a>        (t, cost, err, cost_temperature_progression) <span class="op">=</span> invoke_solver(instance, config)</span>
<span id="performance-chart-108"><a href="#performance-chart-108" aria-hidden="true" tabindex="-1"></a>        errors.append(<span class="bu">dict</span>(config, error <span class="op">=</span> err))</span>
<span id="performance-chart-109"><a href="#performance-chart-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-110"><a href="#performance-chart-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> config[<span class="st">&quot;precise_plot&quot;</span>]:</span>
<span id="performance-chart-111"><a href="#performance-chart-111" aria-hidden="true" tabindex="-1"></a>            <span class="co"># plot the cost / temperature progression:</span></span>
<span id="performance-chart-112"><a href="#performance-chart-112" aria-hidden="true" tabindex="-1"></a>            <span class="co"># we have two line graphs in a single plot</span></span>
<span id="performance-chart-113"><a href="#performance-chart-113" aria-hidden="true" tabindex="-1"></a>            <span class="co"># the x axis is just the index in the list</span></span>
<span id="performance-chart-114"><a href="#performance-chart-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-115"><a href="#performance-chart-115" aria-hidden="true" tabindex="-1"></a>            plt.style.use(<span class="st">&quot;dark_background&quot;</span>)</span>
<span id="performance-chart-116"><a href="#performance-chart-116" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> figsize)</span>
<span id="performance-chart-117"><a href="#performance-chart-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (i, label) <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="dv">42</span>), [<span class="st">&quot;cost&quot;</span>, <span class="st">&quot;best cost&quot;</span>, <span class="st">&quot;temperature&quot;</span>]):</span>
<span id="performance-chart-118"><a href="#performance-chart-118" aria-hidden="true" tabindex="-1"></a>                ax.plot(</span>
<span id="performance-chart-119"><a href="#performance-chart-119" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">range</span>(<span class="bu">len</span>(cost_temperature_progression)),</span>
<span id="performance-chart-120"><a href="#performance-chart-120" aria-hidden="true" tabindex="-1"></a>                    [entry[i] <span class="cf">for</span> entry <span class="kw">in</span> cost_temperature_progression],</span>
<span id="performance-chart-121"><a href="#performance-chart-121" aria-hidden="true" tabindex="-1"></a>                    label <span class="op">=</span> label,</span>
<span id="performance-chart-122"><a href="#performance-chart-122" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="performance-chart-123"><a href="#performance-chart-123" aria-hidden="true" tabindex="-1"></a>            ax.set_xlabel(<span class="st">&quot;iteration&quot;</span>)</span>
<span id="performance-chart-124"><a href="#performance-chart-124" aria-hidden="true" tabindex="-1"></a>            ax.set_title(<span class="ss">f&quot;instance </span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss"> with error </span><span class="sc">{</span>err<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="performance-chart-125"><a href="#performance-chart-125" aria-hidden="true" tabindex="-1"></a>            ax.legend(loc <span class="op">=</span> <span class="st">&quot;lower right&quot;</span>)</span>
<span id="performance-chart-126"><a href="#performance-chart-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-127"><a href="#performance-chart-127" aria-hidden="true" tabindex="-1"></a>            plt.savefig(<span class="ss">f&quot;docs/assets/whitebox-</span><span class="sc">{</span>params<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss">.svg&quot;</span>)</span>
<span id="performance-chart-128"><a href="#performance-chart-128" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="performance-chart-129"><a href="#performance-chart-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-130"><a href="#performance-chart-130" aria-hidden="true" tabindex="-1"></a>        iteration <span class="op">=</span> iteration <span class="op">+</span> <span class="dv">1</span></span>
<span id="performance-chart-131"><a href="#performance-chart-131" aria-hidden="true" tabindex="-1"></a>        progress_bar(iteration, total)</span>
<span id="performance-chart-132"><a href="#performance-chart-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-133"><a href="#performance-chart-133" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame(errors)</span>
<span id="performance-chart-134"><a href="#performance-chart-134" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ridgeline(<span class="bu">id</span>, title, col, filename, x_label <span class="op">=</span> <span class="st">&quot;Chyba oproti optimálnímu řešení [%]&quot;</span>):</span>
<span id="performance-chart-135"><a href="#performance-chart-135" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data[data[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="performance-chart-136"><a href="#performance-chart-136" aria-hidden="true" tabindex="-1"></a>    series <span class="op">=</span> df.groupby(col)[<span class="st">&quot;error&quot;</span>].mean()</span>
<span id="performance-chart-137"><a href="#performance-chart-137" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&quot;mean error&quot;</span>] <span class="op">=</span> df[col].<span class="bu">map</span>(series)</span>
<span id="performance-chart-138"><a href="#performance-chart-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-139"><a href="#performance-chart-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the error distributions for each value of col</span></span>
<span id="performance-chart-140"><a href="#performance-chart-140" aria-hidden="true" tabindex="-1"></a>    plt.style.use(<span class="st">&quot;default&quot;</span>)</span>
<span id="performance-chart-141"><a href="#performance-chart-141" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style <span class="op">=</span> <span class="st">&quot;white&quot;</span>, rc <span class="op">=</span> {<span class="st">&quot;axes.facecolor&quot;</span>: (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)})</span>
<span id="performance-chart-142"><a href="#performance-chart-142" aria-hidden="true" tabindex="-1"></a>    pal <span class="op">=</span> sns.color_palette(<span class="st">&quot;crest&quot;</span>, n_colors <span class="op">=</span> <span class="bu">len</span>(df[col].unique()))</span>
<span id="performance-chart-143"><a href="#performance-chart-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-144"><a href="#performance-chart-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set up the layout</span></span>
<span id="performance-chart-145"><a href="#performance-chart-145" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.FacetGrid(</span>
<span id="performance-chart-146"><a href="#performance-chart-146" aria-hidden="true" tabindex="-1"></a>        df,</span>
<span id="performance-chart-147"><a href="#performance-chart-147" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> col,</span>
<span id="performance-chart-148"><a href="#performance-chart-148" aria-hidden="true" tabindex="-1"></a>        hue <span class="op">=</span> <span class="st">&quot;mean error&quot;</span>,</span>
<span id="performance-chart-149"><a href="#performance-chart-149" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> pal,</span>
<span id="performance-chart-150"><a href="#performance-chart-150" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="performance-chart-151"><a href="#performance-chart-151" aria-hidden="true" tabindex="-1"></a>        aspect <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="performance-chart-152"><a href="#performance-chart-152" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="performance-chart-153"><a href="#performance-chart-153" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>)</span>
<span id="performance-chart-154"><a href="#performance-chart-154" aria-hidden="true" tabindex="-1"></a>    <span class="co"># distributions</span></span>
<span id="performance-chart-155"><a href="#performance-chart-155" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(sns.kdeplot, <span class="st">&quot;error&quot;</span>, clip <span class="op">=</span> (<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>), bw_adjust <span class="op">=</span> <span class="dv">1</span>, clip_on <span class="op">=</span> <span class="va">False</span>, fill <span class="op">=</span> <span class="va">True</span>, alpha <span class="op">=</span> <span class="dv">1</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="performance-chart-156"><a href="#performance-chart-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># contours</span></span>
<span id="performance-chart-157"><a href="#performance-chart-157" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(sns.kdeplot, <span class="st">&quot;error&quot;</span>, clip <span class="op">=</span> (<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>), bw_adjust <span class="op">=</span> <span class="dv">1</span>, clip_on <span class="op">=</span> <span class="va">False</span>, color <span class="op">=</span> <span class="st">&quot;w&quot;</span>, lw <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="performance-chart-158"><a href="#performance-chart-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># horizontal lines</span></span>
<span id="performance-chart-159"><a href="#performance-chart-159" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(plt.axhline, y <span class="op">=</span> <span class="dv">0</span>, lw <span class="op">=</span> <span class="dv">2</span>, clip_on <span class="op">=</span> <span class="va">False</span>)</span>
<span id="performance-chart-160"><a href="#performance-chart-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># overlap</span></span>
<span id="performance-chart-161"><a href="#performance-chart-161" aria-hidden="true" tabindex="-1"></a>    g.fig.subplots_adjust(hspace <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>)</span>
<span id="performance-chart-162"><a href="#performance-chart-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-163"><a href="#performance-chart-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(g.axes.flat):</span>
<span id="performance-chart-164"><a href="#performance-chart-164" aria-hidden="true" tabindex="-1"></a>        ax.text(<span class="op">-</span><span class="fl">0.125</span>, <span class="dv">5</span>, df[col].unique()[i],</span>
<span id="performance-chart-165"><a href="#performance-chart-165" aria-hidden="true" tabindex="-1"></a>                fontsize <span class="op">=</span> <span class="dv">15</span>, color <span class="op">=</span> ax.lines[<span class="op">-</span><span class="dv">1</span>].get_color(), va <span class="op">=</span> <span class="st">&quot;baseline&quot;</span>)</span>
<span id="performance-chart-166"><a href="#performance-chart-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-167"><a href="#performance-chart-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove titles, y ticks, spines</span></span>
<span id="performance-chart-168"><a href="#performance-chart-168" aria-hidden="true" tabindex="-1"></a>    g.set_titles(<span class="st">&quot;&quot;</span>)</span>
<span id="performance-chart-169"><a href="#performance-chart-169" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">set</span>(yticks <span class="op">=</span> [])</span>
<span id="performance-chart-170"><a href="#performance-chart-170" aria-hidden="true" tabindex="-1"></a>    g.despine(left <span class="op">=</span> <span class="va">True</span>, bottom <span class="op">=</span> <span class="va">True</span>)</span>
<span id="performance-chart-171"><a href="#performance-chart-171" aria-hidden="true" tabindex="-1"></a>    g.fig.suptitle(title, fontsize <span class="op">=</span> <span class="dv">20</span>, ha <span class="op">=</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="performance-chart-172"><a href="#performance-chart-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> g.axes.flat:</span>
<span id="performance-chart-173"><a href="#performance-chart-173" aria-hidden="true" tabindex="-1"></a>        ax.xaxis.set_major_formatter(<span class="kw">lambda</span> x, pos: <span class="ss">f&quot;</span><span class="sc">{x</span> <span class="op">*</span> <span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">&quot;</span>)</span>
<span id="performance-chart-174"><a href="#performance-chart-174" aria-hidden="true" tabindex="-1"></a>    g.set_xlabels(x_label)</span>
<span id="performance-chart-175"><a href="#performance-chart-175" aria-hidden="true" tabindex="-1"></a>    g.set_ylabels(<span class="st">&quot;&quot;</span>)</span>
<span id="performance-chart-176"><a href="#performance-chart-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-177"><a href="#performance-chart-177" aria-hidden="true" tabindex="-1"></a>    g.savefig(<span class="ss">f&quot;docs/assets/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="performance-chart-178"><a href="#performance-chart-178" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="performance-chart-179"><a href="#performance-chart-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-180"><a href="#performance-chart-180" aria-hidden="true" tabindex="-1"></a>ridgeline(</span>
<span id="performance-chart-181"><a href="#performance-chart-181" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;scaling_factor_exploration&quot;</span>,</span>
<span id="performance-chart-182"><a href="#performance-chart-182" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vliv koeficientu chlazení na hustotu chyb&quot;</span>,</span>
<span id="performance-chart-183"><a href="#performance-chart-183" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;scaling_factor&quot;</span>,</span>
<span id="performance-chart-184"><a href="#performance-chart-184" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whitebox-error-distributions.svg&quot;</span>,</span>
<span id="performance-chart-185"><a href="#performance-chart-185" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="performance-chart-186"><a href="#performance-chart-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-187"><a href="#performance-chart-187" aria-hidden="true" tabindex="-1"></a>ridgeline(</span>
<span id="performance-chart-188"><a href="#performance-chart-188" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;temperature modifier exploration&quot;</span>,</span>
<span id="performance-chart-189"><a href="#performance-chart-189" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vliv koeficientu počáteční teploty na hustotu chyb&quot;</span>,</span>
<span id="performance-chart-190"><a href="#performance-chart-190" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;temperature_modifier&quot;</span>,</span>
<span id="performance-chart-191"><a href="#performance-chart-191" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whitebox-error-distributions-temperature.svg&quot;</span>,</span>
<span id="performance-chart-192"><a href="#performance-chart-192" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="performance-chart-193"><a href="#performance-chart-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-194"><a href="#performance-chart-194" aria-hidden="true" tabindex="-1"></a>ridgeline(</span>
<span id="performance-chart-195"><a href="#performance-chart-195" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;equilibrium width exploration&quot;</span>,</span>
<span id="performance-chart-196"><a href="#performance-chart-196" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vliv šířky ekvilibria na hustotu chyb&quot;</span>,</span>
<span id="performance-chart-197"><a href="#performance-chart-197" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;equilibrium_width&quot;</span>,</span>
<span id="performance-chart-198"><a href="#performance-chart-198" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whitebox-error-distributions-equilibrium-width.svg&quot;</span>,</span>
<span id="performance-chart-199"><a href="#performance-chart-199" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="performance-chart-200"><a href="#performance-chart-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="performance-chart-201"><a href="#performance-chart-201" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the error distribution</span></span>
<span id="performance-chart-202"><a href="#performance-chart-202" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(</span>
<span id="performance-chart-203"><a href="#performance-chart-203" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data[data[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="st">&quot;black box&quot;</span>],</span>
<span id="performance-chart-204"><a href="#performance-chart-204" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">&quot;error&quot;</span>,</span>
<span id="performance-chart-205"><a href="#performance-chart-205" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="performance-chart-206"><a href="#performance-chart-206" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&quot;docs/assets/blackbox-error-distribution.svg&quot;</span>)</span></code></pre></div>
</div>
</div>
<p>Koeficient chlazení má na průběh hledání zásadní vliv. Přehled různých nastavení tohoto parametru je vidět v grafu níže.</p>
<figure>
<img src="assets/whitebox-error-distributions.svg" alt="Vliv koeficientu chlazení na hustotu chyb" /><figcaption aria-hidden="true">Vliv koeficientu chlazení na hustotu chyb</figcaption>
</figure>
<p>Rychlé chlazení vede k nedostatečné diversifikaci řešení. Algoritmus nemá možnost projít skrz řešení nízké ceny aby se dostal z oblasti lokálního minima. Protože ukončovací podmínka závisí na teplotě, tento postup nevyzkouší mnoho možností a už po pár desítkách iterací skončí – s vysokou chybou.</p>
<figure>
<img src="assets/whitebox-scaling_factor_exploration-True-15-8000-0.85-0.7-10-9.svg" alt="Nedostatečná diversifikace rychlého chlazení" /><figcaption aria-hidden="true">Nedostatečná diversifikace rychlého chlazení</figcaption>
</figure>
<p>U velmi pomalého chlazení dochází k předčasnému vyčerpání limitu iterací. Algoritmus skončí dříve, než teplota klesne natolik, aby začala intensifikace.</p>
<figure>
<img src="assets/whitebox-scaling_factor_exploration-True-15-8000-0.999-0.7-10-9.svg" alt="Nedostatečná intensifikace pomalého chlazení" /><figcaption aria-hidden="true">Nedostatečná intensifikace pomalého chlazení</figcaption>
</figure>
<p>Koeficient <span class="math inline">\(0.996\)</span> je ideální volbou pro toto konkrétní nastavení ostatních parametrů. Řešení se blíží optimu s maximální chybou <span class="math inline">\(\approx 2.43\%\)</span> a průměrnou <span class="math inline">\(\approx 0.36\%\)</span>.</p>
<figure>
<img src="assets/whitebox-scaling_factor_exploration-True-15-8000-0.996-0.7-10-9.svg" alt="Fáze diversifikace i intensifikace ve vhodném poměru" /><figcaption aria-hidden="true">Fáze diversifikace i intensifikace ve vhodném poměru</figcaption>
</figure>
<p>Vliv parametrů počáteční teploty a šířky ekvilibria na hustotu chyb jsem změřil podobným způsobem, tyto parametry zřejmě kvalitu řešení zdaleka neovlivňují tolik.</p>
<p>Pro připomenutí, koeficient počáteční teploty násobí cenu řešení greedy redux, toto číslo udává počáteční teplotu.</p>
<figure>
<img src="assets/whitebox-error-distributions-temperature.svg" alt="Vliv koeficientu počáteční teploty na hustotu chyb" /><figcaption aria-hidden="true">Vliv koeficientu počáteční teploty na hustotu chyb</figcaption>
</figure>
<p>Šířka ekvilibria určuje počet iterací při kterých algoritmus setrvá v jedné teplotě, nikoliv však jak rychle se teplota mění.</p>
<figure>
<img src="assets/whitebox-error-distributions-equilibrium-width.svg" alt="Vliv šířky ekvilibria na hustotu chyb" /><figcaption aria-hidden="true">Vliv šířky ekvilibria na hustotu chyb</figcaption>
</figure>
<h3 id="black-box-vyhodnocení-hustoty-chyb">Black box: vyhodnocení hustoty chyb</h3>
<p>Pro black box vyhodnocení jsem použil celou sadu NK35 a změřil hustotu chyb.</p>
<figure>
<img src="assets/blackbox-error-distribution.svg" alt="Hustota chyb přes 500 instancí" /><figcaption aria-hidden="true">Hustota chyb přes 500 instancí</figcaption>
</figure>
<h2 id="implementace">Implementace</h2>
<p>Program začíná definicí datové struktury reprezentující instanci problému batohu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#problem-instance-definition-container" aria-controls="problem-instance-definition-container">&lt;&lt;problem-instance-definition&gt;&gt;=</button>
<div id="problem-instance-definition-container" class="collapse">
<div class="sourceCode" id="problem-instance-definition" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="problem-instance-definition-1"><a href="#problem-instance-definition-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="problem-instance-definition-2"><a href="#problem-instance-definition-2" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Instance <span class="op">{</span></span>
<span id="problem-instance-definition-3"><a href="#problem-instance-definition-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> id<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> m<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> <span class="kw">pub</span> items<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">&gt;</span></span>
<span id="problem-instance-definition-4"><a href="#problem-instance-definition-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<p>Následující úryvek poskytuje ptačí pohled na strukturu souboru. Použité knihovny jsou importovány na začátku, následuje již zmíněná definice instance problému, dále funkce <code>main()</code>, parser, definice struktury řešení a její podpůrné funkce, samotné algoritmy řešiče a v neposlední řadě sada automatických testů.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-slash-src-slash-lib-dot-rs-container" aria-controls="solver-slash-src-slash-lib-dot-rs-container">&lt;&lt;solver/src/lib.rs&gt;&gt;=</button>
<div id="solver-slash-src-slash-lib-dot-rs-container" class="collapse">
<div class="sourceCode" id="cb2" data-file="solver/src/lib.rs" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>imports<span class="op">&gt;&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>algorithm<span class="op">-</span>map<span class="op">&gt;&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> solve_stream<span class="op">&lt;</span>T<span class="op">&gt;</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    alg<span class="op">:</span> <span class="kw">for</span> <span class="op">&lt;</span><span class="ot">&#39;b</span><span class="op">&gt;</span> <span class="kw">fn</span>(<span class="op">&amp;</span><span class="ot">&#39;b</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;b</span><span class="op">&gt;,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">:</span> HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    stream<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> T</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">f64</span><span class="op">&gt;</span>)<span class="op">&gt;&gt;</span> <span class="kw">where</span> T<span class="op">:</span> <span class="bu">BufRead</span> <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> results <span class="op">=</span> <span class="pp">vec!</span>[]<span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">match</span> parse_line(stream)<span class="op">?.</span>as_ref()<span class="op">.</span>map(<span class="op">|</span>inst<span class="op">|</span> (inst<span class="op">,</span> alg(inst))) <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="cn">Some</span>((inst<span class="op">,</span> sln)) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> optimal <span class="op">=</span> <span class="op">&amp;</span>solutions<span class="op">.</span>get(<span class="op">&amp;</span>(inst<span class="op">.</span>items<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u32</span><span class="op">,</span> inst<span class="op">.</span>id))<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> error <span class="op">=</span> optimal<span class="op">.</span>map(<span class="op">|</span>opt<span class="op">|</span> <span class="dv">1.0</span> <span class="op">-</span> sln<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> opt<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span>)<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                results<span class="op">.</span>push((sln<span class="op">.</span>cost<span class="op">,</span> error))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">Ok</span>(results)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> load_instances<span class="op">&lt;</span>T<span class="op">&gt;</span>(stream<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> T) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> T<span class="op">:</span> <span class="bu">BufRead</span> <span class="op">{</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> instances <span class="op">=</span> <span class="pp">vec!</span>[]<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">match</span> parse_line(stream)<span class="op">?</span> <span class="op">{</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="cn">Some</span>(inst) <span class="op">=&gt;</span> instances<span class="op">.</span>push(inst)<span class="op">,</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span> <span class="cn">Ok</span>(instances)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::result::</span><span class="dt">Result</span> <span class="kw">as</span> IOResult<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> list_input_files(set<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> r<span class="op">:</span> Range<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>IOResult<span class="op">&lt;</span>DirEntry<span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> f <span class="op">=</span> <span class="op">|</span>res<span class="op">:</span> <span class="op">&amp;</span>IOResult<span class="op">&lt;</span>DirEntry<span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">|</span> res<span class="op">.</span>as_ref()<span class="op">.</span>ok()<span class="op">.</span>filter(<span class="op">|</span>f<span class="op">|</span> <span class="op">{</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file_name <span class="op">=</span> f<span class="op">.</span>file_name()<span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file_name <span class="op">=</span> file_name<span class="op">.</span>to_str()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// keep only regular files</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        f<span class="op">.</span>file_type()<span class="op">.</span>unwrap()<span class="op">.</span>is_file() <span class="op">&amp;&amp;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... whose names start with the set name,</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        file_name<span class="op">.</span>starts_with(set) <span class="op">&amp;&amp;</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... continue with an integer between 0 and 15,</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        file_name[set<span class="op">.</span>len()<span class="op">..</span>]</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>split(<span class="ch">&#39;_&#39;</span>)<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>()<span class="op">.</span>ok()</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>n<span class="op">|</span> r<span class="op">.</span>contains(n))<span class="op">.</span>is_some() <span class="op">&amp;&amp;</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... and end with `_inst.dat` (for &quot;instance&quot;).</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        file_name<span class="op">.</span>ends_with(<span class="st">&quot;_inst.dat&quot;</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)<span class="op">.</span>is_some()<span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(read_dir(<span class="st">&quot;./ds/&quot;</span>)<span class="op">?.</span>filter(f)<span class="op">.</span>collect())</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>problem<span class="op">-</span>instance<span class="op">-</span>definition<span class="op">&gt;&gt;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>solution<span class="op">-</span>definition<span class="op">&gt;&gt;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>parser<span class="op">&gt;&gt;</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> IteratorRandomWeighted<span class="op">:</span> <span class="bu">Iterator</span> <span class="op">+</span> <span class="bu">Sized</span> <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> choose_weighted<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="op">?</span><span class="bu">Sized</span><span class="op">,</span> W<span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng<span class="op">,</span> f<span class="op">:</span> <span class="kw">fn</span>(<span class="dt">Self</span><span class="pp">::</span>Item) <span class="op">-&gt;</span> W) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">Self</span><span class="pp">::</span>Item<span class="op">&gt;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        Rng<span class="op">:</span> <span class="pp">rand::</span>Rng<span class="op">,</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        W<span class="op">:</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="pp">core::ops::</span><span class="bu">AddAssign</span><span class="op">&lt;&amp;</span><span class="ot">&#39;a</span> W<span class="op">&gt;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="pp">rand::distributions::uniform::</span>SampleUniform</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="pp">std::cmp::</span><span class="bu">PartialOrd</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="bu">Default</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">rand::prelude::</span><span class="op">*;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> dist <span class="op">=</span> <span class="pp">rand::distributions::WeightedIndex::</span>new(<span class="kw">self</span><span class="op">.</span>clone()<span class="op">.</span>map(f))<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>nth(dist<span class="op">.</span>sample(rng))</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span><span class="op">&lt;</span>I<span class="op">&gt;</span> IteratorRandomWeighted <span class="kw">for</span> I <span class="kw">where</span> I<span class="op">:</span> <span class="bu">Iterator</span> <span class="op">+</span> <span class="bu">Sized</span> <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{}</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Instance <span class="op">{</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>dpw<span class="op">&gt;&gt;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>dpc<span class="op">&gt;&gt;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>fptas<span class="op">&gt;&gt;</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>greedy<span class="op">&gt;&gt;</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>greedy<span class="op">-</span>redux<span class="op">&gt;&gt;</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>bb<span class="op">&gt;&gt;</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>bf<span class="op">&gt;&gt;</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span>solver<span class="op">-</span>sa<span class="op">&gt;&gt;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>tests<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
<p>Řešení v podobě datové struktury <code>Solution</code> má kromě reference na instanci problému především bit array udávající množinu předmětů v pomyslném batohu. Zároveň nese informaci o počtu navštívených konfigurací při jeho výpočtu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solution-definition-container" aria-controls="solution-definition-container">&lt;&lt;solution-definition&gt;&gt;=</button>
<div id="solution-definition-container" class="collapse">
<div class="sourceCode" id="solution-definition" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solution-definition-1"><a href="#solution-definition-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">type</span> Config <span class="op">=</span> <span class="pp">BitArr!</span>(<span class="kw">for</span> <span class="dv">64</span>)<span class="op">;</span></span>
<span id="solution-definition-2"><a href="#solution-definition-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-3"><a href="#solution-definition-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="solution-definition-4"><a href="#solution-definition-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span> weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> <span class="kw">pub</span> cost<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> cfg<span class="op">:</span> Config<span class="op">,</span> <span class="kw">pub</span> inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance <span class="op">}</span></span>
<span id="solution-definition-5"><a href="#solution-definition-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-6"><a href="#solution-definition-6" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="solution-definition-7"><a href="#solution-definition-7" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> OptimalSolution <span class="op">{</span> id<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> <span class="kw">pub</span> cost<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> cfg<span class="op">:</span> Config <span class="op">}</span></span>
<span id="solution-definition-8"><a href="#solution-definition-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-9"><a href="#solution-definition-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>solution<span class="op">-</span>helpers<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
<p>Protože se strukturami typu <code>Solution</code> se v algoritmech pracuje hojně, implementoval jsem pro ně koncept řazení a pomocné metody k počítání navštívených konfigurací a přidávání předmětů do batohu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solution-helpers-container" aria-controls="solution-helpers-container">&lt;&lt;solution-helpers&gt;&gt;=</button>
<div id="solution-helpers-container" class="collapse">
<div class="sourceCode" id="solution-helpers" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solution-helpers-1"><a href="#solution-helpers-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="bu">PartialOrd</span> <span class="kw">for</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-2"><a href="#solution-helpers-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> partial_cmp(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">cmp::</span>Ordering<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-3"><a href="#solution-helpers-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">cmp::</span>Ordering<span class="op">;</span></span>
<span id="solution-helpers-4"><a href="#solution-helpers-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> Solution <span class="op">{</span>weight<span class="op">,</span> cost<span class="op">,</span> <span class="op">..}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="solution-helpers-5"><a href="#solution-helpers-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(<span class="kw">match</span> cost<span class="op">.</span>cmp(<span class="op">&amp;</span>other<span class="op">.</span>cost) <span class="op">{</span></span>
<span id="solution-helpers-6"><a href="#solution-helpers-6" aria-hidden="true" tabindex="-1"></a>            <span class="pp">Ordering::</span>Equal <span class="op">=&gt;</span> weight<span class="op">.</span>cmp(<span class="op">&amp;</span>other<span class="op">.</span>weight)<span class="op">.</span>reverse()<span class="op">,</span></span>
<span id="solution-helpers-7"><a href="#solution-helpers-7" aria-hidden="true" tabindex="-1"></a>            other <span class="op">=&gt;</span> other<span class="op">,</span></span>
<span id="solution-helpers-8"><a href="#solution-helpers-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>)</span>
<span id="solution-helpers-9"><a href="#solution-helpers-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-10"><a href="#solution-helpers-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-11"><a href="#solution-helpers-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-12"><a href="#solution-helpers-12" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="bu">Ord</span> <span class="kw">for</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-13"><a href="#solution-helpers-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> cmp(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Self</span>) <span class="op">-&gt;</span> <span class="pp">cmp::</span>Ordering <span class="op">{</span></span>
<span id="solution-helpers-14"><a href="#solution-helpers-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>partial_cmp(other)<span class="op">.</span>unwrap()</span>
<span id="solution-helpers-15"><a href="#solution-helpers-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-16"><a href="#solution-helpers-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-17"><a href="#solution-helpers-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-18"><a href="#solution-helpers-18" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-19"><a href="#solution-helpers-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> with(<span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-20"><a href="#solution-helpers-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>set(i<span class="op">,</span> <span class="cn">true</span>)</span>
<span id="solution-helpers-21"><a href="#solution-helpers-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-22"><a href="#solution-helpers-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-23"><a href="#solution-helpers-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> without(<span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-24"><a href="#solution-helpers-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>set(i<span class="op">,</span> <span class="cn">false</span>)</span>
<span id="solution-helpers-25"><a href="#solution-helpers-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-26"><a href="#solution-helpers-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-27"><a href="#solution-helpers-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> invert(<span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-28"><a href="#solution-helpers-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>items<span class="op">.</span>len() <span class="op">{</span></span>
<span id="solution-helpers-29"><a href="#solution-helpers-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>set(i<span class="op">,</span> <span class="op">!</span><span class="kw">self</span><span class="op">.</span>cfg[i])<span class="op">;</span></span>
<span id="solution-helpers-30"><a href="#solution-helpers-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-helpers-31"><a href="#solution-helpers-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span></span>
<span id="solution-helpers-32"><a href="#solution-helpers-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-33"><a href="#solution-helpers-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-34"><a href="#solution-helpers-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> set(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> set<span class="op">:</span> <span class="dt">bool</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-35"><a href="#solution-helpers-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (w<span class="op">,</span> c) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>items[i]<span class="op">;</span></span>
<span id="solution-helpers-36"><a href="#solution-helpers-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> k <span class="op">=</span> <span class="kw">if</span> set <span class="op">{</span> <span class="dv">1</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="op">-</span><span class="dv">1</span> <span class="op">};</span></span>
<span id="solution-helpers-37"><a href="#solution-helpers-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">self</span><span class="op">.</span>cfg[i] <span class="op">!=</span> set <span class="op">{</span></span>
<span id="solution-helpers-38"><a href="#solution-helpers-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>cfg<span class="op">.</span>set(i<span class="op">,</span> set)<span class="op">;</span></span>
<span id="solution-helpers-39"><a href="#solution-helpers-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>weight <span class="op">=</span> (<span class="kw">self</span><span class="op">.</span>weight <span class="kw">as</span> <span class="dt">i32</span> <span class="op">+</span> k <span class="op">*</span> w <span class="kw">as</span> <span class="dt">i32</span>) <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="solution-helpers-40"><a href="#solution-helpers-40" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>cost   <span class="op">=</span> (<span class="kw">self</span><span class="op">.</span>cost   <span class="kw">as</span> <span class="dt">i32</span> <span class="op">+</span> k <span class="op">*</span> c <span class="kw">as</span> <span class="dt">i32</span>) <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="solution-helpers-41"><a href="#solution-helpers-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-helpers-42"><a href="#solution-helpers-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span><span class="kw">self</span></span>
<span id="solution-helpers-43"><a href="#solution-helpers-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-44"><a href="#solution-helpers-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-45"><a href="#solution-helpers-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> default(inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-46"><a href="#solution-helpers-46" aria-hidden="true" tabindex="-1"></a>        Solution <span class="op">{</span> weight<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> cost<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> cfg<span class="op">:</span> <span class="pp">Config::</span><span class="kw">default</span>()<span class="op">,</span> inst <span class="op">}</span></span>
<span id="solution-helpers-47"><a href="#solution-helpers-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-48"><a href="#solution-helpers-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-49"><a href="#solution-helpers-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> overweight(inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-50"><a href="#solution-helpers-50" aria-hidden="true" tabindex="-1"></a>        Solution <span class="op">{</span> weight<span class="op">:</span> <span class="dt">u32</span><span class="pp">::</span><span class="cn">MAX</span><span class="op">,</span> cost<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> cfg<span class="op">:</span> <span class="pp">Config::</span><span class="kw">default</span>()<span class="op">,</span> inst <span class="op">}</span></span>
<span id="solution-helpers-51"><a href="#solution-helpers-51" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-52"><a href="#solution-helpers-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-53"><a href="#solution-helpers-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> trim<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="op">?</span><span class="bu">Sized</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng) <span class="kw">where</span> Rng<span class="op">:</span> <span class="pp">rand::</span>Rng <span class="op">{</span></span>
<span id="solution-helpers-54"><a href="#solution-helpers-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="kw">self</span><span class="op">.</span>weight <span class="op">&gt;</span> <span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>m <span class="op">{</span></span>
<span id="solution-helpers-55"><a href="#solution-helpers-55" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>set(rng<span class="op">.</span>gen_range(<span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>items<span class="op">.</span>len())<span class="op">,</span> <span class="cn">false</span>)<span class="op">;</span></span>
<span id="solution-helpers-56"><a href="#solution-helpers-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-helpers-57"><a href="#solution-helpers-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-58"><a href="#solution-helpers-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3 id="algoritmy">Algoritmy</h3>
<p>Aby bylo k jednotlivým implementacím jednoduché přistupovat, všechny implementované algoritmy jsou uloženy pod svými názvy v <code>BTreeMap</code>ě. Tu používáme při vybírání algoritmu pomocí argumentu předaného na příkazové řádce, v testovacím kódu na testy všech implementací atp.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#algorithm-map-container" aria-controls="algorithm-map-container">&lt;&lt;algorithm-map&gt;&gt;=</button>
<div id="algorithm-map-container" class="collapse">
<div class="sourceCode" id="algorithm-map" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="algorithm-map-1"><a href="#algorithm-map-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> get_algorithms() <span class="op">-&gt;</span> BTreeMap<span class="op">&lt;&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span><span class="op">,</span> <span class="kw">fn</span>(<span class="op">&amp;</span>Instance) <span class="op">-&gt;</span> Solution<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="algorithm-map-2"><a href="#algorithm-map-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cast <span class="op">=</span> <span class="op">|</span>x<span class="op">:</span> <span class="kw">fn</span>(<span class="op">&amp;</span>Instance) <span class="op">-&gt;</span> Solution<span class="op">|</span> x<span class="op">;</span></span>
<span id="algorithm-map-3"><a href="#algorithm-map-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// the BTreeMap works as a trie, maintaining alphabetic order</span></span>
<span id="algorithm-map-4"><a href="#algorithm-map-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">BTreeMap::</span>from([</span>
<span id="algorithm-map-5"><a href="#algorithm-map-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;bf&quot;</span><span class="op">,</span>     cast(<span class="pp">Instance::</span>brute_force))<span class="op">,</span></span>
<span id="algorithm-map-6"><a href="#algorithm-map-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;bb&quot;</span><span class="op">,</span>     cast(<span class="pp">Instance::</span>branch_and_bound))<span class="op">,</span></span>
<span id="algorithm-map-7"><a href="#algorithm-map-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpc&quot;</span><span class="op">,</span>    cast(<span class="pp">Instance::</span>dynamic_programming_c))<span class="op">,</span></span>
<span id="algorithm-map-8"><a href="#algorithm-map-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpw&quot;</span><span class="op">,</span>    cast(<span class="pp">Instance::</span>dynamic_programming_w))<span class="op">,</span></span>
<span id="algorithm-map-9"><a href="#algorithm-map-9" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas1&quot;</span><span class="op">,</span> cast(<span class="op">|</span>inst<span class="op">|</span> inst<span class="op">.</span>fptas(<span class="dv">10f64</span><span class="op">.</span>powi(<span class="op">-</span><span class="dv">1</span>))))<span class="op">,</span></span>
<span id="algorithm-map-10"><a href="#algorithm-map-10" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas2&quot;</span><span class="op">,</span> cast(<span class="op">|</span>inst<span class="op">|</span> inst<span class="op">.</span>fptas(<span class="dv">10f64</span><span class="op">.</span>powi(<span class="op">-</span><span class="dv">2</span>))))<span class="op">,</span></span>
<span id="algorithm-map-11"><a href="#algorithm-map-11" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;greedy&quot;</span><span class="op">,</span> cast(<span class="pp">Instance::</span>greedy))<span class="op">,</span></span>
<span id="algorithm-map-12"><a href="#algorithm-map-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;redux&quot;</span><span class="op">,</span>  cast(<span class="pp">Instance::</span>greedy_redux))<span class="op">,</span></span>
<span id="algorithm-map-13"><a href="#algorithm-map-13" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="algorithm-map-14"><a href="#algorithm-map-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="hladový-přístup">Hladový přístup</h4>
<p>Implementace hladové strategie využívá knihovny <a href="https://crates.io/crates/permutation"><code>permutation</code></a>. Problém ve skutečnosti řešíme na isomorfní instanci, která má předměty uspořádané. Jediné, co se změní, je pořadí, ve kterém předměty navštěvujeme. Proto stačí aplikovat řadicí permutaci předmětů na posloupnost indexů, které procházíme. Přesně to dělá výraz <code>(0..items.len()).map(ord)</code>.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-greedy-container" aria-controls="solver-greedy-container">&lt;&lt;solver-greedy&gt;&gt;=</button>
<div id="solver-greedy-container" class="collapse">
<div class="sourceCode" id="solver-greedy" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-greedy-1"><a href="#solver-greedy-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> greedy(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-greedy-2"><a href="#solver-greedy-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">::permutation::</span><span class="op">*;</span></span>
<span id="solver-greedy-3"><a href="#solver-greedy-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> Instance <span class="op">{</span>m<span class="op">,</span> items<span class="op">,</span> <span class="op">..}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="solver-greedy-4"><a href="#solver-greedy-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> ratio((w<span class="op">,</span> c)<span class="op">:</span> (<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="solver-greedy-5"><a href="#solver-greedy-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> r <span class="op">=</span> c <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> w <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solver-greedy-6"><a href="#solver-greedy-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> r<span class="op">.</span>is_nan() <span class="op">{</span> <span class="dt">f64</span><span class="pp">::</span><span class="cn">NEG_INFINITY</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> r <span class="op">}</span></span>
<span id="solver-greedy-7"><a href="#solver-greedy-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-greedy-8"><a href="#solver-greedy-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> permutation <span class="op">=</span> sort_by(</span>
<span id="solver-greedy-9"><a href="#solver-greedy-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span>(items)[<span class="op">..</span>]<span class="op">,</span></span>
<span id="solver-greedy-10"><a href="#solver-greedy-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span>a<span class="op">,</span> b<span class="op">|</span></span>
<span id="solver-greedy-11"><a href="#solver-greedy-11" aria-hidden="true" tabindex="-1"></a>            ratio(<span class="op">*</span>a)</span>
<span id="solver-greedy-12"><a href="#solver-greedy-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>partial_cmp(<span class="op">&amp;</span>ratio(<span class="op">*</span>b))</span>
<span id="solver-greedy-13"><a href="#solver-greedy-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>unwrap()</span>
<span id="solver-greedy-14"><a href="#solver-greedy-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>reverse() <span class="co">// max item first</span></span>
<span id="solver-greedy-15"><a href="#solver-greedy-15" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="solver-greedy-16"><a href="#solver-greedy-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ord <span class="op">=</span> <span class="op">{</span> <span class="at">#[</span>inline<span class="at">]</span> <span class="op">|</span>i<span class="op">|</span> permutation<span class="op">.</span>apply_idx(i) <span class="op">};</span></span>
<span id="solver-greedy-17"><a href="#solver-greedy-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-greedy-18"><a href="#solver-greedy-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> sol <span class="op">=</span> <span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">;</span></span>
<span id="solver-greedy-19"><a href="#solver-greedy-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> i <span class="kw">in</span> (<span class="dv">0</span><span class="op">..</span>items<span class="op">.</span>len())<span class="op">.</span>map(ord) <span class="op">{</span></span>
<span id="solver-greedy-20"><a href="#solver-greedy-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (w<span class="op">,</span> _c) <span class="op">=</span> items[i]<span class="op">;</span></span>
<span id="solver-greedy-21"><a href="#solver-greedy-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> sol<span class="op">.</span>weight <span class="op">+</span> w <span class="op">&lt;=</span> <span class="op">*</span>m <span class="op">{</span></span>
<span id="solver-greedy-22"><a href="#solver-greedy-22" aria-hidden="true" tabindex="-1"></a>            sol <span class="op">=</span> sol<span class="op">.</span>with(i)<span class="op">;</span></span>
<span id="solver-greedy-23"><a href="#solver-greedy-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="kw">break</span> <span class="op">}</span></span>
<span id="solver-greedy-24"><a href="#solver-greedy-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-greedy-25"><a href="#solver-greedy-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-greedy-26"><a href="#solver-greedy-26" aria-hidden="true" tabindex="-1"></a>    sol</span>
<span id="solver-greedy-27"><a href="#solver-greedy-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="hladový-přístup-redux">Hladový přístup – redux</h4>
<p>Redux verze hladové strategie je více méně deklarativní. Výsledek redux algoritmu je maximum z hladového řešení a řešení sestávajícího pouze z nejdražšího předmětu. K indexu nejdražšího předmětu dojdeme tak, že sepneme posloupnosti indexů a předmětů, vyřadíme prvky, jejichž váha přesahuje kapacitu batohu a vybereme maximální prvek podle ceny.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-greedy-redux-container" aria-controls="solver-greedy-redux-container">&lt;&lt;solver-greedy-redux&gt;&gt;=</button>
<div id="solver-greedy-redux-container" class="collapse">
<div class="sourceCode" id="solver-greedy-redux" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-greedy-redux-1"><a href="#solver-greedy-redux-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> greedy_redux(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-greedy-redux-2"><a href="#solver-greedy-redux-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> greedy <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>greedy()<span class="op">;</span></span>
<span id="solver-greedy-redux-3"><a href="#solver-greedy-redux-3" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">0_usize</span><span class="op">..</span>)</span>
<span id="solver-greedy-redux-4"><a href="#solver-greedy-redux-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>zip(<span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>iter())</span>
<span id="solver-greedy-redux-5"><a href="#solver-greedy-redux-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>(_<span class="op">,</span> (w<span class="op">,</span> _))<span class="op">|</span> <span class="op">*</span>w <span class="op">&lt;=</span> <span class="kw">self</span><span class="op">.</span>m)</span>
<span id="solver-greedy-redux-6"><a href="#solver-greedy-redux-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>max_by_key(<span class="op">|</span>(_<span class="op">,</span> (_<span class="op">,</span> c))<span class="op">|</span> c)</span>
<span id="solver-greedy-redux-7"><a href="#solver-greedy-redux-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>(highest_price_index<span class="op">,</span> _)<span class="op">|</span></span>
<span id="solver-greedy-redux-8"><a href="#solver-greedy-redux-8" aria-hidden="true" tabindex="-1"></a>            max(greedy<span class="op">,</span> <span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">.</span>with(highest_price_index))</span>
<span id="solver-greedy-redux-9"><a href="#solver-greedy-redux-9" aria-hidden="true" tabindex="-1"></a>        )<span class="op">.</span>unwrap_or(greedy)</span>
<span id="solver-greedy-redux-10"><a href="#solver-greedy-redux-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="hrubá-síla">Hrubá síla</h4>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-bf-container" aria-controls="solver-bf-container">&lt;&lt;solver-bf&gt;&gt;=</button>
<div id="solver-bf-container" class="collapse">
<div class="sourceCode" id="solver-bf" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-bf-1"><a href="#solver-bf-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> brute_force(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-bf-2"><a href="#solver-bf-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> go<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span>(items<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> [(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)]<span class="op">,</span> current<span class="op">:</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;,</span> i<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> m<span class="op">:</span> <span class="dt">u32</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solver-bf-3"><a href="#solver-bf-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> i <span class="op">&gt;=</span> items<span class="op">.</span>len() <span class="op">{</span> <span class="kw">return</span> current <span class="op">}</span></span>
<span id="solver-bf-4"><a href="#solver-bf-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bf-5"><a href="#solver-bf-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (w<span class="op">,</span> _c) <span class="op">=</span> items[i]<span class="op">;</span></span>
<span id="solver-bf-6"><a href="#solver-bf-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> next <span class="op">=</span> <span class="op">|</span>current<span class="op">,</span> m<span class="op">|</span> go(items<span class="op">,</span> current<span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> m)<span class="op">;</span></span>
<span id="solver-bf-7"><a href="#solver-bf-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> include <span class="op">=</span> <span class="op">||</span> <span class="op">{</span></span>
<span id="solver-bf-8"><a href="#solver-bf-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> current <span class="op">=</span> current<span class="op">.</span>with(i)<span class="op">;</span></span>
<span id="solver-bf-9"><a href="#solver-bf-9" aria-hidden="true" tabindex="-1"></a>            next(current<span class="op">,</span> m <span class="op">-</span> w)</span>
<span id="solver-bf-10"><a href="#solver-bf-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="solver-bf-11"><a href="#solver-bf-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> exclude <span class="op">=</span> <span class="op">||</span> next(current<span class="op">,</span> m)<span class="op">;</span></span>
<span id="solver-bf-12"><a href="#solver-bf-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bf-13"><a href="#solver-bf-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> w <span class="op">&lt;=</span> m <span class="op">{</span></span>
<span id="solver-bf-14"><a href="#solver-bf-14" aria-hidden="true" tabindex="-1"></a>            max(include()<span class="op">,</span> exclude())</span>
<span id="solver-bf-15"><a href="#solver-bf-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-bf-16"><a href="#solver-bf-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="op">{</span> exclude() <span class="op">}</span></span>
<span id="solver-bf-17"><a href="#solver-bf-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-bf-18"><a href="#solver-bf-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bf-19"><a href="#solver-bf-19" aria-hidden="true" tabindex="-1"></a>    go(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>items<span class="op">,</span> <span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span>m)</span>
<span id="solver-bf-20"><a href="#solver-bf-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="branch-bound">Branch &amp; bound</h4>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-bb-container" aria-controls="solver-bb-container">&lt;&lt;solver-bb&gt;&gt;=</button>
<div id="solver-bb-container" class="collapse">
<div class="sourceCode" id="solver-bb" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-bb-1"><a href="#solver-bb-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> branch_and_bound(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-bb-2"><a href="#solver-bb-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> State<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="ot">&#39;a</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">&gt;,</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>)<span class="op">;</span></span>
<span id="solver-bb-3"><a href="#solver-bb-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> prices<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="solver-bb-4"><a href="#solver-bb-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>iter()<span class="op">.</span>rev()</span>
<span id="solver-bb-5"><a href="#solver-bb-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>scan(<span class="dv">0</span><span class="op">,</span> <span class="op">|</span>sum<span class="op">,</span> (_w<span class="op">,</span> c)<span class="op">|</span> <span class="op">{</span></span>
<span id="solver-bb-6"><a href="#solver-bb-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">*</span>sum <span class="op">+=</span> c<span class="op">;</span></span>
<span id="solver-bb-7"><a href="#solver-bb-7" aria-hidden="true" tabindex="-1"></a>            <span class="cn">Some</span>(<span class="op">*</span>sum)</span>
<span id="solver-bb-8"><a href="#solver-bb-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>)</span>
<span id="solver-bb-9"><a href="#solver-bb-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()<span class="op">.</span>into_iter()<span class="op">.</span>rev()<span class="op">.</span>collect()</span>
<span id="solver-bb-10"><a href="#solver-bb-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="solver-bb-11"><a href="#solver-bb-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bb-12"><a href="#solver-bb-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> go<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span>(state<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> State<span class="op">,</span> current<span class="op">:</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;,</span> best<span class="op">:</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;,</span> i<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> m<span class="op">:</span> <span class="dt">u32</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solver-bb-13"><a href="#solver-bb-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> State(items<span class="op">,</span> prices) <span class="op">=</span> state<span class="op">;</span></span>
<span id="solver-bb-14"><a href="#solver-bb-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> i <span class="op">&gt;=</span> items<span class="op">.</span>len() <span class="op">||</span> current<span class="op">.</span>cost <span class="op">+</span> prices[i] <span class="op">&lt;=</span> best<span class="op">.</span>cost <span class="op">{</span></span>
<span id="solver-bb-15"><a href="#solver-bb-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> current</span>
<span id="solver-bb-16"><a href="#solver-bb-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-bb-17"><a href="#solver-bb-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bb-18"><a href="#solver-bb-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (w<span class="op">,</span> _c) <span class="op">=</span> items[i]<span class="op">;</span></span>
<span id="solver-bb-19"><a href="#solver-bb-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> next <span class="op">=</span> <span class="op">|</span>current<span class="op">,</span> best<span class="op">,</span> m<span class="op">|</span> go(state<span class="op">,</span> current<span class="op">,</span> best<span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> m)<span class="op">;</span></span>
<span id="solver-bb-20"><a href="#solver-bb-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> include <span class="op">=</span> <span class="op">||</span> <span class="op">{</span></span>
<span id="solver-bb-21"><a href="#solver-bb-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> current <span class="op">=</span> current<span class="op">.</span>with(i)<span class="op">;</span></span>
<span id="solver-bb-22"><a href="#solver-bb-22" aria-hidden="true" tabindex="-1"></a>            next(current<span class="op">,</span> max(current<span class="op">,</span> best)<span class="op">,</span> m <span class="op">-</span> w)</span>
<span id="solver-bb-23"><a href="#solver-bb-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="solver-bb-24"><a href="#solver-bb-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> exclude <span class="op">=</span> <span class="op">|</span>best<span class="op">:</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;|</span> next(current<span class="op">,</span> best<span class="op">,</span> m)<span class="op">;</span></span>
<span id="solver-bb-25"><a href="#solver-bb-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bb-26"><a href="#solver-bb-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> w <span class="op">&lt;=</span> m <span class="op">{</span></span>
<span id="solver-bb-27"><a href="#solver-bb-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> x <span class="op">=</span> include()<span class="op">;</span></span>
<span id="solver-bb-28"><a href="#solver-bb-28" aria-hidden="true" tabindex="-1"></a>            max(x<span class="op">,</span> exclude(x))</span>
<span id="solver-bb-29"><a href="#solver-bb-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-bb-30"><a href="#solver-bb-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">else</span> <span class="op">{</span> exclude(best) <span class="op">}</span></span>
<span id="solver-bb-31"><a href="#solver-bb-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-bb-32"><a href="#solver-bb-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-bb-33"><a href="#solver-bb-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">FIXME</span><span class="co"> borrowck issues</span></span>
<span id="solver-bb-34"><a href="#solver-bb-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> state <span class="op">=</span> State(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>items<span class="op">,</span> prices)<span class="op">;</span></span>
<span id="solver-bb-35"><a href="#solver-bb-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> empty <span class="op">=</span> <span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">;</span></span>
<span id="solver-bb-36"><a href="#solver-bb-36" aria-hidden="true" tabindex="-1"></a>    Solution <span class="op">{</span> inst<span class="op">:</span> <span class="kw">self</span><span class="op">,</span> <span class="op">..</span>go(<span class="op">&amp;</span>state<span class="op">,</span> empty<span class="op">,</span> empty<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span>m) <span class="op">}</span></span>
<span id="solver-bb-37"><a href="#solver-bb-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="dynamické-programování">Dynamické programování</h4>
<p>Dynamické programování s rozkladem podle váhy jsem implementoval už v prvním úkolu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-dpw-container" aria-controls="solver-dpw-container">&lt;&lt;solver-dpw&gt;&gt;=</button>
<div id="solver-dpw-container" class="collapse">
<div class="sourceCode" id="solver-dpw" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-dpw-1"><a href="#solver-dpw-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> dynamic_programming_w(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-dpw-2"><a href="#solver-dpw-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> Instance <span class="op">{</span>m<span class="op">,</span> items<span class="op">,</span> <span class="op">..}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="solver-dpw-3"><a href="#solver-dpw-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> next <span class="op">=</span> <span class="pp">vec!</span>[<span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">;</span> <span class="op">*</span>m <span class="kw">as</span> <span class="dt">usize</span> <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="solver-dpw-4"><a href="#solver-dpw-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> last <span class="op">=</span> <span class="pp">vec!</span>[]<span class="op">;</span></span>
<span id="solver-dpw-5"><a href="#solver-dpw-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpw-6"><a href="#solver-dpw-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> (i<span class="op">,</span> <span class="op">&amp;</span>(weight<span class="op">,</span> _cost)) <span class="kw">in</span> items<span class="op">.</span>iter()<span class="op">.</span>enumerate() <span class="op">{</span></span>
<span id="solver-dpw-7"><a href="#solver-dpw-7" aria-hidden="true" tabindex="-1"></a>        last<span class="op">.</span>clone_from(<span class="op">&amp;</span>next)<span class="op">;</span></span>
<span id="solver-dpw-8"><a href="#solver-dpw-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpw-9"><a href="#solver-dpw-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> cap <span class="kw">in</span> <span class="dv">0</span> <span class="op">..=</span> <span class="op">*</span>m <span class="kw">as</span> <span class="dt">usize</span> <span class="op">{</span></span>
<span id="solver-dpw-10"><a href="#solver-dpw-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> s <span class="op">=</span> <span class="kw">if</span> (cap <span class="kw">as</span> <span class="dt">u32</span>) <span class="op">&lt;</span> weight <span class="op">{</span></span>
<span id="solver-dpw-11"><a href="#solver-dpw-11" aria-hidden="true" tabindex="-1"></a>                    last[cap]</span>
<span id="solver-dpw-12"><a href="#solver-dpw-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="solver-dpw-13"><a href="#solver-dpw-13" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> rem_weight <span class="op">=</span> max(<span class="dv">0</span><span class="op">,</span> cap <span class="kw">as</span> <span class="dt">isize</span> <span class="op">-</span> weight <span class="kw">as</span> <span class="dt">isize</span>) <span class="kw">as</span> <span class="dt">usize</span><span class="op">;</span></span>
<span id="solver-dpw-14"><a href="#solver-dpw-14" aria-hidden="true" tabindex="-1"></a>                    max(last[cap]<span class="op">,</span> last[rem_weight]<span class="op">.</span>with(i))</span>
<span id="solver-dpw-15"><a href="#solver-dpw-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">};</span></span>
<span id="solver-dpw-16"><a href="#solver-dpw-16" aria-hidden="true" tabindex="-1"></a>            next[cap] <span class="op">=</span> s<span class="op">;</span></span>
<span id="solver-dpw-17"><a href="#solver-dpw-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-dpw-18"><a href="#solver-dpw-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-dpw-19"><a href="#solver-dpw-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpw-20"><a href="#solver-dpw-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>next<span class="op">.</span>last()<span class="op">.</span>unwrap()</span>
<span id="solver-dpw-21"><a href="#solver-dpw-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<p>V úkolu 2 přibyla implementace dynamického programování s rozkladem podle ceny, které je adaptací algoritmu výše. Narozdíl od předchozího algoritmu je tady výchozí hodnotou v tabulce efektivně nekonečná váha, kterou se snažíme minimalizovat. K reprezentaci řešení s nekonečnou vahou používám přidruženou funkci <code>Solution::overweight</code>, která vrátí neplatné řešení s váhou <span class="math inline">\(2^{32} - 1\)</span>. Pokud na něj v průběhu výpočtu algoritmus narazí, předá jej dál jako <code>Solution::default</code> (vždy v nejlevějším sloupci DP tabulky, tedy <code>last[0]</code>), aby při přičtení váhy uvažovaného předmětu nedošlo k přetečení.</p>
<p>O výběr řešení minimální váhy se stará funkce <code>max</code>, neboť implementace uspořádání pro typ <code>Solution</code> řadí nejprve vzestupně podle ceny a následně sestupně podle váhy. V tomto případě porovnáváme vždy dvě řešení stejných cen (a nebo je <code>last[cap]</code> neplatné řešení s nadváhou, které má cenu <span class="math inline">\(0\)</span>).</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-dpc-container" aria-controls="solver-dpc-container">&lt;&lt;solver-dpc&gt;&gt;=</button>
<div id="solver-dpc-container" class="collapse">
<div class="sourceCode" id="solver-dpc" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-dpc-1"><a href="#solver-dpc-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> dynamic_programming_c(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-dpc-2"><a href="#solver-dpc-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> Instance <span class="op">{</span>items<span class="op">,</span> <span class="op">..}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="solver-dpc-3"><a href="#solver-dpc-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> max_profit <span class="op">=</span> items<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(_<span class="op">,</span> c)<span class="op">|</span> <span class="op">*</span>c)<span class="op">.</span>max()<span class="op">.</span>unwrap() <span class="kw">as</span> <span class="dt">usize</span><span class="op">;</span></span>
<span id="solver-dpc-4"><a href="#solver-dpc-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> next <span class="op">=</span> <span class="pp">vec!</span>[<span class="pp">Solution::</span>overweight(<span class="kw">self</span>)<span class="op">;</span> max_profit <span class="op">*</span> items<span class="op">.</span>len() <span class="op">+</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="solver-dpc-5"><a href="#solver-dpc-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> last <span class="op">=</span> <span class="pp">vec!</span>[]<span class="op">;</span></span>
<span id="solver-dpc-6"><a href="#solver-dpc-6" aria-hidden="true" tabindex="-1"></a>    next[<span class="dv">0</span>] <span class="op">=</span> <span class="pp">Solution::</span><span class="kw">default</span>(<span class="kw">self</span>)<span class="op">;</span></span>
<span id="solver-dpc-7"><a href="#solver-dpc-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpc-8"><a href="#solver-dpc-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> (i<span class="op">,</span> <span class="op">&amp;</span>(_weight<span class="op">,</span> cost)) <span class="kw">in</span> items<span class="op">.</span>iter()<span class="op">.</span>enumerate() <span class="op">{</span></span>
<span id="solver-dpc-9"><a href="#solver-dpc-9" aria-hidden="true" tabindex="-1"></a>        last<span class="op">.</span>clone_from(<span class="op">&amp;</span>next)<span class="op">;</span></span>
<span id="solver-dpc-10"><a href="#solver-dpc-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpc-11"><a href="#solver-dpc-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> cap <span class="kw">in</span> <span class="dv">1</span> <span class="op">..=</span> max_profit <span class="op">*</span> items<span class="op">.</span>len() <span class="op">{</span></span>
<span id="solver-dpc-12"><a href="#solver-dpc-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> s <span class="op">=</span> <span class="kw">if</span> (cap <span class="kw">as</span> <span class="dt">u32</span>) <span class="op">&lt;</span> cost <span class="op">{</span></span>
<span id="solver-dpc-13"><a href="#solver-dpc-13" aria-hidden="true" tabindex="-1"></a>                    last[cap]</span>
<span id="solver-dpc-14"><a href="#solver-dpc-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="solver-dpc-15"><a href="#solver-dpc-15" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> rem_cost <span class="op">=</span> (cap <span class="kw">as</span> <span class="dt">isize</span> <span class="op">-</span> cost <span class="kw">as</span> <span class="dt">isize</span>) <span class="kw">as</span> <span class="dt">usize</span><span class="op">;</span></span>
<span id="solver-dpc-16"><a href="#solver-dpc-16" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> lightest_for_cost <span class="op">=</span> <span class="kw">if</span> last[rem_cost]<span class="op">.</span>weight <span class="op">==</span> <span class="dt">u32</span><span class="pp">::</span><span class="cn">MAX</span> <span class="op">{</span></span>
<span id="solver-dpc-17"><a href="#solver-dpc-17" aria-hidden="true" tabindex="-1"></a>                        last[<span class="dv">0</span>] <span class="co">// replace the overweight solution with the empty one</span></span>
<span id="solver-dpc-18"><a href="#solver-dpc-18" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> last[rem_cost] <span class="op">};</span></span>
<span id="solver-dpc-19"><a href="#solver-dpc-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpc-20"><a href="#solver-dpc-20" aria-hidden="true" tabindex="-1"></a>                    max(last[cap]<span class="op">,</span> lightest_for_cost<span class="op">.</span>with(i))</span>
<span id="solver-dpc-21"><a href="#solver-dpc-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">};</span></span>
<span id="solver-dpc-22"><a href="#solver-dpc-22" aria-hidden="true" tabindex="-1"></a>            next[cap] <span class="op">=</span> s<span class="op">;</span></span>
<span id="solver-dpc-23"><a href="#solver-dpc-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-dpc-24"><a href="#solver-dpc-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-dpc-25"><a href="#solver-dpc-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-dpc-26"><a href="#solver-dpc-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>next<span class="op">.</span>iter()<span class="op">.</span>filter(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>weight <span class="op">&lt;=</span> <span class="kw">self</span><span class="op">.</span>m)<span class="op">.</span>last()<span class="op">.</span>unwrap()</span>
<span id="solver-dpc-27"><a href="#solver-dpc-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="fptas">FPTAS</h4>
<p>FPTAS algoritmus přeškáluje ceny předmětů a následně spustí dynamické programování s rozkladem podle ceny na upravenou instanci problému. V řešení stačí opravit referenci výchozí instance (<code>inst: self</code>) a přepočíst cenu podle vypočítané konfigurace, samotné indexy předmětů se škálováním nemění.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-fptas-container" aria-controls="solver-fptas-container">&lt;&lt;solver-fptas&gt;&gt;=</button>
<div id="solver-fptas-container" class="collapse">
<div class="sourceCode" id="solver-fptas" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-fptas-1"><a href="#solver-fptas-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: are items heavier than the knapsack capacity a problem? if so, we</span></span>
<span id="solver-fptas-2"><a href="#solver-fptas-2" aria-hidden="true" tabindex="-1"></a><span class="co">// can just zero them out</span></span>
<span id="solver-fptas-3"><a href="#solver-fptas-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> fptas(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> eps<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="solver-fptas-4"><a href="#solver-fptas-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> Instance <span class="op">{</span>m<span class="op">:</span> _<span class="op">,</span> items<span class="op">,</span> <span class="op">..}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="solver-fptas-5"><a href="#solver-fptas-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> max_profit <span class="op">=</span> items<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(_<span class="op">,</span> c)<span class="op">|</span> <span class="op">*</span>c)<span class="op">.</span>max()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="solver-fptas-6"><a href="#solver-fptas-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> scaling_factor <span class="op">=</span> eps <span class="op">*</span> max_profit <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> items<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solver-fptas-7"><a href="#solver-fptas-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> items<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">&gt;</span> <span class="op">=</span> items<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(w<span class="op">,</span> c)<span class="op">|</span></span>
<span id="solver-fptas-8"><a href="#solver-fptas-8" aria-hidden="true" tabindex="-1"></a>        (<span class="op">*</span>w<span class="op">,</span> (<span class="op">*</span>c <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> scaling_factor)<span class="op">.</span>floor() <span class="kw">as</span> <span class="dt">u32</span></span>
<span id="solver-fptas-9"><a href="#solver-fptas-9" aria-hidden="true" tabindex="-1"></a>    ))<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="solver-fptas-10"><a href="#solver-fptas-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-fptas-11"><a href="#solver-fptas-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> iso <span class="op">=</span> Instance <span class="op">{</span> items<span class="op">,</span> <span class="op">..*</span><span class="kw">self</span> <span class="op">};</span></span>
<span id="solver-fptas-12"><a href="#solver-fptas-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sln <span class="op">=</span> iso<span class="op">.</span>dynamic_programming_c()<span class="op">;</span></span>
<span id="solver-fptas-13"><a href="#solver-fptas-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cost <span class="op">=</span> (<span class="dv">0usize</span><span class="op">..</span>)<span class="op">.</span>zip(<span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>iter())<span class="op">.</span>fold(<span class="dv">0</span><span class="op">,</span> <span class="op">|</span>acc<span class="op">,</span> (i<span class="op">,</span> (_w<span class="op">,</span> c))<span class="op">|</span></span>
<span id="solver-fptas-14"><a href="#solver-fptas-14" aria-hidden="true" tabindex="-1"></a>        acc <span class="op">+</span> sln<span class="op">.</span>cfg[i] <span class="kw">as</span> <span class="dt">u32</span> <span class="op">*</span> c</span>
<span id="solver-fptas-15"><a href="#solver-fptas-15" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="solver-fptas-16"><a href="#solver-fptas-16" aria-hidden="true" tabindex="-1"></a>    Solution <span class="op">{</span> inst<span class="op">:</span> <span class="kw">self</span><span class="op">,</span> cost<span class="op">,</span> <span class="op">..</span>sln <span class="op">}</span></span>
<span id="solver-fptas-17"><a href="#solver-fptas-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h4 id="simulované-žíhání">Simulované žíhání</h4>
<p>Iterativní metoda simulovaného žíhání se od ostatních algoritmů v několika ohledech liší.</p>
<p>Prvně vyžaduje generátor náhodných čísel a konfiguraci jako vstupní parametry a její typ proto neodpovídá ostatním metodám – v souboru <code>main.rs</code> je toto třeba ošetřit, připravit generátor a konfiguraci načíst z příkazové řádky.</p>
<p>Navíc je její přístup k prohledávání stavového prostoru založen na přidávání a odebírání předmětů z batohu narozdíl od klasických algoritmů, kde se batoh jen plní. Z tohoto důvodu bylo třeba zobecnit metodu <code>Solution::with</code> na <code>Solution::set</code>, která libovolné změny v inkluzi předmětů ergonomicky umožňuje. Má implementace využívá relaxaci – vybraný kandidát pro nový stav může dočasně překročit maximální kapacitu batohu. Před jeho zvážením a randomizovaným přijetím je ovšem kandidát opraven pomocí metody <code>Solution::trim</code>, která odebírá náhodné předměty dokud váha řešení neklesne pod danou mez.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-sa-container" aria-controls="solver-sa-container">&lt;&lt;solver-sa&gt;&gt;=</button>
<div id="solver-sa-container" class="collapse">
<div class="sourceCode" id="solver-sa" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solver-sa-1"><a href="#solver-sa-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> simulated_annealing<span class="op">&lt;</span>Rng<span class="op">&gt;</span>(</span>
<span id="solver-sa-2"><a href="#solver-sa-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span></span>
<span id="solver-sa-3"><a href="#solver-sa-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng<span class="op">,</span></span>
<span id="solver-sa-4"><a href="#solver-sa-4" aria-hidden="true" tabindex="-1"></a>    (max_iterations<span class="op">,</span> scaling_factor<span class="op">,</span> temp_modifier<span class="op">,</span> equilibrium_width)<span class="op">:</span> (<span class="dt">u32</span><span class="op">,</span> <span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span><span class="op">,</span> <span class="dt">u8</span>)</span>
<span id="solver-sa-5"><a href="#solver-sa-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Solution</span>
<span id="solver-sa-6"><a href="#solver-sa-6" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> Rng<span class="op">:</span> <span class="pp">rand::</span>Rng <span class="op">+</span> <span class="op">?</span><span class="bu">Sized</span> <span class="op">{</span></span>
<span id="solver-sa-7"><a href="#solver-sa-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> total_cost <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(_<span class="op">,</span> c)<span class="op">|</span> c)<span class="op">.</span><span class="pp">sum::</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>() <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solver-sa-8"><a href="#solver-sa-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> current <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>greedy_redux()<span class="op">;</span></span>
<span id="solver-sa-9"><a href="#solver-sa-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> best <span class="op">=</span> current<span class="op">;</span></span>
<span id="solver-sa-10"><a href="#solver-sa-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> temperature <span class="op">=</span> temp_modifier <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>greedy_redux()<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solver-sa-11"><a href="#solver-sa-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-sa-12"><a href="#solver-sa-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> iteration <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="solver-sa-13"><a href="#solver-sa-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> frozen <span class="op">=</span> <span class="op">|</span>t<span class="op">|</span> t <span class="op">&lt;</span> <span class="dv">0.00001</span><span class="op">;</span></span>
<span id="solver-sa-14"><a href="#solver-sa-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> equilibrium <span class="op">=</span> <span class="op">|</span>i<span class="op">|</span> i <span class="op">%</span> equilibrium_width <span class="kw">as</span> <span class="dt">u32</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="solver-sa-15"><a href="#solver-sa-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-sa-16"><a href="#solver-sa-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">while</span> <span class="op">!</span>frozen(temperature) <span class="op">{</span></span>
<span id="solver-sa-17"><a href="#solver-sa-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> temp <span class="op">=</span> temperature<span class="op">;</span></span>
<span id="solver-sa-18"><a href="#solver-sa-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">loop</span> <span class="op">{</span></span>
<span id="solver-sa-19"><a href="#solver-sa-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">use</span> <span class="pp">rand::prelude::</span>IteratorRandom<span class="op">;</span></span>
<span id="solver-sa-20"><a href="#solver-sa-20" aria-hidden="true" tabindex="-1"></a>            <span class="pp">println!</span>(<span class="st">&quot;    {} {} {}&quot;</span><span class="op">,</span> current<span class="op">.</span>cost<span class="op">,</span> best<span class="op">.</span>cost<span class="op">,</span> temp)<span class="op">;</span></span>
<span id="solver-sa-21"><a href="#solver-sa-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-sa-22"><a href="#solver-sa-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> next_sln <span class="op">=</span> (<span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>len())</span>
<span id="solver-sa-23"><a href="#solver-sa-23" aria-hidden="true" tabindex="-1"></a>                <span class="co">// construct the set of neighbouring solutions: generate n</span></span>
<span id="solver-sa-24"><a href="#solver-sa-24" aria-hidden="true" tabindex="-1"></a>                <span class="co">// solutions, each with one item different to the current</span></span>
<span id="solver-sa-25"><a href="#solver-sa-25" aria-hidden="true" tabindex="-1"></a>                <span class="co">// solution (included or excluded)</span></span>
<span id="solver-sa-26"><a href="#solver-sa-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>i<span class="op">|</span> current<span class="op">.</span>clone()<span class="op">.</span>set(i<span class="op">,</span> <span class="op">!</span>current<span class="op">.</span>cfg[i]))</span>
<span id="solver-sa-27"><a href="#solver-sa-27" aria-hidden="true" tabindex="-1"></a>                <span class="co">// also add a complete flip as an option</span></span>
<span id="solver-sa-28"><a href="#solver-sa-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(<span class="pp">std::iter::</span>once(current<span class="op">.</span>invert()))</span>
<span id="solver-sa-29"><a href="#solver-sa-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">// select a neighbour at random</span></span>
<span id="solver-sa-30"><a href="#solver-sa-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>choose(rng)<span class="op">;</span></span>
<span id="solver-sa-31"><a href="#solver-sa-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">match</span> next_sln <span class="op">{</span></span>
<span id="solver-sa-32"><a href="#solver-sa-32" aria-hidden="true" tabindex="-1"></a>                <span class="cn">Some</span>(<span class="kw">mut</span> new) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="solver-sa-33"><a href="#solver-sa-33" aria-hidden="true" tabindex="-1"></a>                    new<span class="op">.</span>trim(rng)<span class="op">;</span></span>
<span id="solver-sa-34"><a href="#solver-sa-34" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> delta <span class="op">=</span> (new<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">-</span> current<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span>) <span class="op">/</span> total_cost<span class="op">;</span></span>
<span id="solver-sa-35"><a href="#solver-sa-35" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> rnd <span class="op">=</span> rng<span class="op">.</span>gen_range(<span class="dv">0.0</span> <span class="op">..</span> <span class="dv">1.0</span>)<span class="op">;</span></span>
<span id="solver-sa-36"><a href="#solver-sa-36" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> threshold <span class="op">=</span> (delta <span class="op">/</span> temp)<span class="op">.</span>exp()<span class="op">;</span></span>
<span id="solver-sa-37"><a href="#solver-sa-37" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> delta <span class="op">&lt;=</span> <span class="dv">0.0</span> <span class="op">{</span></span>
<span id="solver-sa-38"><a href="#solver-sa-38" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// eprintln!(</span></span>
<span id="solver-sa-39"><a href="#solver-sa-39" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     &quot;considering {} (current {}),\tdelta {}, rnd {}, temp {},\t(will {} against {})&quot;,</span></span>
<span id="solver-sa-40"><a href="#solver-sa-40" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     new.cost,</span></span>
<span id="solver-sa-41"><a href="#solver-sa-41" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     current.cost,</span></span>
<span id="solver-sa-42"><a href="#solver-sa-42" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     delta,</span></span>
<span id="solver-sa-43"><a href="#solver-sa-43" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     rnd,</span></span>
<span id="solver-sa-44"><a href="#solver-sa-44" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     temp,</span></span>
<span id="solver-sa-45"><a href="#solver-sa-45" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     if rnd &lt; threshold { &quot;succeed&quot; } else { &quot;fail&quot; },</span></span>
<span id="solver-sa-46"><a href="#solver-sa-46" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//     threshold,</span></span>
<span id="solver-sa-47"><a href="#solver-sa-47" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// );</span></span>
<span id="solver-sa-48"><a href="#solver-sa-48" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="solver-sa-49"><a href="#solver-sa-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-sa-50"><a href="#solver-sa-50" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span>  delta <span class="op">&gt;</span> <span class="dv">0.0</span> <span class="co">// the new state is better, accept it right away</span></span>
<span id="solver-sa-51"><a href="#solver-sa-51" aria-hidden="true" tabindex="-1"></a>                    <span class="op">||</span> <span class="co">// otherwise accept with probability proportional to the cost delta and the temp</span></span>
<span id="solver-sa-52"><a href="#solver-sa-52" aria-hidden="true" tabindex="-1"></a>                        rnd <span class="op">&lt;</span> threshold <span class="op">{</span></span>
<span id="solver-sa-53"><a href="#solver-sa-53" aria-hidden="true" tabindex="-1"></a>                        current <span class="op">=</span> new<span class="op">;</span></span>
<span id="solver-sa-54"><a href="#solver-sa-54" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> current<span class="op">.</span>cost <span class="op">&gt;</span> best<span class="op">.</span>cost <span class="op">{</span></span>
<span id="solver-sa-55"><a href="#solver-sa-55" aria-hidden="true" tabindex="-1"></a>                            best <span class="op">=</span> current<span class="op">;</span></span>
<span id="solver-sa-56"><a href="#solver-sa-56" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="solver-sa-57"><a href="#solver-sa-57" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="solver-sa-58"><a href="#solver-sa-58" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="solver-sa-59"><a href="#solver-sa-59" aria-hidden="true" tabindex="-1"></a>                <span class="cn">None</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="solver-sa-60"><a href="#solver-sa-60" aria-hidden="true" tabindex="-1"></a>                    <span class="pp">println!</span>(<span class="st">&quot;  early return @ {}, temp {}&quot;</span><span class="op">,</span> iteration<span class="op">,</span> temp)<span class="op">;</span></span>
<span id="solver-sa-61"><a href="#solver-sa-61" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> best</span>
<span id="solver-sa-62"><a href="#solver-sa-62" aria-hidden="true" tabindex="-1"></a>                <span class="op">},</span></span>
<span id="solver-sa-63"><a href="#solver-sa-63" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="solver-sa-64"><a href="#solver-sa-64" aria-hidden="true" tabindex="-1"></a>            iteration <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="solver-sa-65"><a href="#solver-sa-65" aria-hidden="true" tabindex="-1"></a>            temperature <span class="op">*=</span> scaling_factor<span class="op">;</span></span>
<span id="solver-sa-66"><a href="#solver-sa-66" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> iteration <span class="op">&gt;=</span> max_iterations <span class="op">{</span></span>
<span id="solver-sa-67"><a href="#solver-sa-67" aria-hidden="true" tabindex="-1"></a>                <span class="pp">println!</span>(<span class="st">&quot;  iteration limit exhausted&quot;</span>)<span class="op">;</span></span>
<span id="solver-sa-68"><a href="#solver-sa-68" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> best</span>
<span id="solver-sa-69"><a href="#solver-sa-69" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> equilibrium(iteration) <span class="op">{</span> <span class="kw">break</span> <span class="op">}</span></span>
<span id="solver-sa-70"><a href="#solver-sa-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solver-sa-71"><a href="#solver-sa-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solver-sa-72"><a href="#solver-sa-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="solver-sa-73"><a href="#solver-sa-73" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;  frozen @ {}, temp {}&quot;</span><span class="op">,</span> iteration<span class="op">,</span> temperature <span class="op">/</span> scaling_factor)<span class="op">;</span></span>
<span id="solver-sa-74"><a href="#solver-sa-74" aria-hidden="true" tabindex="-1"></a>    best</span>
<span id="solver-sa-75"><a href="#solver-sa-75" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h2 id="závěr">Závěr</h2>
<p>Implementoval jsem metodu simulovaného žíhání (alias ochlazování) a prozkoumal jsem její pro a proti. S vhodným nastavením parametrů nachází výrazně lepší řešení než hladové heuristiky a lze využít pro iterativní zlepšování existujících řešení (např. z greedy redux). Počáteční teplota a hranice maximálního počtu iterací navíc dovolují vhodně omezit výpočetní náročnost na úkor kvality nalezených řešení. Je ovšem třeba dát si pozor na interakci jednotlivých parametrů, např. aby nízký koeficient chlazení nevedl k předčasnému ukončení algoritmu.</p>
<h2 id="appendix">Appendix</h2>
<p>Dodatek obsahuje nezajímavé části implementace, jako je import symbolů z knihoven.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#imports-container" aria-controls="imports-container">&lt;&lt;imports&gt;&gt;=</button>
<div id="imports-container" class="collapse">
<div class="sourceCode" id="imports" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="imports-1"><a href="#imports-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span>cmp<span class="op">,</span> <span class="pp">cmp::</span>max<span class="op">,</span></span>
<span id="imports-2"><a href="#imports-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">ops::</span>Range<span class="op">,</span></span>
<span id="imports-3"><a href="#imports-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">str</span><span class="pp">::</span><span class="bu">FromStr</span><span class="op">,</span></span>
<span id="imports-4"><a href="#imports-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">io::</span><span class="op">{</span><span class="bu">BufRead</span><span class="op">,</span> BufReader<span class="op">},</span></span>
<span id="imports-5"><a href="#imports-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">collections::</span><span class="op">{</span>BTreeMap<span class="op">,</span> HashMap<span class="op">},</span></span>
<span id="imports-6"><a href="#imports-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">fs::</span><span class="op">{</span>read_dir<span class="op">,</span> File<span class="op">,</span> DirEntry<span class="op">},</span></span>
<span id="imports-7"><a href="#imports-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="imports-8"><a href="#imports-8" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span>Context<span class="op">,</span> <span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="imports-9"><a href="#imports-9" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">bitvec::prelude::</span>BitArr<span class="op">;</span></span>
<span id="imports-10"><a href="#imports-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="imports-11"><a href="#imports-11" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="imports-12"><a href="#imports-12" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>macro_use<span class="at">(</span>quickcheck<span class="at">)]</span></span>
<span id="imports-13"><a href="#imports-13" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> quickcheck_macros<span class="op">;</span></span></code></pre></div>
</div>
</div>
<p>Zpracování vstupu zajišťuje jednoduchý parser pracující řádek po řádku. Pro testy je tu parser formátu souborů s optimálními řešeními.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#parser-container" aria-controls="parser-container">&lt;&lt;parser&gt;&gt;=</button>
<div id="parser-container" class="collapse">
<div class="sourceCode" id="parser" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="parser-1"><a href="#parser-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>boilerplate<span class="op">&gt;&gt;</span></span>
<span id="parser-2"><a href="#parser-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-3"><a href="#parser-3" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> parse_line<span class="op">&lt;</span>T<span class="op">&gt;</span>(stream<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> T) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="kw">where</span> T<span class="op">:</span> <span class="bu">BufRead</span> <span class="op">{</span></span>
<span id="parser-4"><a href="#parser-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="parser-5"><a href="#parser-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stream<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input)<span class="op">?</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="parser-6"><a href="#parser-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="cn">Ok</span>(<span class="cn">None</span>)</span>
<span id="parser-7"><a href="#parser-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-8"><a href="#parser-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-9"><a href="#parser-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span>  numbers <span class="op">=</span> input<span class="op">.</span>split_whitespace()<span class="op">;</span></span>
<span id="parser-10"><a href="#parser-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> id <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-11"><a href="#parser-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span>  n <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-12"><a href="#parser-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span>  m <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-13"><a href="#parser-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-14"><a href="#parser-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> items<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>with_capacity(n)<span class="op">;</span></span>
<span id="parser-15"><a href="#parser-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> _ <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span>n <span class="op">{</span></span>
<span id="parser-16"><a href="#parser-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> w <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-17"><a href="#parser-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> c <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-18"><a href="#parser-18" aria-hidden="true" tabindex="-1"></a>        items<span class="op">.</span>push((w<span class="op">,</span> c))<span class="op">;</span></span>
<span id="parser-19"><a href="#parser-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-20"><a href="#parser-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-21"><a href="#parser-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(<span class="cn">Some</span>(Instance <span class="op">{</span>id<span class="op">,</span> m<span class="op">,</span> items<span class="op">}</span>))</span>
<span id="parser-22"><a href="#parser-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-23"><a href="#parser-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-24"><a href="#parser-24" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> parse_solution_line<span class="op">&lt;</span>T<span class="op">&gt;</span>(<span class="kw">mut</span> stream<span class="op">:</span> T) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>OptimalSolution<span class="op">&gt;&gt;</span> <span class="kw">where</span> T<span class="op">:</span> <span class="bu">BufRead</span> <span class="op">{</span></span>
<span id="parser-25"><a href="#parser-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="parser-26"><a href="#parser-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stream<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input)<span class="op">?</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="parser-27"><a href="#parser-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="cn">Ok</span>(<span class="cn">None</span>)</span>
<span id="parser-28"><a href="#parser-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-29"><a href="#parser-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-30"><a href="#parser-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span>    numbers <span class="op">=</span> input<span class="op">.</span>split_whitespace()<span class="op">;</span></span>
<span id="parser-31"><a href="#parser-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span>   id <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-32"><a href="#parser-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span>    n <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-33"><a href="#parser-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> cost <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-34"><a href="#parser-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-35"><a href="#parser-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> items <span class="op">=</span> <span class="pp">Config::</span><span class="kw">default</span>()<span class="op">;</span></span>
<span id="parser-36"><a href="#parser-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span>n <span class="op">{</span></span>
<span id="parser-37"><a href="#parser-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a<span class="op">:</span> <span class="dt">u8</span> <span class="op">=</span> numbers<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-38"><a href="#parser-38" aria-hidden="true" tabindex="-1"></a>        items<span class="op">.</span>set(i<span class="op">,</span> a <span class="op">==</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="parser-39"><a href="#parser-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-40"><a href="#parser-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-41"><a href="#parser-41" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(<span class="cn">Some</span>(OptimalSolution <span class="op">{</span>id<span class="op">,</span> cost<span class="op">,</span> cfg<span class="op">:</span> items<span class="op">}</span>))</span>
<span id="parser-42"><a href="#parser-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-43"><a href="#parser-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-44"><a href="#parser-44" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> load_solutions(set<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="parser-45"><a href="#parser-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> solutions <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="parser-46"><a href="#parser-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-47"><a href="#parser-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> files <span class="op">=</span> read_dir(<span class="st">&quot;../data/constructive/&quot;</span>)<span class="op">?</span></span>
<span id="parser-48"><a href="#parser-48" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>res<span class="op">|</span> res<span class="op">.</span>as_ref()<span class="op">.</span>ok()<span class="op">.</span>filter(<span class="op">|</span>f<span class="op">|</span> <span class="op">{</span></span>
<span id="parser-49"><a href="#parser-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> name <span class="op">=</span> f<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="parser-50"><a href="#parser-50" aria-hidden="true" tabindex="-1"></a>            f<span class="op">.</span>file_type()<span class="op">.</span>unwrap()<span class="op">.</span>is_file() <span class="op">&amp;&amp;</span></span>
<span id="parser-51"><a href="#parser-51" aria-hidden="true" tabindex="-1"></a>            name<span class="op">.</span>starts_with(set) <span class="op">&amp;&amp;</span></span>
<span id="parser-52"><a href="#parser-52" aria-hidden="true" tabindex="-1"></a>            name<span class="op">.</span>ends_with(<span class="st">&quot;_sol.dat&quot;</span>)</span>
<span id="parser-53"><a href="#parser-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>)<span class="op">.</span>is_some())<span class="op">;</span></span>
<span id="parser-54"><a href="#parser-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-55"><a href="#parser-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> file <span class="kw">in</span> files <span class="op">{</span></span>
<span id="parser-56"><a href="#parser-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="parser-57"><a href="#parser-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> n <span class="op">=</span> file<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap()[set<span class="op">.</span>len()<span class="op">..</span>]<span class="op">.</span>split(<span class="ch">&#39;_&#39;</span>)<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">.</span>parse()<span class="op">?;</span></span>
<span id="parser-58"><a href="#parser-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> stream <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="parser-59"><a href="#parser-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(opt) <span class="op">=</span> parse_solution_line(<span class="op">&amp;</span><span class="kw">mut</span> stream)<span class="op">?</span> <span class="op">{</span></span>
<span id="parser-60"><a href="#parser-60" aria-hidden="true" tabindex="-1"></a>            solutions<span class="op">.</span>insert((n<span class="op">,</span> opt<span class="op">.</span>id)<span class="op">,</span> opt)<span class="op">;</span></span>
<span id="parser-61"><a href="#parser-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="parser-62"><a href="#parser-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-63"><a href="#parser-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-64"><a href="#parser-64" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(solutions)</span>
<span id="parser-65"><a href="#parser-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<p>Trait <code>Boilerplate</code> definuje funkci <code>parse_next</code> pro zkrácení zápisu zpracování vstupu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#boilerplate-container" aria-controls="boilerplate-container">&lt;&lt;boilerplate&gt;&gt;=</button>
<div id="boilerplate-container" class="collapse">
<div class="sourceCode" id="boilerplate" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="boilerplate-1"><a href="#boilerplate-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Boilerplate <span class="op">{</span></span>
<span id="boilerplate-2"><a href="#boilerplate-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> parse_next<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">FromStr</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="boilerplate-3"><a href="#boilerplate-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> <span class="op">&lt;</span>T <span class="kw">as</span> <span class="bu">FromStr</span><span class="op">&gt;</span><span class="pp">::</span><span class="cn">Err</span><span class="op">:</span> <span class="pp">std::error::</span><span class="bu">Error</span> <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span> <span class="op">+</span> <span class="ot">&#39;static</span><span class="op">;</span></span>
<span id="boilerplate-4"><a href="#boilerplate-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="boilerplate-5"><a href="#boilerplate-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="boilerplate-6"><a href="#boilerplate-6" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Boilerplate <span class="kw">for</span> <span class="pp">std::</span><span class="dt">str</span><span class="pp">::</span>SplitWhitespace<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="boilerplate-7"><a href="#boilerplate-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> parse_next<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">FromStr</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="boilerplate-8"><a href="#boilerplate-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> <span class="op">&lt;</span>T <span class="kw">as</span> <span class="bu">FromStr</span><span class="op">&gt;</span><span class="pp">::</span><span class="cn">Err</span><span class="op">:</span> <span class="pp">std::error::</span><span class="bu">Error</span> <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span> <span class="op">+</span> <span class="ot">&#39;static</span> <span class="op">{</span></span>
<span id="boilerplate-9"><a href="#boilerplate-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="dt">str</span> <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>next()<span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;unexpected end of input&quot;</span>))<span class="op">?;</span></span>
<span id="boilerplate-10"><a href="#boilerplate-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">str</span><span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span>T<span class="op">&gt;</span>()</span>
<span id="boilerplate-11"><a href="#boilerplate-11" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span>with_context(<span class="op">||</span> <span class="pp">format!</span>(<span class="st">&quot;cannot parse {}&quot;</span><span class="op">,</span> <span class="dt">str</span>))</span>
<span id="boilerplate-12"><a href="#boilerplate-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="boilerplate-13"><a href="#boilerplate-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3 id="měření-výkonu">Měření výkonu</h3>
<p>Benchmark z minulého úkolu postavený na knihovně <a href="https://crates.io/crates/criterion"><code>Criterion.rs</code></a> se nachází v souboru níže. Pro měření těchto experimentů ale nebyl použit.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-slash-benches-slash-bench-dot-rs-container" aria-controls="solver-slash-benches-slash-bench-dot-rs-container">&lt;&lt;solver/benches/bench.rs&gt;&gt;=</button>
<div id="solver-slash-benches-slash-bench-dot-rs-container" class="collapse">
<div class="sourceCode" id="cb3" data-file="solver/benches/bench.rs" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> solver<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">solver::</span><span class="op">*;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span><span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span><span class="pp">collections::</span>HashMap<span class="op">,</span> <span class="pp">fs::</span>File<span class="op">,</span> <span class="pp">io::</span><span class="op">{</span>BufReader<span class="op">,</span> <span class="bu">Write</span><span class="op">},</span> <span class="pp">ops::</span>Range<span class="op">,</span> <span class="pp">time::</span>Duration<span class="op">};</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">criterion::</span><span class="op">{</span>criterion_group<span class="op">,</span> criterion_main<span class="op">,</span> Criterion<span class="op">,</span> BenchmarkId<span class="op">};</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> full(c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> algs <span class="op">=</span> get_algorithms()<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> solutions <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ranges <span class="op">=</span> <span class="pp">HashMap::</span>from([</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;bb&quot;</span><span class="op">,</span>     <span class="dv">0</span><span class="op">..=</span><span class="dv">25</span>)<span class="op">,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpw&quot;</span><span class="op">,</span>    <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpc&quot;</span><span class="op">,</span>    <span class="dv">0</span><span class="op">..=</span><span class="dv">20</span>)<span class="op">,</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas1&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas2&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">22</span>)<span class="op">,</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;greedy&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;redux&quot;</span><span class="op">,</span>  <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    ])<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> input<span class="op">:</span> HashMap<span class="op">&lt;</span>(<span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">,</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ns <span class="op">=</span> [<span class="dv">4</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">25</span><span class="op">,</span> <span class="dv">27</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">32</span>]<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sets <span class="op">=</span> [<span class="st">&quot;NK&quot;</span><span class="op">,</span> <span class="st">&quot;ZKC&quot;</span><span class="op">,</span> <span class="st">&quot;ZKW&quot;</span>]<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> set <span class="kw">in</span> sets <span class="op">{</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        solutions<span class="op">.</span>insert(set<span class="op">,</span> load_solutions(set)<span class="op">?</span>)<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> n <span class="kw">in</span> ns <span class="op">{</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            input<span class="op">.</span>insert((set<span class="op">,</span> n)<span class="op">,</span> load_input(set<span class="op">,</span> n <span class="op">..</span> n <span class="op">+</span> <span class="dv">1</span>)<span class="op">?</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>into_iter()</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>rev()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>take(<span class="dv">100</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>collect()</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    benchmark(algs<span class="op">,</span> c<span class="op">,</span> <span class="op">&amp;</span>ns<span class="op">,</span> <span class="op">&amp;</span>sets<span class="op">,</span> ranges<span class="op">,</span> solutions<span class="op">,</span> input)<span class="op">?;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> benchmark(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    algs<span class="op">:</span> <span class="pp">std::collections::</span>BTreeMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="kw">fn</span>(<span class="op">&amp;</span>Instance) <span class="op">-&gt;</span> Solution<span class="op">&gt;,</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion<span class="op">,</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    ns<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u32</span>]<span class="op">,</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    sets<span class="op">:</span> <span class="op">&amp;</span>[<span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span>]<span class="op">,</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    ranges<span class="op">:</span> HashMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="pp">std::ops::</span>RangeInclusive<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;&gt;,</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">:</span> HashMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;&gt;,</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span> HashMap<span class="op">&lt;</span>(<span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">,</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="pp">anyhow::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(<span class="kw">for</span> set <span class="kw">in</span> sets <span class="op">{</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> (name<span class="op">,</span> alg) <span class="kw">in</span> algs<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> <span class="kw">mut</span> group <span class="op">=</span> c<span class="op">.</span>benchmark_group(<span class="pp">format!</span>(<span class="st">&quot;{}-{}&quot;</span><span class="op">,</span> set<span class="op">,</span> name))<span class="op">;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>            group<span class="op">.</span>sample_size(<span class="dv">10</span>)<span class="op">.</span>warm_up_time(<span class="pp">Duration::</span>from_millis(<span class="dv">200</span>))<span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> n <span class="kw">in</span> ns <span class="op">{</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">!</span>ranges<span class="op">.</span>get(<span class="op">*</span>name)<span class="op">.</span>filter(<span class="op">|</span>r<span class="op">|</span> r<span class="op">.</span>contains(<span class="op">&amp;</span>n))<span class="op">.</span>is_some()</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">||</span> (<span class="op">*</span>name <span class="op">==</span> <span class="st">&quot;bb&quot;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>n <span class="op">&gt;</span> <span class="dv">22</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>set <span class="op">==</span> <span class="st">&quot;ZKW&quot;</span>) <span class="op">{</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> (max<span class="op">,</span> avg<span class="op">,</span> nonzero_n) <span class="op">=</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>                    measure(<span class="op">&amp;</span><span class="kw">mut</span> group<span class="op">,</span> <span class="op">*</span>alg<span class="op">,</span> <span class="op">&amp;</span>solutions[set]<span class="op">,</span> <span class="op">*</span>n<span class="op">,</span> <span class="op">&amp;</span>input[<span class="op">&amp;</span>(<span class="op">*</span>set<span class="op">,</span> <span class="op">*</span>n)])<span class="op">;</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>                <span class="pp">eprintln!</span>(<span class="st">&quot;max: {}, avg: {}, n: {} vs real n: {}&quot;</span><span class="op">,</span> max<span class="op">,</span> avg<span class="op">,</span> nonzero_n<span class="op">,</span> n)<span class="op">;</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> avg <span class="op">=</span> avg <span class="op">/</span> nonzero_n <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> file <span class="op">=</span> <span class="pp">File::</span>create(<span class="pp">format!</span>(<span class="st">&quot;../docs/measurements/{}_{}_{}.txt&quot;</span><span class="op">,</span> set<span class="op">,</span> name<span class="op">,</span> n))<span class="op">?;</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                file<span class="op">.</span>write_all(<span class="pp">format!</span>(<span class="st">&quot;max,avg</span><span class="sc">\n</span><span class="st">{},{}&quot;</span><span class="op">,</span> max<span class="op">,</span> avg)<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>            group<span class="op">.</span>finish()<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> measure(</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>    group<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">criterion::</span>BenchmarkGroup<span class="op">&lt;</span><span class="pp">criterion::measurement::</span>WallTime<span class="op">&gt;,</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    alg<span class="op">:</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="kw">fn</span>(<span class="op">&amp;</span><span class="ot">&#39;a</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;,</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">:</span> <span class="op">&amp;</span>HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;,</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    n<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    instances<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> (<span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span><span class="op">,</span> <span class="dt">u32</span>) <span class="op">{</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> stats <span class="op">=</span> (<span class="dv">0.0</span><span class="op">,</span> <span class="dv">0.0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    group<span class="op">.</span>bench_with_input(</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="pp">BenchmarkId::</span>from_parameter(n)<span class="op">,</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>        instances<span class="op">,</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span>b<span class="op">,</span> ins<span class="op">|</span> b<span class="op">.</span>iter(</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>            <span class="op">||</span> ins<span class="op">.</span>iter()<span class="op">.</span>for_each(<span class="op">|</span>inst<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> sln <span class="op">=</span> alg(inst)<span class="op">;</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> optimal <span class="op">=</span> <span class="op">&amp;</span>solutions[<span class="op">&amp;</span>(n<span class="op">,</span> inst<span class="op">.</span>id)]<span class="op">;</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> optimal<span class="op">.</span>cost <span class="op">!=</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> error <span class="op">=</span> <span class="dv">1.0</span> <span class="op">-</span> sln<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> optimal<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> (max<span class="op">,</span> avg<span class="op">,</span> n) <span class="op">=</span> stats<span class="op">;</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                    stats <span class="op">=</span> (<span class="kw">if</span> error <span class="op">&gt;</span> max <span class="op">{</span> error <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> max <span class="op">},</span> avg <span class="op">+</span> error<span class="op">,</span> n <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span>)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    stats</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> load_input(set<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> r<span class="op">:</span> Range<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> instances <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> file <span class="kw">in</span> list_input_files(set<span class="op">,</span> r)<span class="op">?</span> <span class="op">{</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> r <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(inst) <span class="op">=</span> parse_line(<span class="op">&amp;</span><span class="kw">mut</span> r)<span class="op">?</span> <span class="op">{</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>            instances<span class="op">.</span>push(inst)<span class="op">;</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(instances)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> proxy(c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion) <span class="op">{</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    full(c)<span class="op">.</span>unwrap()</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="pp">criterion_group!</span>(benches<span class="op">,</span> proxy)<span class="op">;</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="pp">criterion_main!</span>(benches)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<h3 id="spouštění-jednotlivých-řešičů">Spouštění jednotlivých řešičů</h3>
<p>Projekt podporuje sestavení spustitelného souboru schopného zpracovat libovolný vstup ze zadání za pomoci algoritmu zvoleného na příkazové řádce. Zdrojový kód tohoto rozhraní se nachází v souboru <code>solver/src/bin/main.rs</code>. Na standardní výstup vypisuje cenu a chybu řešení, spoléhá ovšem na to, že mezi optimálními řešeními najde i to pro kombinaci velikosti a ID zadané instance.</p>
<div class="annotated-code">
<p><span><em>«solver/src/bin/main.rs»=</em></span></p>
<div class="sourceCode" id="cb4" data-file="solver/src/bin/main.rs"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> solver<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::io::</span>stdin<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">solver::</span><span class="op">*;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span><span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> algorithms <span class="op">=</span> get_algorithms()<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> solutions <span class="op">=</span> load_solutions(<span class="st">&quot;NK&quot;</span>)<span class="op">?;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> Either<span class="op">&lt;</span>A<span class="op">,</span> B<span class="op">&gt;</span> <span class="op">{</span> Left(A)<span class="op">,</span> Right(B) <span class="op">}</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span>  <span class="pp">Either::</span><span class="op">*;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> alg <span class="op">=</span> <span class="op">{</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;&lt;</span>select<span class="op">-</span>algorithm<span class="op">&gt;&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}?;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> inst <span class="kw">in</span> load_instances(<span class="op">&amp;</span><span class="kw">mut</span> stdin()<span class="op">.</span>lock())<span class="op">?</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">std::time::</span>Instant<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> (now<span class="op">,</span> sln) <span class="op">=</span> <span class="kw">match</span> alg <span class="op">{</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            Right(f) <span class="op">=&gt;</span> (<span class="pp">Instant::</span>now()<span class="op">,</span> f(<span class="op">&amp;</span>inst))<span class="op">,</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            Left(cfg) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> rng<span class="op">:</span> <span class="pp">rand_chacha::</span>ChaCha8Rng <span class="op">=</span> <span class="pp">rand::SeedableRng::</span>seed_from_u64(<span class="dv">42</span>)<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                (<span class="pp">Instant::</span>now()<span class="op">,</span> inst<span class="op">.</span>simulated_annealing(<span class="op">&amp;</span><span class="kw">mut</span> rng<span class="op">,</span> cfg))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;took {} ms&quot;</span><span class="op">,</span> now<span class="op">.</span>elapsed()<span class="op">.</span>as_millis())<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> optimal <span class="op">=</span> <span class="op">&amp;</span>solutions<span class="op">.</span>get(<span class="op">&amp;</span>(inst<span class="op">.</span>items<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u32</span><span class="op">,</span> inst<span class="op">.</span>id))<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> error <span class="op">=</span> optimal<span class="op">.</span>map(<span class="op">|</span>opt<span class="op">|</span> <span class="dv">1.0</span> <span class="op">-</span> sln<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> opt<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span>)<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;{} {}&quot;</span><span class="op">,</span> sln<span class="op">.</span>cost<span class="op">,</span> error<span class="op">.</span>map(<span class="op">|</span>e<span class="op">|</span> e<span class="op">.</span>to_string())<span class="op">.</span>unwrap_or_default())<span class="op">;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Funkci příslušnou vybranému algoritmu vrátíme jako hodnotu tohoto bloku:</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#select-algorithm-container" aria-controls="select-algorithm-container">&lt;&lt;select-algorithm&gt;&gt;=</button>
<div id="select-algorithm-container" class="collapse">
<div class="sourceCode" id="select-algorithm" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="select-algorithm-1"><a href="#select-algorithm-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> args<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="pp">std::env::</span>args()<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="select-algorithm-2"><a href="#select-algorithm-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> args<span class="op">.</span>len() <span class="op">&gt;=</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="select-algorithm-3"><a href="#select-algorithm-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> alg <span class="op">=</span> <span class="op">&amp;</span>args[<span class="dv">1</span>][<span class="op">..</span>]<span class="op">;</span></span>
<span id="select-algorithm-4"><a href="#select-algorithm-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="op">&amp;</span>f) <span class="op">=</span> algorithms<span class="op">.</span>get(alg) <span class="op">{</span></span>
<span id="select-algorithm-5"><a href="#select-algorithm-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(Right(f))</span>
<span id="select-algorithm-6"><a href="#select-algorithm-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> alg <span class="op">==</span> <span class="st">&quot;sa&quot;</span> <span class="op">{</span> <span class="at">#[</span>allow<span class="at">(</span><span class="pp">clippy::</span>or_fun_call<span class="at">)]</span> <span class="op">{</span> <span class="co">// simulated annealing</span></span>
<span id="select-algorithm-7"><a href="#select-algorithm-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> args[<span class="dv">2</span><span class="op">..</span>]<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span><span class="dt">str</span><span class="op">|</span> <span class="op">&amp;</span><span class="dt">str</span>[<span class="op">..</span>])<span class="op">;</span></span>
<span id="select-algorithm-8"><a href="#select-algorithm-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> max_iterations <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-9"><a href="#select-algorithm-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> scaling_factor <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-10"><a href="#select-algorithm-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> temp_modifier <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-11"><a href="#select-algorithm-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> equilibrium_width <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-12"><a href="#select-algorithm-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(Left((max_iterations<span class="op">,</span> scaling_factor<span class="op">,</span> temp_modifier<span class="op">,</span> equilibrium_width)))</span>
<span id="select-algorithm-13"><a href="#select-algorithm-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="select-algorithm-14"><a href="#select-algorithm-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Err</span>(<span class="pp">anyhow!</span>(<span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">{}</span><span class="sc">\&quot;</span><span class="st"> is not a known algorithm&quot;</span><span class="op">,</span> alg))</span>
<span id="select-algorithm-15"><a href="#select-algorithm-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="select-algorithm-16"><a href="#select-algorithm-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="select-algorithm-17"><a href="#select-algorithm-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(</span>
<span id="select-algorithm-18"><a href="#select-algorithm-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Usage: {} &lt;algorithm&gt;</span><span class="sc">\n\t</span><span class="st">where &lt;algorithm&gt; is one of {}</span><span class="sc">\n\t</span><span class="st">or &#39;sa&#39; for simulated annealing.&quot;</span><span class="op">,</span></span>
<span id="select-algorithm-19"><a href="#select-algorithm-19" aria-hidden="true" tabindex="-1"></a>        args[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="select-algorithm-20"><a href="#select-algorithm-20" aria-hidden="true" tabindex="-1"></a>        algorithms<span class="op">.</span>keys()<span class="op">.</span>map(<span class="bu">ToString</span><span class="pp">::</span>to_string)<span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()<span class="op">.</span>join(<span class="st">&quot;, &quot;</span>)</span>
<span id="select-algorithm-21"><a href="#select-algorithm-21" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="select-algorithm-22"><a href="#select-algorithm-22" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Err</span>(<span class="pp">anyhow!</span>(<span class="st">&quot;Expected 1 argument, got {}&quot;</span><span class="op">,</span> args<span class="op">.</span>len() <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="select-algorithm-23"><a href="#select-algorithm-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3 id="automatické-testy">Automatické testy</h3>
<p>Implementaci doplňují automatické testy k ověření správnosti, včetně property-based testu s knihovnou <a href="https://github.com/BurntSushi/quickcheck">quickcheck</a>.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#tests-container" aria-controls="tests-container">&lt;&lt;tests&gt;&gt;=</button>
<div id="tests-container" class="collapse">
<div class="sourceCode" id="tests" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="tests-1"><a href="#tests-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="tests-2"><a href="#tests-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mod</span> tests <span class="op">{</span></span>
<span id="tests-3"><a href="#tests-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="kw">super</span><span class="pp">::</span><span class="op">*;</span></span>
<span id="tests-4"><a href="#tests-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">quickcheck::</span><span class="op">{</span>Arbitrary<span class="op">,</span> Gen<span class="op">};</span></span>
<span id="tests-5"><a href="#tests-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span><span class="pp">fs::</span>File<span class="op">,</span> <span class="pp">io::</span>BufReader<span class="op">};</span></span>
<span id="tests-6"><a href="#tests-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-7"><a href="#tests-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span> Arbitrary <span class="kw">for</span> Instance <span class="op">{</span></span>
<span id="tests-8"><a href="#tests-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> arbitrary(g<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Gen) <span class="op">-&gt;</span> Instance <span class="op">{</span></span>
<span id="tests-9"><a href="#tests-9" aria-hidden="true" tabindex="-1"></a>            Instance <span class="op">{</span></span>
<span id="tests-10"><a href="#tests-10" aria-hidden="true" tabindex="-1"></a>                id<span class="op">:</span>    <span class="dt">i32</span><span class="pp">::</span>arbitrary(g)<span class="op">,</span></span>
<span id="tests-11"><a href="#tests-11" aria-hidden="true" tabindex="-1"></a>                m<span class="op">:</span>     <span class="dt">u32</span><span class="pp">::</span>arbitrary(g)<span class="op">.</span>min(<span class="dv">10_000</span>)<span class="op">,</span></span>
<span id="tests-12"><a href="#tests-12" aria-hidden="true" tabindex="-1"></a>                items<span class="op">:</span> <span class="pp">vec!</span>[<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">&gt;</span><span class="pp">::</span>arbitrary(g)]</span>
<span id="tests-13"><a href="#tests-13" aria-hidden="true" tabindex="-1"></a>                           <span class="op">.</span>into_iter()</span>
<span id="tests-14"><a href="#tests-14" aria-hidden="true" tabindex="-1"></a>                           <span class="op">.</span>chain(<span class="dt">Vec</span><span class="pp">::</span>arbitrary(g)<span class="op">.</span>into_iter())</span>
<span id="tests-15"><a href="#tests-15" aria-hidden="true" tabindex="-1"></a>                           <span class="op">.</span>take(<span class="dv">10</span>)</span>
<span id="tests-16"><a href="#tests-16" aria-hidden="true" tabindex="-1"></a>                           <span class="op">.</span>map(<span class="op">|</span>(w<span class="op">,</span> c)<span class="op">:</span> (<span class="dt">u32</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">|</span> (w<span class="op">.</span>min(<span class="dv">10_000</span>)<span class="op">,</span> c <span class="op">%</span> <span class="dv">10_000</span>))</span>
<span id="tests-17"><a href="#tests-17" aria-hidden="true" tabindex="-1"></a>                           <span class="op">.</span>collect()<span class="op">,</span></span>
<span id="tests-18"><a href="#tests-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="tests-19"><a href="#tests-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-20"><a href="#tests-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-21"><a href="#tests-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> shrink(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="dt">Self</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="tests-22"><a href="#tests-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> data <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>clone()<span class="op">;</span></span>
<span id="tests-23"><a href="#tests-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">#[</span>allow<span class="at">(</span><span class="pp">clippy::</span>needless_collect<span class="at">)]</span></span>
<span id="tests-24"><a href="#tests-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> chain<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">quickcheck::</span>empty_shrinker()</span>
<span id="tests-25"><a href="#tests-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>id   <span class="op">.</span>shrink()<span class="op">.</span>map(<span class="op">|</span>id   <span class="op">|</span> Instance <span class="op">{</span>id<span class="op">,</span>    <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone()<span class="op">}</span>))</span>
<span id="tests-26"><a href="#tests-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>m    <span class="op">.</span>shrink()<span class="op">.</span>map(<span class="op">|</span>m    <span class="op">|</span> Instance <span class="op">{</span>m<span class="op">,</span>     <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone()<span class="op">}</span>))</span>
<span id="tests-27"><a href="#tests-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>items<span class="op">.</span>shrink()<span class="op">.</span>map(<span class="op">|</span>items<span class="op">|</span> Instance <span class="op">{</span> items<span class="op">,</span> <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone() <span class="op">}</span>)</span>
<span id="tests-28"><a href="#tests-28" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>filter(<span class="op">|</span>i<span class="op">|</span> <span class="op">!</span>i<span class="op">.</span>items<span class="op">.</span>is_empty()))</span>
<span id="tests-29"><a href="#tests-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>collect()<span class="op">;</span></span>
<span id="tests-30"><a href="#tests-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">Box</span><span class="pp">::</span>new(chain<span class="op">.</span>into_iter())</span>
<span id="tests-31"><a href="#tests-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-32"><a href="#tests-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-33"><a href="#tests-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-34"><a href="#tests-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-35"><a href="#tests-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> assert_valid(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="tests-36"><a href="#tests-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> Solution <span class="op">{</span> weight<span class="op">,</span> cost<span class="op">,</span> cfg<span class="op">,</span> inst <span class="op">}</span> <span class="op">=</span> <span class="kw">self</span><span class="op">;</span></span>
<span id="tests-37"><a href="#tests-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> Instance <span class="op">{</span> m<span class="op">,</span> items<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=</span> inst<span class="op">;</span></span>
<span id="tests-38"><a href="#tests-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-39"><a href="#tests-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> (computed_weight<span class="op">,</span> computed_cost) <span class="op">=</span> items</span>
<span id="tests-40"><a href="#tests-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>iter()</span>
<span id="tests-41"><a href="#tests-41" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>zip(cfg)</span>
<span id="tests-42"><a href="#tests-42" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>((w<span class="op">,</span> c)<span class="op">,</span> b)<span class="op">|</span> <span class="op">{</span></span>
<span id="tests-43"><a href="#tests-43" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">*</span>b <span class="op">{</span> (<span class="op">*</span>w<span class="op">,</span> <span class="op">*</span>c) <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> (<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>) <span class="op">}</span></span>
<span id="tests-44"><a href="#tests-44" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span>)</span>
<span id="tests-45"><a href="#tests-45" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>reduce(<span class="op">|</span>(a0<span class="op">,</span> b0)<span class="op">,</span> (a1<span class="op">,</span> b1)<span class="op">|</span> (a0 <span class="op">+</span> a1<span class="op">,</span> b0 <span class="op">+</span> b1))</span>
<span id="tests-46"><a href="#tests-46" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>unwrap_or_default()<span class="op">;</span></span>
<span id="tests-47"><a href="#tests-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-48"><a href="#tests-48" aria-hidden="true" tabindex="-1"></a>            <span class="pp">assert!</span>(computed_weight <span class="op">&lt;=</span> <span class="op">*</span>m)<span class="op">;</span></span>
<span id="tests-49"><a href="#tests-49" aria-hidden="true" tabindex="-1"></a>            <span class="pp">assert_eq!</span>(computed_cost<span class="op">,</span> <span class="op">*</span>cost)<span class="op">;</span></span>
<span id="tests-50"><a href="#tests-50" aria-hidden="true" tabindex="-1"></a>            <span class="pp">assert_eq!</span>(computed_weight<span class="op">,</span> <span class="op">*</span>weight)<span class="op">;</span></span>
<span id="tests-51"><a href="#tests-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-52"><a href="#tests-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-53"><a href="#tests-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-54"><a href="#tests-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-55"><a href="#tests-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> stupid() <span class="op">{</span></span>
<span id="tests-56"><a href="#tests-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// let i = Instance { id: 0, m: 1, b: 0, items: vec![(1, 0), (1, 0)] };</span></span>
<span id="tests-57"><a href="#tests-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">// i.branch_and_bound2().assert_valid(&amp;i);</span></span>
<span id="tests-58"><a href="#tests-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> i <span class="op">=</span> Instance <span class="op">{</span> id<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> m<span class="op">:</span> <span class="dv">1</span><span class="op">,</span> items<span class="op">:</span> <span class="pp">vec!</span>[(<span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> (<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">,</span> (<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)] <span class="op">};</span></span>
<span id="tests-59"><a href="#tests-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> bb <span class="op">=</span> i<span class="op">.</span>branch_and_bound()<span class="op">;</span></span>
<span id="tests-60"><a href="#tests-60" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(bb<span class="op">.</span>cost<span class="op">,</span> i<span class="op">.</span>dynamic_programming_w()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-61"><a href="#tests-61" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(bb<span class="op">.</span>cost<span class="op">,</span> i<span class="op">.</span>dynamic_programming_c()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-62"><a href="#tests-62" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(bb<span class="op">.</span>cost<span class="op">,</span> i<span class="op">.</span>greedy_redux()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-63"><a href="#tests-63" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(bb<span class="op">.</span>cost<span class="op">,</span> i<span class="op">.</span>brute_force()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-64"><a href="#tests-64" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(bb<span class="op">.</span>cost<span class="op">,</span> i<span class="op">.</span>greedy()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-65"><a href="#tests-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-66"><a href="#tests-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-67"><a href="#tests-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>ignore<span class="at">]</span></span>
<span id="tests-68"><a href="#tests-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-69"><a href="#tests-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> proper() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-70"><a href="#tests-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">type</span> Solver <span class="op">=</span> (<span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span><span class="op">,</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="kw">fn</span>(<span class="op">&amp;</span><span class="ot">&#39;a</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span>)<span class="op">;</span></span>
<span id="tests-71"><a href="#tests-71" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> algs <span class="op">=</span> get_algorithms()<span class="op">;</span></span>
<span id="tests-72"><a href="#tests-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> algs<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Solver<span class="op">&gt;</span> <span class="op">=</span> algs<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(s<span class="op">,</span> f)<span class="op">|</span> (<span class="op">*</span>s<span class="op">,</span> <span class="op">*</span>f))<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="tests-73"><a href="#tests-73" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> opts <span class="op">=</span> load_solutions(<span class="st">&quot;NK&quot;</span>)<span class="op">?;</span></span>
<span id="tests-74"><a href="#tests-74" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;loaded {} optimal solutions&quot;</span><span class="op">,</span> opts<span class="op">.</span>len())<span class="op">;</span></span>
<span id="tests-75"><a href="#tests-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-76"><a href="#tests-76" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> solve<span class="op">:</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="kw">fn</span>(<span class="op">&amp;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;,</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> _) <span class="op">-&gt;</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span><span class="op">,</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span>)<span class="op">&gt;</span> <span class="op">=</span></span>
<span id="tests-77"><a href="#tests-77" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span>algs<span class="op">,</span> inst<span class="op">|</span></span>
<span id="tests-78"><a href="#tests-78" aria-hidden="true" tabindex="-1"></a>            algs<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>(name<span class="op">,</span> alg)<span class="op">:</span> <span class="op">&amp;</span>Solver<span class="op">|</span> (<span class="op">*</span>name<span class="op">,</span> alg(inst)))<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="tests-79"><a href="#tests-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-80"><a href="#tests-80" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> files <span class="op">=</span> list_input_files(<span class="st">&quot;NK&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..</span><span class="dv">5</span>)<span class="op">?.</span>into_iter()<span class="op">;</span></span>
<span id="tests-81"><a href="#tests-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">// make sure `files` is not empty</span></span>
<span id="tests-82"><a href="#tests-82" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> first <span class="op">=</span> files<span class="op">.</span>next()<span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;no instance files loaded&quot;</span>))<span class="op">?;</span></span>
<span id="tests-83"><a href="#tests-83" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> file <span class="kw">in</span> <span class="pp">vec!</span>[first]<span class="op">.</span>into_iter()<span class="op">.</span>chain(files) <span class="op">{</span></span>
<span id="tests-84"><a href="#tests-84" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="tests-85"><a href="#tests-85" aria-hidden="true" tabindex="-1"></a>            <span class="pp">println!</span>(<span class="st">&quot;Testing {}&quot;</span><span class="op">,</span> file<span class="op">.</span>file_name()<span class="op">.</span>to_str()<span class="op">.</span>unwrap())<span class="op">;</span></span>
<span id="tests-86"><a href="#tests-86" aria-hidden="true" tabindex="-1"></a>            <span class="co">// open the file</span></span>
<span id="tests-87"><a href="#tests-87" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> <span class="kw">mut</span> r <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="tests-88"><a href="#tests-88" aria-hidden="true" tabindex="-1"></a>            <span class="co">// solve each instance with all algorithms</span></span>
<span id="tests-89"><a href="#tests-89" aria-hidden="true" tabindex="-1"></a>            <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(slns) <span class="op">=</span> parse_line(<span class="op">&amp;</span><span class="kw">mut</span> r)<span class="op">?.</span>as_ref()<span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> solve(<span class="op">&amp;</span>algs<span class="op">,</span> x)) <span class="op">{</span></span>
<span id="tests-90"><a href="#tests-90" aria-hidden="true" tabindex="-1"></a>                <span class="co">// verify correctness</span></span>
<span id="tests-91"><a href="#tests-91" aria-hidden="true" tabindex="-1"></a>                slns<span class="op">.</span>iter()<span class="op">.</span>for_each(<span class="op">|</span>(alg<span class="op">,</span> s)<span class="op">|</span> <span class="op">{</span></span>
<span id="tests-92"><a href="#tests-92" aria-hidden="true" tabindex="-1"></a>                    <span class="pp">eprint!</span>(<span class="st">&quot;</span><span class="sc">\r</span><span class="st">id: {} alg: {}</span><span class="sc">\t</span><span class="st">&quot;</span><span class="op">,</span> s<span class="op">.</span>inst<span class="op">.</span>id<span class="op">,</span> alg)<span class="op">;</span></span>
<span id="tests-93"><a href="#tests-93" aria-hidden="true" tabindex="-1"></a>                    s<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-94"><a href="#tests-94" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> key <span class="op">=</span> (s<span class="op">.</span>inst<span class="op">.</span>items<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u32</span><span class="op">,</span> s<span class="op">.</span>inst<span class="op">.</span>id)<span class="op">;</span></span>
<span id="tests-95"><a href="#tests-95" aria-hidden="true" tabindex="-1"></a>                    <span class="pp">assert!</span>(s<span class="op">.</span>cost <span class="op">&lt;=</span> opts[<span class="op">&amp;</span>key]<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-96"><a href="#tests-96" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span>)<span class="op">;</span></span>
<span id="tests-97"><a href="#tests-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="tests-98"><a href="#tests-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-99"><a href="#tests-99" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(())</span>
<span id="tests-100"><a href="#tests-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-101"><a href="#tests-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-102"><a href="#tests-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-103"><a href="#tests-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> dpc_simple() <span class="op">{</span></span>
<span id="tests-104"><a href="#tests-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> i <span class="op">=</span> Instance <span class="op">{</span> id<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> m<span class="op">:</span> <span class="dv">0</span><span class="op">,</span> items<span class="op">:</span> <span class="pp">vec!</span>[(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">,</span> (<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)] <span class="op">};</span></span>
<span id="tests-105"><a href="#tests-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> s <span class="op">=</span> i<span class="op">.</span>dynamic_programming_c()<span class="op">;</span></span>
<span id="tests-106"><a href="#tests-106" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(s<span class="op">.</span>cost<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="tests-107"><a href="#tests-107" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(s<span class="op">.</span>weight<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="tests-108"><a href="#tests-108" aria-hidden="true" tabindex="-1"></a>        s<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-109"><a href="#tests-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-110"><a href="#tests-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-111"><a href="#tests-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-112"><a href="#tests-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> fptas_is_within_bounds() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-113"><a href="#tests-113" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> opts <span class="op">=</span> load_solutions(<span class="st">&quot;NK&quot;</span>)<span class="op">?;</span></span>
<span id="tests-114"><a href="#tests-114" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> eps <span class="kw">in</span> [<span class="dv">0.1</span><span class="op">,</span> <span class="dv">0.01</span>] <span class="op">{</span></span>
<span id="tests-115"><a href="#tests-115" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> file <span class="kw">in</span> list_input_files(<span class="st">&quot;NK&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..</span><span class="dv">5</span>)<span class="op">?</span> <span class="op">{</span></span>
<span id="tests-116"><a href="#tests-116" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="tests-117"><a href="#tests-117" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> r <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="tests-118"><a href="#tests-118" aria-hidden="true" tabindex="-1"></a>                <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(sln) <span class="op">=</span> parse_line(<span class="op">&amp;</span><span class="kw">mut</span> r)<span class="op">?.</span>as_ref()<span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> x<span class="op">.</span>fptas(eps)) <span class="op">{</span></span>
<span id="tests-119"><a href="#tests-119" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// make sure the solution from fptas is at least (1 - eps) * optimal cost</span></span>
<span id="tests-120"><a href="#tests-120" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> key <span class="op">=</span> (sln<span class="op">.</span>inst<span class="op">.</span>items<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u32</span><span class="op">,</span> sln<span class="op">.</span>inst<span class="op">.</span>id)<span class="op">;</span></span>
<span id="tests-121"><a href="#tests-121" aria-hidden="true" tabindex="-1"></a>                    <span class="pp">println!</span>(<span class="st">&quot;{} {} {}&quot;</span><span class="op">,</span> sln<span class="op">.</span>cost<span class="op">,</span> opts[<span class="op">&amp;</span>key]<span class="op">.</span>cost<span class="op">,</span> (<span class="dv">1.0</span> <span class="op">-</span> eps) <span class="op">*</span> opts[<span class="op">&amp;</span>key]<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span>)<span class="op">;</span></span>
<span id="tests-122"><a href="#tests-122" aria-hidden="true" tabindex="-1"></a>                    <span class="pp">assert!</span>(sln<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">&gt;=</span> opts[<span class="op">&amp;</span>key]<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">*</span> (<span class="dv">1.0</span> <span class="op">-</span> eps))<span class="op">;</span></span>
<span id="tests-123"><a href="#tests-123" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="tests-124"><a href="#tests-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="tests-125"><a href="#tests-125" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-126"><a href="#tests-126" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(())</span>
<span id="tests-127"><a href="#tests-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-128"><a href="#tests-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-129"><a href="#tests-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-130"><a href="#tests-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> small_bb_is_correct() <span class="op">{</span></span>
<span id="tests-131"><a href="#tests-131" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a <span class="op">=</span> Instance <span class="op">{</span></span>
<span id="tests-132"><a href="#tests-132" aria-hidden="true" tabindex="-1"></a>            id<span class="op">:</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="tests-133"><a href="#tests-133" aria-hidden="true" tabindex="-1"></a>            m<span class="op">:</span> <span class="dv">165</span><span class="op">,</span></span>
<span id="tests-134"><a href="#tests-134" aria-hidden="true" tabindex="-1"></a>            items<span class="op">:</span> <span class="pp">vec!</span>[ (<span class="dv">86</span><span class="op">,</span>  <span class="dv">744</span>)</span>
<span id="tests-135"><a href="#tests-135" aria-hidden="true" tabindex="-1"></a>                       <span class="op">,</span> (<span class="dv">214</span><span class="op">,</span> <span class="dv">1373</span>)</span>
<span id="tests-136"><a href="#tests-136" aria-hidden="true" tabindex="-1"></a>                       <span class="op">,</span> (<span class="dv">236</span><span class="op">,</span> <span class="dv">1571</span>)</span>
<span id="tests-137"><a href="#tests-137" aria-hidden="true" tabindex="-1"></a>                       <span class="op">,</span> (<span class="dv">239</span><span class="op">,</span> <span class="dv">2388</span>)</span>
<span id="tests-138"><a href="#tests-138" aria-hidden="true" tabindex="-1"></a>                       ]<span class="op">,</span></span>
<span id="tests-139"><a href="#tests-139" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="tests-140"><a href="#tests-140" aria-hidden="true" tabindex="-1"></a>        a<span class="op">.</span>branch_and_bound()<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-141"><a href="#tests-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-142"><a href="#tests-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-143"><a href="#tests-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>ignore<span class="at">]</span></span>
<span id="tests-144"><a href="#tests-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>test<span class="at">]</span></span>
<span id="tests-145"><a href="#tests-145" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> bb_is_correct() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-146"><a href="#tests-146" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">std::fs::</span>File<span class="op">;</span></span>
<span id="tests-147"><a href="#tests-147" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">std::io::</span>BufReader<span class="op">;</span></span>
<span id="tests-148"><a href="#tests-148" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> inst <span class="op">=</span> parse_line(</span>
<span id="tests-149"><a href="#tests-149" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(<span class="st">&quot;ds/NK15_inst.dat&quot;</span>)<span class="op">?</span>)</span>
<span id="tests-150"><a href="#tests-150" aria-hidden="true" tabindex="-1"></a>        )<span class="op">?.</span>unwrap()<span class="op">;</span></span>
<span id="tests-151"><a href="#tests-151" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;testing {:?}&quot;</span><span class="op">,</span> inst)<span class="op">;</span></span>
<span id="tests-152"><a href="#tests-152" aria-hidden="true" tabindex="-1"></a>        inst<span class="op">.</span>branch_and_bound()<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-153"><a href="#tests-153" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(())</span>
<span id="tests-154"><a href="#tests-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-155"><a href="#tests-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-156"><a href="#tests-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>quickcheck<span class="at">]</span></span>
<span id="tests-157"><a href="#tests-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> qc_bb_is_really_correct(inst<span class="op">:</span> Instance) <span class="op">{</span></span>
<span id="tests-158"><a href="#tests-158" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(inst<span class="op">.</span>branch_and_bound()<span class="op">.</span>cost<span class="op">,</span> inst<span class="op">.</span>brute_force()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-159"><a href="#tests-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-160"><a href="#tests-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-161"><a href="#tests-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>quickcheck<span class="at">]</span></span>
<span id="tests-162"><a href="#tests-162" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> qc_dp_matches_bb(inst<span class="op">:</span> Instance) <span class="op">{</span></span>
<span id="tests-163"><a href="#tests-163" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert!</span>(inst<span class="op">.</span>branch_and_bound()<span class="op">.</span>cost <span class="op">&lt;=</span> inst<span class="op">.</span>dynamic_programming_w()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-164"><a href="#tests-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-165"><a href="#tests-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-166"><a href="#tests-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>quickcheck<span class="at">]</span></span>
<span id="tests-167"><a href="#tests-167" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> qc_dps_match(inst<span class="op">:</span> Instance) <span class="op">{</span></span>
<span id="tests-168"><a href="#tests-168" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert_eq!</span>(inst<span class="op">.</span>dynamic_programming_w()<span class="op">.</span>cost<span class="op">,</span> inst<span class="op">.</span>dynamic_programming_c()<span class="op">.</span>cost)<span class="op">;</span></span>
<span id="tests-169"><a href="#tests-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-170"><a href="#tests-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-171"><a href="#tests-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>quickcheck<span class="at">]</span></span>
<span id="tests-172"><a href="#tests-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> qc_greedy_is_valid(inst<span class="op">:</span> Instance) <span class="op">{</span></span>
<span id="tests-173"><a href="#tests-173" aria-hidden="true" tabindex="-1"></a>        inst<span class="op">.</span>greedy()<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-174"><a href="#tests-174" aria-hidden="true" tabindex="-1"></a>        inst<span class="op">.</span>greedy_redux()<span class="op">.</span>assert_valid()<span class="op">;</span></span>
<span id="tests-175"><a href="#tests-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-176"><a href="#tests-176" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div></main>



<script type="text/javascript">
  function init() {
    var hiddenElements = document.getElementsByClassName('doctestResult');
    for (var i = 0; i < hiddenElements.length; i++) {
      var element = hiddenElements[i];
      var details = document.createElement('details');
      var summary = document.createElement('summary');
      summary.innerHTML = 'Program output';
      details.id = element.id;
      details.innerHTML = element.innerHTML;
      details.className = element.className;
      details.style.display = 'block';
      details.appendChild(summary);
      element.parentNode.replaceChild(details, element);
    }
  }

  // when the page is loaded, run init
  document.addEventListener('DOMContentLoaded', init);
</script>

<!-- Bootstrap 4.5.0 -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

<!-- Mathjax -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
