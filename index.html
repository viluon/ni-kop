<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Ondřej Kvapil" />
  <title>NI-KOP – úkol 5</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- Bootstrap 4.5.0 stylesheet -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="css/mods.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<!-- <script data-main="scripts/main" src="js/require.js"></script> -->
  <!-- Load React. -->
  <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
<!--  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script> -->


</head>
<body class="d-flex flex-column">

<nav id="TOC" class="navbar navbar-dark bg-dark">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a href="#" class="ml-5 mr-auto navbar-brand">NI-KOP – úkol 5<br><span style="font-size: smaller">
        by <i>Ondřej Kvapil</i></span></a>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
<ul>
<li><a href="#kombinatorická-optimalizace-problém-vážené-splnitelnosti-booleovské-formule">Kombinatorická optimalizace: problém vážené splnitelnosti booleovské formule</a>
<ul>
<li><a href="#zadání">Zadání</a>
<ul>
<li><a href="#pokyny">Pokyny</a></li>
<li><a href="#hodnocení">Hodnocení</a></li>
<li><a href="#instance">Instance</a></li>
</ul></li>
<li><a href="#řešení">Řešení</a></li>
<li><a href="#instrukce-k-sestavení-programu">Instrukce k sestavení programu</a></li>
<li><a href="#benchmarking">Benchmarking</a>
<ul>
<li><a href="#white-box-průzkum-chování-algoritmu">White box: průzkum chování algoritmu</a></li>
<li><a href="#black-box-vyhodnocení-hustoty-chyb">Black box: vyhodnocení hustoty chyb</a></li>
</ul></li>
<li><a href="#implementace">Implementace</a></li>
<li><a href="#závěr">Závěr</a></li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#měření-výkonu">Měření výkonu</a></li>
<li><a href="#spouštění-jednotlivých-řešičů">Spouštění jednotlivých řešičů</a></li>
<li><a href="#automatické-testy">Automatické testy</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</nav>

<!-- <nav class="navbar navbar-dark navbar-expand-md bg-dark mb-4">
<p class="author">Ondřej Kvapil</p>
</nav>
 -->

<main role="main" class="flex-fill"><div class="container my-5">
<h1 id="kombinatorická-optimalizace-problém-vážené-splnitelnosti-booleovské-formule">Kombinatorická optimalizace: problém vážené splnitelnosti booleovské formule</h1>
<p><strong>TODO</strong>: - kontrola nad <code>InstanceParams</code> z Pythonu (především pro vizualizace)</p>
<h2 id="zadání">Zadání</h2>
<h3 id="pokyny">Pokyny</h3>
<p>Problém řešte některou z pokročilých heuristik:</p>
<ul>
<li>simulované ochlazování</li>
<li><strong>genetický algoritmus</strong></li>
<li>tabu prohledávání</li>
</ul>
<p>Po nasazení heuristiky ověřte její vlastnosti experimentálním vyhodnocením, které přesvědčivě doloží, jakou třídu (rozsah, velikosti…) instancí heuristika zpracovává. Zejména v případě použití nestandardních, např. originálních technik doložte jejich účinnost experimentálně (což vyloučí případné diskuse o jejich vhodnosti).</p>
<p>Zpráva by měla dokládat Váš racionální přístup k řešení problému, tedy celý pracovní postup. Ve zprávě prosím také popište obě fáze nasazení heuristiky, jak nastavení, (white box fáze), tak závěrečné vyhodnocení heuristiky (black box fáze). Prosím používejte definované formáty pro instance a řešení, usnadníte tak lepší přizpůsobení zkušebních instancí.</p>
<h3 id="hodnocení">Hodnocení</h3>
<p>Tato úloha je součástí hodnocení zkoušky - až 30 bodů ze 100 za předmět celkem. Práce by měla doložit Vaši schopnost nasadit pokročilé heuristiky na netriviální optimalizační problém. Nasazená heuristika by měla zpracovávat rozumně široké spektrum instancí s rozumnou chybou. Co je “rozumně”, bychom se měli dočíst v závěru Vaší práce.</p>
<p>V hodnocení je kladen důraz na racionální postup celé práce. Pokud postup vyhovuje, méně uspokojivé výsledky heuristiky příliš nevadí, vzhledem k tomu, že řešený problém (jak jistě víte) patří k nejtěžším ve třídě NPO. Proto potřebujeme znát jak pracovní postup ve white box fázi, tak výsledky a závěr black box fáze.</p>
<p>Hodnocení je rozděleno do tří kategorií:</p>
<ul>
<li>Algoritmus a implementace (5 pt.)
<ul>
<li>Byly použity techniky (algoritmy, datové struktury) adekvátní problému?</li>
<li>Byly použity pokročilé techniky? (např. adaptační mechanismy)</li>
<li>Jsou některé postupy originálním přínosem autora?</li>
</ul></li>
<li>Nastavení heuristiky (13 pt.)
<ul>
<li>Jakou metodou autor hledal nastavení parametrů?</li>
<li>Jak byly plánovány experimenty a jaké byly jejich otázky?</li>
<li>Jestliže byl proveden faktorový návrh (což příliš nedoporučujeme), jak kompletní byl (změna vždy jen jednoho parametru nestačí)?</li>
<li>Na jak velkých instancích je heuristika schopna pracovat?</li>
<li>Jestliže práce heuristiky není uspokojivá, jak systematické byly snahy autora zjednat nápravu?</li>
</ul></li>
<li>Experimentální vyhodnocení heuristiky (12 pt.)
<ul>
<li>Jak dalece jsou závěry vyhodnocení doloženy experimentálně?</li>
<li>Je interpretace experimentů přesvědčivá?</li>
<li>Pokud je algoritmus randomizovaný, byla tato skutečnost vzata v úvahu při plánování experimentů?</li>
<li>Je možno z experimentů usoudit na iterativní sílu heuristiky?</li>
<li>Byly nestandardní postupy experimentálně porovnány se standardními?</li>
<li>Jsou výsledky experimentů srozumitelně prezentovány (grafy, tabulky, statistické metody)?</li>
</ul></li>
</ul>
<p>Práce bez experimentální části nemůže být přijata k hodnocení.</p>
<h3 id="instance">Instance</h3>
<ul>
<li>SAT instance lze generovat náhodně. Klíčovým parametrem je poměr počtu klauzulí k počtu proměnných pro 3-SAT (viz ai-phys1.pdf - doporučujeme). Váhy lze generovat náhodně. V takovém případě je vhodné prokázat, že instance, kde všechny váhy byly vynásobeny velkým číslem, jsou zpracovávány stejně úspěšně.</li>
<li>Lze vyjít z <a href="http://www.cs.ubc.ca/~hoos/SATLIB/benchm.html">DIMACS</a> SAT instancí. Nemají váhy, jejich generování viz výše.Tyto instance jsou na hraně fázového přechodu, jsou tedy značně obtížné. Obtížnost můžete snížit zkrácením (vynechání klauzulí).</li>
<li>Připravili jsme sady zkušebních instancí. Vycházejí z instancí SATLIB, jsou ale zkráceny tak, aby měly co nejvíce řešení (počty řešení přikládáme). Váhy nejsou náhodné, mají ale náhodnou složku. Za upozornění na chyby, nekonzistence atd. budeme vděčni.
<ul>
<li><code>wuf-M</code> a <code>wuf-N</code>: Váhy by měly podporovat nalezení řešení. Heuristika, která řeší určitou instanci v sadě <code>wuf-M</code>, by měla řešit odpovídající instanci v sadě <code>wuf-N</code> stejně snadno. Vzhledem k počtu řešení jednotlivých instací (až 108), není možné efektivně najít optimální řešení</li>
<li><code>wuf-Q</code> a <code>wuf-R</code>: Jako výše, váhy ale vytvářejí (mírně) zavádějící úlohu.</li>
<li><code>wuf-A</code>: z dílny prof. Zlomyslného. Instance vycházejí z nezkrácených (nebo jen mírně zkrácených) instancí, takže jsou obtížné. Váhy vytvářejí zavádějící úlohu. Nicméně, malý počet řešení dovoluje ve většině případů uvést optimální řešení.</li>
</ul></li>
</ul>
<h2 id="řešení">Řešení</h2>
<p>Úkoly předmětu NI-KOP jsem se rozhodl implementovat v jazyce Rust za pomoci nástrojů na <em>literate programming</em> – přístup k psaní zdrojového kódu, který upřednostňuje lidsky čitelný popis před seznamem příkazů pro počítač. Tento dokument obsahuje veškerý zdrojový kód nutný k reprodukci mojí práce. Výsledek je dostupný online jako statická <a href="http://viluon.me/ni-kop/">webová stránka</a> a <a href="http://viluon.me/ni-kop/report.pdf">ke stažení v PDF</a>.</p>
<h2 id="instrukce-k-sestavení-programu">Instrukce k sestavení programu</h2>
<p>Program využívá standardních nástrojů jazyka Rust. O sestavení stačí požádat <code>cargo</code>.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#build-instructions-container" aria-controls="build-instructions-container">&lt;&lt;build-instructions&gt;&gt;=</button>
<div id="build-instructions-container" class="collapse">
<div class="sourceCode" id="build-instructions" style="max-height: 50vh"><pre class="sourceCode zsh eval bootstrap-fold overflow-auto"><code class="sourceCode zsh"><span id="build-instructions-1"><a href="#build-instructions-1" aria-hidden="true" tabindex="-1"></a><span class="kw">cd</span> solver</span>
<span id="build-instructions-2"><a href="#build-instructions-2" aria-hidden="true" tabindex="-1"></a>cargo build --release --color always</span></code></pre></div>
</div>
</div>
</div>
<div class="doctestResult">
<div class="programOutput">
<pre class="ansi2html-content">info: syncing channel updates for 'nightly-x86_64-unknown-linux-gnu'
info: latest update on 2022-01-29, rust version 1.60.0-nightly (e0a55f449 2022-01-28)
info: downloading component 'cargo'
info: downloading component 'rust-std'
info: downloading component 'rustc'
info: installing component 'cargo'
info: installing component 'rust-std'
info: installing component 'rustc'
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">    Updating</span> crates.io index
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00"> Downloading</span> crates ...
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> env_logger v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> itoa v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> aho-corasick v0.7.18
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> quickcheck v1.0.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> proc-macro2 v1.0.29
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> rand_xoshiro v0.6.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> scopeguard v1.1.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> rayon-core v1.9.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> serde_json v1.0.78
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> wyz v0.4.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> syn v1.0.80
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> crossbeam-deque v0.8.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> either v1.6.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> memoffset v0.6.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> num_cpus v1.13.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> log v0.4.14
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> radium v0.6.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> permutation v0.2.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> arrayvec v0.7.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> libc v0.2.103
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> anyhow v1.0.44
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> crossbeam-epoch v0.9.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> crossbeam-utils v0.8.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> crossbeam-channel v0.5.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> bitvec v0.22.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> tap v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> rayon v1.5.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> quickcheck_macros v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">  Downloaded</span> funty v1.2.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> cfg-if v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> libc v0.2.103
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> autocfg v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> proc-macro2 v1.0.29
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> crossbeam-utils v0.8.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> unicode-xid v0.2.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> memchr v2.4.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> syn v1.0.80
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> lazy_static v1.4.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> crossbeam-epoch v0.9.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rayon-core v1.9.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> log v0.4.14
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> serde_derive v1.0.130
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> scopeguard v1.1.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> regex-syntax v0.6.25
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> ryu v1.0.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> serde v1.0.130
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> radium v0.6.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> ppv-lite86 v0.2.15
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> anyhow v1.0.44
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> tap v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> serde_json v1.0.78
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> either v1.6.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> itoa v1.0.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> funty v1.2.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> arrayvec v0.7.2
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> permutation v0.2.5
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> memoffset v0.6.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rayon v1.5.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> wyz v0.4.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> getrandom v0.2.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> num_cpus v1.13.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> crossbeam-channel v0.5.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> aho-corasick v0.7.18
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quote v1.0.10
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> bitvec v0.22.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand_core v0.6.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> regex v1.5.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> crossbeam-deque v0.8.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand_chacha v0.3.1
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand_xoshiro v0.6.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> env_logger v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quickcheck_macros v1.0.0
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> rand v0.8.4
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> quickcheck v1.0.3
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">   Compiling</span> solver v0.1.0 (/__w/ni-kop/ni-kop/5-weighted-sat/solver)
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #00aa00">    Finished</span> release [optimized + debuginfo] target(s) in 2m 07s
</pre>
</div>
</div>
</div>
<h2 id="benchmarking">Benchmarking</h2>
<p>Stejně jako v předchozí úloze jsem se ani tentokrát s měřením výkonu nespoléhal na existující Rust knihovny a namísto toho provedl měření v Pythonu.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#machine-info-container" aria-controls="machine-info-container">&lt;&lt;machine-info&gt;&gt;=</button>
<div id="machine-info-container" class="collapse">
<div class="sourceCode" id="machine-info" style="max-height: 50vh"><pre class="sourceCode zsh eval bootstrap-fold overflow-auto"><code class="sourceCode zsh"><span id="machine-info-1"><a href="#machine-info-1" aria-hidden="true" tabindex="-1"></a>uname -a</span>
<span id="machine-info-2"><a href="#machine-info-2" aria-hidden="true" tabindex="-1"></a>./cpufetch --logo-short --color ibm</span></code></pre></div>
</div>
</div>
</div>
<div class="doctestResult">
<div class="programOutput">
<pre class="ansi2html-content">Linux 27b544eac5c1 5.11.0-1027-azure #30~20.04.1-Ubuntu SMP Wed Jan 12 20:56:50 UTC 2022 x86_64 GNU/Linux

<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">                   .#################.          </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Name:</span>       <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Intel Xeon Platinum </span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">              .####                   ####.     </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Hypervisor:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Microsoft Hyper-V</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">          .##                             ###   </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">uArch:</span>      <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Skylake</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">       ##                          :##     ###  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Technology:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">14nm</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">    #                ##            :##      ##  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Max Freq:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Unknown</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">  ##   ##  ######.   ####  ######  :##      ##  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Cores:</span>      <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">2 cores</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7"> ##    ##  ##:  ##:  ##   ##   ### :##     ###  </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">AVX:</span>        <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">AVX,AVX2,AVX512</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##     ##  ##:  ##:  ##  :######## :##    ##    </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">FMA:</span>        <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">FMA3</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##     ##  ##:  ##:  ##   ##.   .  :## ####     </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L1i Size:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">32KB (64KB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">##      #  ##:  ##:  ####  #####:   ##          </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L1d Size:</span>   <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">32KB (64KB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7"> ##                                             </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L2 Size:</span>    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">1MB (2MB Total)</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">  ###.                         ..o####.         </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">L3 Size:</span>    <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">35.75MB</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">   ######oo...         ..oo#######              </span><span style="font-weight: bold"></span><span style="font-weight: bold; color: #585858">Peak Perf.:</span> <span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">Unknown</span>
<span style="font-weight: bold"></span><span style="font-weight: bold; color: #8700d7">          o###############o                     </span>

</pre>
</div>
</div>
</div>
<h3 id="white-box-průzkum-chování-algoritmu">White box: průzkum chování algoritmu</h3>
<p>Následující soubor slouží k vyhodnocení algoritmu na různých datových sadách s různými parametry. Spouští implementaci v jazyce Rust a výsledky měření ukládá do binárního souboru pro následnou analýzu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#analysis-slash-measure-dot-py-container" aria-controls="analysis-slash-measure-dot-py-container">&lt;&lt;analysis/measure.py&gt;&gt;=</button>
<div id="analysis-slash-measure-dot-py-container" class="collapse">
<div class="sourceCode" id="cb1" data-file="analysis/measure.py" style="max-height: 50vh"><pre class="sourceCode python bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> product, chain</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> subprocess <span class="im">import</span> run, PIPE</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>show_progress <span class="op">=</span> os.environ.get(<span class="st">&quot;JUPYTER&quot;</span>) <span class="op">==</span> <span class="va">None</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># adapted from https://stackoverflow.com/questions/3173320/text-progress-bar-in-the-console</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> progress_bar(iteration, total, length <span class="op">=</span> <span class="dv">60</span>):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> show_progress:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (<span class="st">&quot;</span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>).<span class="bu">format</span>(<span class="dv">100</span> <span class="op">*</span> (iteration <span class="op">/</span> <span class="bu">float</span>(total)))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    filledLength <span class="op">=</span> <span class="bu">int</span>(length <span class="op">*</span> iteration <span class="op">//</span> total)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    bar <span class="op">=</span> <span class="st">&#39;=&#39;</span> <span class="op">*</span> filledLength <span class="op">+</span> <span class="st">&#39; &#39;</span> <span class="op">*</span> (length <span class="op">-</span> filledLength)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="ch">\r</span><span class="ss">[</span><span class="sc">{</span>bar<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>percent<span class="sc">}</span><span class="ss">%&#39;</span>, end <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\r</span><span class="st">&quot;</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> iteration <span class="op">==</span> total:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invoke_solver(cfg):</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> run(</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;target/release/main&quot;</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            json.dumps(cfg),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        stdout <span class="op">=</span> PIPE,</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        encoding <span class="op">=</span> <span class="st">&quot;ascii&quot;</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        cwd <span class="op">=</span> <span class="st">&quot;solver/&quot;</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        env <span class="op">=</span> {</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RUST_BACKTRACE&quot;</span>: <span class="st">&quot;1&quot;</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">**</span>os.environ,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> solver.returncode <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(solver)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&quot;solver failed&quot;</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> []</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line <span class="kw">in</span> solver.stdout.split(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)[<span class="dv">8</span>:]:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> line.startswith(<span class="st">&quot;done: &quot;</span>):</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            [_, time, inst_id, satisfied, valid, weight, err] <span class="op">=</span> line.split()</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            results.append((<span class="bu">float</span>(time), <span class="bu">int</span>(inst_id), satisfied <span class="op">==</span> <span class="st">&quot;true&quot;</span>, valid <span class="op">==</span> <span class="st">&quot;true&quot;</span>, <span class="bu">float</span>(weight), <span class="bu">float</span>(err), stats))</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> []</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            stats.append(<span class="bu">list</span>(<span class="bu">map</span>(<span class="bu">float</span>, line.split())))</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dataset(<span class="bu">id</span>, <span class="op">**</span>kwargs):</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> <span class="bu">dict</span>({</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># defaults</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;id&quot;</span>: [<span class="bu">id</span>],</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;set&quot;</span>: [<span class="st">&quot;M&quot;</span>],</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;n_instances&quot;</span>: [<span class="dv">15</span>],</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;generations&quot;</span>: [<span class="dv">200</span>],</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;mutation_chance&quot;</span>: [<span class="fl">0.02</span>],</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;population_size&quot;</span>: [<span class="dv">1000</span>],</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    }, <span class="op">**</span>kwargs)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    key_order <span class="op">=</span> [k <span class="cf">for</span> k <span class="kw">in</span> params]</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    cartesian <span class="op">=</span> <span class="bu">list</span>(product(</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>[params[key] <span class="cf">for</span> key <span class="kw">in</span> key_order]</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        key: [row[key_order.index(key)] <span class="cf">for</span> row <span class="kw">in</span> cartesian] <span class="cf">for</span> key <span class="kw">in</span> params</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_datasets(<span class="op">*</span>dss):</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        k: <span class="bu">list</span>(chain(<span class="op">*</span>(ds[k] <span class="cf">for</span> ds <span class="kw">in</span> dss)))</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k <span class="kw">in</span> dss[<span class="dv">0</span>]</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>datasets<span class="op">&gt;&gt;</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame()</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>cfgs <span class="op">=</span> [<span class="bu">dict</span>(<span class="bu">zip</span>(configs, v)) <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>configs.values())]</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">sum</span>([cfg[<span class="st">&quot;n_instances&quot;</span>] <span class="op">*</span> cfg[<span class="st">&quot;generations&quot;</span>] <span class="cf">for</span> cfg <span class="kw">in</span> cfgs])</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config <span class="kw">in</span> cfgs:</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> show_progress:</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(end <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\033</span><span class="st">[2K&quot;</span>)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(json.dumps(config))</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    progress_bar(iteration, total)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (t, inst_id, satisfied, valid, weight, err, stats) <span class="kw">in</span> invoke_solver(config):</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data.append(<span class="bu">dict</span>(config,</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            error   <span class="op">=</span> err,</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>            inst_id <span class="op">=</span> inst_id,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>            stats   <span class="op">=</span> stats,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            time    <span class="op">=</span> t,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>            valid   <span class="op">=</span> valid,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            weight  <span class="op">=</span> weight,</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        ), ignore_index <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        iteration <span class="op">=</span> iteration <span class="op">+</span> config[<span class="st">&quot;generations&quot;</span>]</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        progress_bar(iteration, total)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>data.to_pickle(<span class="st">&quot;docs/assets/measurements.pkl&quot;</span>)</span></code></pre></div>
</div>
</div>
<div class="doctest" data-status="ERROR">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#perform-measurement-container" aria-controls="perform-measurement-container">&lt;&lt;perform-measurement&gt;&gt;=</button>
<div id="perform-measurement-container" class="collapse">
<div class="sourceCode" id="perform-measurement" style="max-height: 50vh"><pre class="sourceCode python eval bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="perform-measurement-1"><a href="#perform-measurement-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tento blok slouží pouze ke spuštění skriptu výše</span></span>
<span id="perform-measurement-2"><a href="#perform-measurement-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (vynucen nedostatkem nástroje, který má tvorbu dokumentu na starosti)</span></span>
<span id="perform-measurement-3"><a href="#perform-measurement-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>analysis<span class="op">/</span>measure.py<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
</div>
<div class="doctestError">
<div class="programOutput">
<pre class="ansi2html-content"><span style="color: #aa0000">---------------------------------------------------------------------------</span>
<span style="color: #aa0000">Exception</span>                                 Traceback (most recent call last)
<span style="color: #00aa00">/tmp/ipykernel_2183/94418317.py</span> in <span style="color: #00aaaa">&lt;module&gt;</span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    131</span>     progress_bar<span style="color: #0000aa">(</span>iteration<span style="color: #0000aa">,</span> total<span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    132</span> <span style="color: #0000aa"></span>
<span style="color: #00aa00">--&gt; 133</span><span style="color: #aa0000">     </span><span style="color: #00aa00">for</span> <span style="color: #0000aa">(</span>t<span style="color: #0000aa">,</span> inst_id<span style="color: #0000aa">,</span> satisfied<span style="color: #0000aa">,</span> valid<span style="color: #0000aa">,</span> weight<span style="color: #0000aa">,</span> err<span style="color: #0000aa">,</span> stats<span style="color: #0000aa">)</span> <span style="color: #00aa00">in</span> invoke_solver<span style="color: #0000aa">(</span>config<span style="color: #0000aa">)</span><span style="color: #0000aa">:</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    134</span>         data = data.append(dict(config,
<span style="font-weight: bold; color: #00aa00">    135</span>             error   <span style="color: #0000aa">=</span> err<span style="color: #0000aa">,</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>

<span style="color: #00aa00">/tmp/ipykernel_2183/94418317.py</span> in <span style="color: #00aaaa">invoke_solver</span><span style="color: #0000aa">(cfg)</span>
<span style="font-weight: bold; color: #00aa00">     36</span>     <span style="color: #00aa00">if</span> solver<span style="color: #0000aa">.</span>returncode <span style="color: #0000aa">!=</span> <span style="color: #00aaaa">0</span><span style="color: #0000aa">:</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     37</span>         print<span style="color: #0000aa">(</span>solver<span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="color: #00aa00">---&gt; 38</span><span style="color: #aa0000">         </span><span style="color: #00aa00">raise</span> Exception<span style="color: #0000aa">(</span><span style="color: #0000aa">"solver failed"</span><span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     39</span> <span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     40</span>     results <span style="color: #0000aa">=</span> <span style="color: #0000aa">[</span><span style="color: #0000aa">]</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>

<span style="color: #aa0000">Exception</span>: solver failed</pre>
</div>
</div>
</div>
<p>V tuto chvíli ještě nevíme, ve kterých oblastech prostoru všech konfigurací parametrů evolučního algoritmu se skrývají efektivní řešiče problému. Protože vyhodnocení kartézského součinu všech množin parametrů by zabralo moc dlouho, zaměříme se pouze na zajímavé podprostory. Ty jsou generovány funkcí <code>dataset</code>, která vytvoří pojmenovaný podprostor konfigurací kartézského součinu zadaných hodnot všech parametrů. Sjednocením těchto podprostorů dostaneme podprostor všech konfigurací, pro které je třeba algoritmus vyhodnotit.</p>
<div class="annotated-code">
<p><span><em>«datasets»=</em></span></p>
<div class="sourceCode" id="datasets"><pre class="sourceCode python"><code class="sourceCode python"><span id="datasets-1"><a href="#datasets-1" aria-hidden="true" tabindex="-1"></a>configs <span class="op">=</span> merge_datasets(dataset(</span>
<span id="datasets-2"><a href="#datasets-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;default&quot;</span>,</span>
<span id="datasets-3"><a href="#datasets-3" aria-hidden="true" tabindex="-1"></a>    generations <span class="op">=</span> [<span class="dv">1000</span>],</span>
<span id="datasets-4"><a href="#datasets-4" aria-hidden="true" tabindex="-1"></a>    mutation_chance <span class="op">=</span> [<span class="fl">0.03</span>],</span>
<span id="datasets-5"><a href="#datasets-5" aria-hidden="true" tabindex="-1"></a>), dataset(</span>
<span id="datasets-6"><a href="#datasets-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;mutation_exploration&quot;,</span></span>
<span id="datasets-7"><a href="#datasets-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_instances = [6],</span></span>
<span id="datasets-8"><a href="#datasets-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutation_chance = [0.005, 0.01, 0.02, 0.05, 0.1, 0.2, 0.5],</span></span>
<span id="datasets-9"><a href="#datasets-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-10"><a href="#datasets-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_N&quot;,</span></span>
<span id="datasets-11"><a href="#datasets-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;N&quot;],</span></span>
<span id="datasets-12"><a href="#datasets-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [500],</span></span>
<span id="datasets-13"><a href="#datasets-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-14"><a href="#datasets-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_Q&quot;,</span></span>
<span id="datasets-15"><a href="#datasets-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;Q&quot;],</span></span>
<span id="datasets-16"><a href="#datasets-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [500],</span></span>
<span id="datasets-17"><a href="#datasets-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-18"><a href="#datasets-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_R&quot;,</span></span>
<span id="datasets-19"><a href="#datasets-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;R&quot;],</span></span>
<span id="datasets-20"><a href="#datasets-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [500],</span></span>
<span id="datasets-21"><a href="#datasets-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-22"><a href="#datasets-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dataset_A&quot;</span>,</span>
<span id="datasets-23"><a href="#datasets-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">set</span> <span class="op">=</span> [<span class="st">&quot;A&quot;</span>],</span>
<span id="datasets-24"><a href="#datasets-24" aria-hidden="true" tabindex="-1"></a>    generations <span class="op">=</span> [<span class="dv">500</span>],</span>
<span id="datasets-25"><a href="#datasets-25" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> [<span class="dv">1_000</span>],</span>
<span id="datasets-26"><a href="#datasets-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-27"><a href="#datasets-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_Q_exploration&quot;,</span></span>
<span id="datasets-28"><a href="#datasets-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;Q&quot;],</span></span>
<span id="datasets-29"><a href="#datasets-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [2000],</span></span>
<span id="datasets-30"><a href="#datasets-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     population_size = [2000],</span></span>
<span id="datasets-31"><a href="#datasets-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutation_chance = [0.001, 0.01, 0.03, 0.05, 0.1, 0.2]</span></span>
<span id="datasets-32"><a href="#datasets-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-33"><a href="#datasets-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_R_exploration&quot;,</span></span>
<span id="datasets-34"><a href="#datasets-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;R&quot;],</span></span>
<span id="datasets-35"><a href="#datasets-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [2000],</span></span>
<span id="datasets-36"><a href="#datasets-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     population_size = [2000],</span></span>
<span id="datasets-37"><a href="#datasets-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutation_chance = [0.001, 0.01, 0.03, 0.05, 0.1, 0.2]</span></span>
<span id="datasets-38"><a href="#datasets-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ), dataset(</span></span>
<span id="datasets-39"><a href="#datasets-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_A_exploration&quot;,</span></span>
<span id="datasets-40"><a href="#datasets-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     set = [&quot;A&quot;],</span></span>
<span id="datasets-41"><a href="#datasets-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     generations = [2000],</span></span>
<span id="datasets-42"><a href="#datasets-42" aria-hidden="true" tabindex="-1"></a><span class="co">#     population_size = [2000],</span></span>
<span id="datasets-43"><a href="#datasets-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutation_chance = [0.001, 0.01, 0.03, 0.05, 0.1, 0.2]</span></span>
<span id="datasets-44"><a href="#datasets-44" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div>
</div>
<p>Po vyhodnocení algoritmu pro různé parametry je čas na vizualizaci a analýzu výsledků. O tu se stará další program, který využívá vizualizací vyvinutých v předchozích úkolech, a přidává vlastní. Rozdělení na dvě fáze (měření a vizualizace zvlášť) se serializací do binárního souboru uprostřed vede ke zkrácení iteračního cyklu během whitebox fáze vývoje algoritmu. Je-li třeba poupravit detaily grafu, měření se nemusí provádět znovu, a naopak.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#analysis-slash-plot-dot-py-container" aria-controls="analysis-slash-plot-dot-py-container">&lt;&lt;analysis/plot.py&gt;&gt;=</button>
<div id="analysis-slash-plot-dot-py-container" class="collapse">
<div class="sourceCode" id="cb2" data-file="analysis/plot.py" style="max-height: 50vh"><pre class="sourceCode python bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patheffects <span class="im">as</span> PathEffects</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap <span class="im">as</span> tr</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_pickle(<span class="st">&quot;docs/assets/measurements.pkl&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>show_progress <span class="op">=</span> os.environ.get(<span class="st">&quot;JUPYTER&quot;</span>) <span class="op">==</span> <span class="va">None</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plot_labels <span class="op">=</span> <span class="bu">dict</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    error           <span class="op">=</span> <span class="st">&quot;Chyba oproti optimálnímu řešení [%]&quot;</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    generations     <span class="op">=</span> <span class="st">&quot;Počet generací&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    mutation_chance <span class="op">=</span> <span class="st">&quot;Pravděpodobnost mutace&quot;</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    n_instances     <span class="op">=</span> <span class="st">&quot;Počet instancí&quot;</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">set</span>             <span class="op">=</span> <span class="st">&quot;Datová sada&quot;</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    time            <span class="op">=</span> <span class="st">&quot;Doba běhu [s]&quot;</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    weight          <span class="op">=</span> <span class="st">&quot;Váha řešení&quot;</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>scheduled_plots <span class="op">=</span> []</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> progress_bar(iteration, total, length <span class="op">=</span> <span class="dv">60</span>):</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> show_progress:</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (<span class="st">&quot;</span><span class="sc">{0:.1f}</span><span class="st">&quot;</span>).<span class="bu">format</span>(<span class="dv">100</span> <span class="op">*</span> (iteration <span class="op">/</span> <span class="bu">float</span>(total)))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    filledLength <span class="op">=</span> <span class="bu">int</span>(length <span class="op">*</span> iteration <span class="op">//</span> total)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    bar <span class="op">=</span> <span class="st">&#39;=&#39;</span> <span class="op">*</span> filledLength <span class="op">+</span> <span class="st">&#39; &#39;</span> <span class="op">*</span> (length <span class="op">-</span> filledLength)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&#39;</span><span class="ch">\r</span><span class="ss">[</span><span class="sc">{</span>bar<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>percent<span class="sc">}</span><span class="ss">%&#39;</span>, end <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\r</span><span class="st">&quot;</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> iteration <span class="op">==</span> total:</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ridgeline(<span class="bu">id</span>, title, col, filename, x_label <span class="op">=</span> <span class="st">&quot;Chyba oproti optimálnímu řešení [%]&quot;</span>, progress <span class="op">=</span> <span class="kw">lambda</span> _: <span class="va">None</span>):</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data[data[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    series <span class="op">=</span> df.groupby(col)[<span class="st">&quot;error&quot;</span>].mean()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">&quot;mean error&quot;</span>] <span class="op">=</span> df[col].<span class="bu">map</span>(series)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot the error distributions for each value of col</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    plt.style.use(<span class="st">&quot;default&quot;</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    sns.set_theme(style <span class="op">=</span> <span class="st">&quot;white&quot;</span>, rc <span class="op">=</span> {<span class="st">&quot;axes.facecolor&quot;</span>: (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)})</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    pal <span class="op">=</span> sns.color_palette(<span class="st">&quot;crest&quot;</span>, n_colors <span class="op">=</span> <span class="bu">len</span>(df[col].unique()))</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set up the layout</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.FacetGrid(</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        df,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        row <span class="op">=</span> col,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        hue <span class="op">=</span> <span class="st">&quot;mean error&quot;</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> pal,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        aspect <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    plt.xlim(<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># distributions</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(sns.kdeplot, <span class="st">&quot;error&quot;</span>, clip <span class="op">=</span> (<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>), bw_adjust <span class="op">=</span> <span class="dv">1</span>, clip_on <span class="op">=</span> <span class="va">False</span>, fill <span class="op">=</span> <span class="va">True</span>, alpha <span class="op">=</span> <span class="dv">1</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># contours</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(sns.kdeplot, <span class="st">&quot;error&quot;</span>, clip <span class="op">=</span> (<span class="op">-</span><span class="fl">0.1</span>, <span class="fl">1.0</span>), bw_adjust <span class="op">=</span> <span class="dv">1</span>, clip_on <span class="op">=</span> <span class="va">False</span>, color <span class="op">=</span> <span class="st">&quot;w&quot;</span>, lw <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># horizontal lines</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">map</span>(plt.axhline, y <span class="op">=</span> <span class="dv">0</span>, lw <span class="op">=</span> <span class="dv">2</span>, clip_on <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># overlap</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    g.fig.subplots_adjust(hspace <span class="op">=</span> <span class="op">-</span><span class="fl">0.3</span>)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">enumerate</span>(g.axes.flat):</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        ax.annotate(</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>            df[col].unique()[i],</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>            (<span class="op">-</span><span class="fl">16.5</span>, <span class="dv">3</span>),</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>            xycoords <span class="op">=</span> <span class="st">&quot;axes fraction&quot;</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>            textcoords <span class="op">=</span> <span class="st">&quot;offset points&quot;</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>            va <span class="op">=</span> <span class="st">&quot;baseline&quot;</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>            fontsize <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> ax.lines[<span class="op">-</span><span class="dv">1</span>].get_color(),</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            path_effects <span class="op">=</span> [</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>                PathEffects.withStroke(linewidth <span class="op">=</span> <span class="fl">0.5</span>, foreground <span class="op">=</span> <span class="st">&quot;w&quot;</span>)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove titles, y ticks, spines</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    g.set_titles(<span class="st">&quot;&quot;</span>)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    g.<span class="bu">set</span>(yticks <span class="op">=</span> [])</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    g.despine(left <span class="op">=</span> <span class="va">True</span>, bottom <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    g.fig.suptitle(title, fontsize <span class="op">=</span> <span class="dv">20</span>, ha <span class="op">=</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> g.axes.flat:</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        ax.xaxis.set_major_formatter(<span class="kw">lambda</span> x, pos: <span class="ss">f&quot;</span><span class="sc">{x</span> <span class="op">*</span> <span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    g.set_xlabels(x_label)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    g.set_ylabels(<span class="st">&quot;&quot;</span>)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    g.savefig(<span class="ss">f&quot;docs/assets/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    progress(<span class="dv">1</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> boxplot(x_axis, y_axis, <span class="bu">id</span>, title, grouping_column, data <span class="op">=</span> data, filename <span class="op">=</span> <span class="va">None</span>, progress <span class="op">=</span> <span class="kw">lambda</span> _: <span class="va">None</span>):</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="bu">id</span>.replace(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>) <span class="op">+</span> <span class="st">&quot;.svg&quot;</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\t</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    ds <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> data <span class="cf">if</span> d[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a frame from the list</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(ds)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># do a grouped boxplot</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x_axis,</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> y_axis,</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df,</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        hue <span class="op">=</span> grouping_column,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> ax,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        linewidth <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># render the datapoints as dots with horizontal jitter</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    sns.stripplot(</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> x_axis,</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> y_axis,</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> df,</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>        hue <span class="op">=</span> grouping_column,</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> ax,</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        jitter <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        dodge <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        linewidth <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        alpha <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        edgecolor <span class="op">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(plot_labels[x_axis])</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(plot_labels[y_axis])</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    constant_columns <span class="op">=</span> [</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>        col <span class="cf">for</span> col <span class="kw">in</span> df.columns[df.nunique() <span class="op">&lt;=</span> <span class="dv">1</span>]</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">&quot;id&quot;</span>, <span class="st">&quot;n_instances&quot;</span>, <span class="st">&quot;contents&quot;</span>])</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    caption <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(tr.wrap(<span class="st">&quot;Konfigurace: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>({</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>        k: df[k][<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> constant_columns</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    }), width <span class="op">=</span> <span class="dv">170</span>))</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    fig.text(</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.09</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.05</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        caption,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>        fontsize <span class="op">=</span> <span class="st">&quot;small&quot;</span>,</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>        fontfamily <span class="op">=</span> <span class="st">&quot;monospace&quot;</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>        verticalalignment <span class="op">=</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># labels = [alg_labels[l] for l in labels]</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    plt.legend(handles[<span class="dv">0</span> : <span class="bu">int</span>(<span class="bu">len</span>(handles) <span class="op">/</span> <span class="dv">2</span>)], labels[<span class="dv">0</span> : <span class="bu">int</span>(<span class="bu">len</span>(labels) <span class="op">/</span> <span class="dv">2</span>)])</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f&quot;docs/assets/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.svg&quot;</span>)</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    progress(<span class="dv">1</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heatmap(<span class="bu">id</span>, title, filename, data <span class="op">=</span> data, progress <span class="op">=</span> <span class="kw">lambda</span> _: <span class="va">None</span>):</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> data[data[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> <span class="bu">list</span>(dataset[<span class="st">&quot;stats&quot;</span>])</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> <span class="bu">int</span>(dataset[<span class="st">&quot;inst_id&quot;</span>].count())</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset.describe())</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dataset.head())</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    n_generations <span class="op">=</span> <span class="bu">int</span>(dataset[<span class="st">&quot;generations&quot;</span>].<span class="bu">max</span>())</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    n_variables <span class="op">=</span> <span class="bu">len</span>(stats[<span class="dv">0</span>][<span class="dv">0</span>]) <span class="op">-</span> <span class="dv">2</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># math.sqrt(n_generations) * 0.5</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span> <span class="op">*</span> n_instances,</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>        figsize <span class="op">=</span> (n_instances <span class="op">*</span> n_variables <span class="op">*</span> <span class="fl">0.15</span>, <span class="dv">8</span>),</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        gridspec_kw <span class="op">=</span> {<span class="st">&quot;left&quot;</span>: <span class="fl">0.015</span>, <span class="st">&quot;right&quot;</span>: <span class="fl">0.975</span>, <span class="st">&quot;width_ratios&quot;</span>: [n_variables, <span class="dv">1</span>] <span class="op">*</span> n_instances},</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    fig.suptitle(title)</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, (_, inst_id), stats, (_, err) <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">10000</span>),</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>        dataset[<span class="st">&quot;inst_id&quot;</span>].iteritems(),</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>        stats,</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        dataset[<span class="st">&quot;error&quot;</span>].iteritems()</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>        inst_id <span class="op">=</span> <span class="bu">int</span>(inst_id)</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame(stats)</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> axs[<span class="dv">2</span> <span class="op">*</span> (i <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        err_ax <span class="op">=</span> axs[<span class="dv">2</span> <span class="op">*</span> i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f&quot;inst. </span><span class="sc">{</span>inst_id<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>        sns.heatmap(</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>            df.iloc[:, <span class="dv">2</span>:], <span class="co"># drop first column (with generation numbers) and second (with errors)</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> ax,</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>            vmin <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>            square <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>            cmap <span class="op">=</span> <span class="st">&quot;magma&quot;</span>,</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>            xticklabels <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>            yticklabels <span class="op">=</span> df.iloc[:, <span class="dv">0</span>].<span class="bu">map</span>(<span class="bu">int</span>) <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="va">False</span>,</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>            cbar_kws <span class="op">=</span> {<span class="st">&quot;shrink&quot;</span>: <span class="fl">0.5</span>, <span class="st">&quot;pad&quot;</span>: <span class="fl">0.2</span>},</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>            cbar <span class="op">=</span> i <span class="op">==</span> n_instances,</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>        ax_pos <span class="op">=</span> ax.get_position()</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>        err_pos <span class="op">=</span> err_ax.get_position()</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>        err_ax.set_position([ax_pos.x0 <span class="op">+</span> ax_pos.width <span class="op">*</span> <span class="fl">1.08</span>, err_pos.y0, err_pos.width, err_pos.height])</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>        mask <span class="op">=</span> df.iloc[:, <span class="dv">1</span>:<span class="dv">2</span>]</span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>        <span class="co"># disable false-positive warning</span></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>        pd.options.mode.chained_assignment <span class="op">=</span> <span class="va">None</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>        mask[<span class="dv">1</span>] <span class="op">=</span> mask[<span class="dv">1</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: x <span class="op">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>        sns.heatmap(</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>            df.iloc[:, <span class="dv">1</span>:<span class="dv">2</span>], <span class="co"># second column (error)</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>            ax <span class="op">=</span> err_ax,</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>            vmin <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>            vmax <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>            square <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>            mask <span class="op">=</span> mask,</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>            cmap <span class="op">=</span> <span class="st">&quot;viridis_r&quot;</span>,</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>            xticklabels <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>            yticklabels <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>            cbar <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>        new_ticks <span class="op">=</span> [i.get_text() <span class="cf">for</span> i <span class="kw">in</span> ax.get_yticklabels()]</span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>        ax.set_yticks(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(new_ticks), <span class="dv">10</span>), new_ticks[::<span class="dv">10</span>])</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>        ax.annotate(</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f&quot;</span><span class="sc">{</span><span class="dv">100</span> <span class="op">*</span> err<span class="sc">:.2f}</span><span class="ss">%&quot;</span> <span class="cf">if</span> err <span class="op">&lt;</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">&quot;Neznámé optimum&quot;</span>,</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">4</span>, <span class="op">-</span><span class="dv">10</span>),</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>            xycoords <span class="op">=</span> <span class="st">&quot;axes fraction&quot;</span>,</span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>            textcoords <span class="op">=</span> <span class="st">&quot;offset points&quot;</span>,</span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>            va <span class="op">=</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>        progress(<span class="dv">1</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="ss">f&quot;docs/assets/</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.svg&quot;</span>)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>    progress(<span class="dv">1</span>)</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> schedule_ridgeline(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>    scheduled_plots.append({<span class="st">&quot;type&quot;</span>: <span class="st">&quot;ridgeline&quot;</span>, <span class="st">&quot;total&quot;</span>: <span class="dv">1</span>, <span class="st">&quot;args&quot;</span>: args, <span class="st">&quot;kwargs&quot;</span>: kwargs})</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> schedule_boxplot(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>    scheduled_plots.append({<span class="st">&quot;type&quot;</span>: <span class="st">&quot;boxplot&quot;</span>,   <span class="st">&quot;total&quot;</span>: <span class="dv">1</span>, <span class="st">&quot;args&quot;</span>: args, <span class="st">&quot;kwargs&quot;</span>: kwargs})</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> schedule_heatmap(<span class="bu">id</span>, <span class="op">*</span>args, data <span class="op">=</span> data, <span class="op">**</span>kwargs):</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> data[data[<span class="st">&quot;id&quot;</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    n_instances <span class="op">=</span> <span class="bu">int</span>(dataset[<span class="st">&quot;inst_id&quot;</span>].count())</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>    scheduled_plots.append({</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;type&quot;</span>: <span class="st">&quot;heatmap&quot;</span>,</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;total&quot;</span>: n_instances <span class="op">+</span> <span class="dv">1</span>,</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;args&quot;</span>: [<span class="bu">id</span>] <span class="op">+</span> <span class="bu">list</span>(args),</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;kwargs&quot;</span>: <span class="bu">dict</span>(kwargs, data <span class="op">=</span> data)</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plottery():</span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="bu">sum</span>(p[<span class="st">&quot;total&quot;</span>] <span class="cf">for</span> p <span class="kw">in</span> scheduled_plots)</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>    progress_bar(iteration, total)</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> plot <span class="kw">in</span> scheduled_plots:</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> progress(i):</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>            <span class="kw">nonlocal</span> iteration</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>            iteration <span class="op">+=</span> i</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>            progress_bar(iteration, total)</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> plot[<span class="st">&quot;type&quot;</span>] <span class="op">==</span> <span class="st">&quot;ridgeline&quot;</span>:</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>            ridgeline(<span class="op">*</span>plot[<span class="st">&quot;args&quot;</span>], progress <span class="op">=</span> progress, <span class="op">**</span>plot[<span class="st">&quot;kwargs&quot;</span>])</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> plot[<span class="st">&quot;type&quot;</span>] <span class="op">==</span> <span class="st">&quot;boxplot&quot;</span>:</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>            boxplot(<span class="op">*</span>plot[<span class="st">&quot;args&quot;</span>], progress <span class="op">=</span> progress, <span class="op">**</span>plot[<span class="st">&quot;kwargs&quot;</span>])</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> plot[<span class="st">&quot;type&quot;</span>] <span class="op">==</span> <span class="st">&quot;heatmap&quot;</span>:</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>            heatmap(<span class="op">*</span>plot[<span class="st">&quot;args&quot;</span>], progress <span class="op">=</span> progress, <span class="op">**</span>plot[<span class="st">&quot;kwargs&quot;</span>])</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a><span class="co"># schedule_ridgeline(</span></span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;mutation_exploration&quot;,</span></span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;Vliv šance mutace na hustotu chyb&quot;,</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;mutation_chance&quot;,</span></span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;whitebox-mutation-chance-error.svg&quot;,</span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>schedule_heatmap(</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;default&quot;</span>,</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vývoj populace ve výchozím nastavení&quot;</span>,</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whitebox-heatmap-default-mix&quot;</span>,</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data[data[<span class="st">&quot;inst_id&quot;</span>] <span class="op">&lt;=</span> <span class="dv">8</span>]</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a><span class="co"># for _, mutation_chance in data[data[&quot;id&quot;] == &quot;mutation_exploration&quot;][&quot;mutation_chance&quot;].iteritems():</span></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="co">#     schedule_heatmap(</span></span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a><span class="co">#         &quot;mutation_exploration&quot;,</span></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;Vývoj populace s šancí mutace {mutation_chance * 100}%&quot;,</span></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;whitebox-heatmap-mut-explr-{mutation_chance}&quot;,</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a><span class="co">#         data = data[data[&quot;mutation_chance&quot;] == mutation_chance]</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a><span class="co"># for dataset in [&quot;N&quot;, &quot;Q&quot;, &quot;R&quot;, &quot;A&quot;]:</span></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="co">#     schedule_heatmap(</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;dataset_{dataset}&quot;,</span></span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;Vývoj populace pro dataset {dataset}&quot;,</span></span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;whitebox-heatmap-dataset-{dataset}&quot;,</span></span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a><span class="co">#         data = data[data[&quot;inst_id&quot;] &lt;= 8],</span></span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a><span class="co">#     schedule_ridgeline(</span></span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;dataset_{dataset}&quot;,</span></span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;Hustota chyb pro dataset {dataset}&quot;,</span></span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;mutation_chance&quot;,</span></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a><span class="co">#         f&quot;whitebox-error-density-evaluation-dataset-{dataset}.svg&quot;,</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.describe())</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.head())</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a><span class="co"># schedule_heatmap(</span></span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_A&quot;,</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;Vývoj populace pro dataset A&quot;,</span></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;whitebox-heatmap-dataset-A&quot;,</span></span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = data[data[&quot;inst_id&quot;] &lt;= 20]</span></span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a><span class="co">#     # data = data[:8],</span></span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a><span class="co"># schedule_ridgeline(</span></span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;dataset_A&quot;,</span></span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;Hustota chyb pro dataset A&quot;,</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;mutation_chance&quot;,</span></span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a><span class="co">#     &quot;whitebox-error-density-evaluation-dataset-A.svg&quot;,</span></span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data[data[<span class="st">&quot;set&quot;</span>] <span class="op">==</span> <span class="st">&quot;A&quot;</span>][data[<span class="st">&quot;error&quot;</span>] <span class="op">&lt;</span> <span class="fl">2.0</span>][<span class="st">&quot;error&quot;</span>].describe())</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>schedule_heatmap(</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;dataset_A&quot;</span>,</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Studie instancí 2 &amp; 17 v datasetu A&quot;</span>,</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;whitebox-heatmap-dataset-A-inst-2-closeup&quot;</span>,</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> data[data[<span class="st">&quot;inst_id&quot;</span>].isin([<span class="dv">2</span>, <span class="dv">17</span>])],</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a><span class="co"># do the plottery</span></span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>plottery()</span></code></pre></div>
</div>
</div>
<div class="doctest" data-status="ERROR">
<div class="doctestInput">
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#generate-plots-container" aria-controls="generate-plots-container">&lt;&lt;generate-plots&gt;&gt;=</button>
<div id="generate-plots-container" class="collapse">
<div class="sourceCode" id="generate-plots" style="max-height: 50vh"><pre class="sourceCode python eval bootstrap-fold overflow-auto"><code class="sourceCode python"><span id="generate-plots-1"><a href="#generate-plots-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tento blok slouží pouze ke spuštění skriptu výše</span></span>
<span id="generate-plots-2"><a href="#generate-plots-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (vynucen nedostatkem nástroje, který má tvorbu dokumentu na starosti)</span></span>
<span id="generate-plots-3"><a href="#generate-plots-3" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>analysis<span class="op">/</span>plot.py<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
</div>
<div class="doctestError">
<div class="programOutput">
<pre class="ansi2html-content"><span style="color: #aa0000">---------------------------------------------------------------------------</span>
<span style="color: #aa0000">FileNotFoundError</span>                         Traceback (most recent call last)
<span style="color: #00aa00">/tmp/ipykernel_2206/1484873982.py</span> in <span style="color: #00aaaa">&lt;module&gt;</span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     10</span> <span style="color: #00aa00">import</span> os<span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     11</span> <span style="color: #0000aa"></span>
<span style="color: #00aa00">---&gt; 12</span><span style="color: #aa0000"> </span>data <span style="color: #0000aa">=</span> pd<span style="color: #0000aa">.</span>read_pickle<span style="color: #0000aa">(</span><span style="color: #0000aa">"docs/assets/measurements.pkl"</span><span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     13</span> <span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">     14</span> show_progress <span style="color: #0000aa">=</span> os<span style="color: #0000aa">.</span>environ<span style="color: #0000aa">.</span>get<span style="color: #0000aa">(</span><span style="color: #0000aa">"JUPYTER"</span><span style="color: #0000aa">)</span> <span style="color: #0000aa">==</span> <span style="color: #00aa00">None</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>

<span style="color: #00aa00">/__w/ni-kop/ni-kop/5-weighted-sat/entangled-filters/lib/python3.9/site-packages/pandas/io/pickle.py</span> in <span style="color: #00aaaa">read_pickle</span><span style="color: #0000aa">(filepath_or_buffer, compression, storage_options)</span>
<span style="font-weight: bold; color: #00aa00">    194</span>     """
<span style="font-weight: bold; color: #00aa00">    195</span>     excs_to_catch <span style="color: #0000aa">=</span> <span style="color: #0000aa">(</span>AttributeError<span style="color: #0000aa">,</span> ImportError<span style="color: #0000aa">,</span> ModuleNotFoundError<span style="color: #0000aa">,</span> TypeError<span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="color: #00aa00">--&gt; 196</span><span style="color: #aa0000">     with get_handle(
</span><span style="font-weight: bold; color: #00aa00">    197</span>         filepath_or_buffer<span style="color: #0000aa">,</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    198</span>         <span style="color: #0000aa">"rb"</span><span style="color: #0000aa">,</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>

<span style="color: #00aa00">/__w/ni-kop/ni-kop/5-weighted-sat/entangled-filters/lib/python3.9/site-packages/pandas/io/common.py</span> in <span style="color: #00aaaa">get_handle</span><span style="color: #0000aa">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span style="font-weight: bold; color: #00aa00">    709</span>         <span style="color: #00aa00">else</span><span style="color: #0000aa">:</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    710</span>             <span style="color: #aa0000"># Binary mode</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="color: #00aa00">--&gt; 711</span><span style="color: #aa0000">             </span>handle <span style="color: #0000aa">=</span> open<span style="color: #0000aa">(</span>handle<span style="color: #0000aa">,</span> ioargs<span style="color: #0000aa">.</span>mode<span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    712</span>         handles<span style="color: #0000aa">.</span>append<span style="color: #0000aa">(</span>handle<span style="color: #0000aa">)</span><span style="color: #0000aa"></span><span style="color: #0000aa"></span>
<span style="font-weight: bold; color: #00aa00">    713</span> <span style="color: #0000aa"></span>

<span style="color: #aa0000">FileNotFoundError</span>: [Errno 2] No such file or directory: 'docs/assets/measurements.pkl'</pre>
</div>
</div>
</div>
<h4 id="hledání-kvalitního-algoritmu">Hledání kvalitního algoritmu</h4>
<p>Vůbec první varianta algoritmu nevyužívala žádných metod nichingu, v každé ze dvou set generací nekompromisně vyřadila slabší půlku z populace tisíce jedinců a rodiče kombinovala do nových potomků uniformním křížením.</p>
<figure>
<img src="whitebox-0-default.svg" alt="První nástřel evolučního algoritmu" /><figcaption aria-hidden="true">První nástřel evolučního algoritmu</figcaption>
</figure>
<p>Tato jednoduchá varianta nacházela jen řešení daleko od optima. Jak je vidět ve vizualizaci, populace rychle ztratí veškerou diverzitu a průzkum stavového prostoru se zasekne v lokálním maximu. Je jasné, že ke zlepšení výsledků je třeba diverzitu zachovat.</p>
<p>Jako první pokus o zlepšení jsem implementoval deterministic crowding. Namísto prosté náhrady horší půlky populace novými jedinci soupeří potomek o přežití s kvalitnějším z rodičů. Zároveň jsem snížil počet dvojic jedinců účastnících se křížení z poloviny populace na pětinu. (Pozn.: křížení poloviny populace neznamená, že mají všichni jedinci příležitost rozmnožit se. Dvojice rodičů jsou randomizované a asexuální rozmnožování je povoleno, zároveň mají kvalitnější jedinci vyšší šanci účastnit se procesu křížení.) Tento experiment ale skončil fiaskem, populace byla příliš rozmanitá a v průběhu simulace ji neovládl žádný výrazný genotyp.</p>
<figure>
<img src="whitebox-1-default-deterministic-crowding.svg" alt="Pokus o deterministic crowding" /><figcaption aria-hidden="true">Pokus o deterministic crowding</figcaption>
</figure>
<p>Domníval jsem se, že důvod neúspěchu se skrývá ve způsobu křížení. V této fázi vývoje jsem se rozhodl dohledat semestrální práci do předmětu BI-ZUM, kterou jsem vypracoval v prvním ročníku bakalářského studia. Předmětem této práce byl evoluční algoritmus pro řešení problému vrcholového pokrytí. V té době měl předmět žebříček řešení jedné velké instance (s neznámým optimem) nalezených studenty za několik let. Mé řešení využívalo několika pokročilých metod a umístilo se poměrně vysoko na žebříčku, měl jsem proto naději, že bych mohl použité metody nichingu vyzkoušet i na problém vážené splnitelnosti.</p>
<p><a href="zum-report.pdf">Zprávu k semestrální práci</a> i zdrojový kód se mi nakonec podařilo dohledat. Zalíbila se mi adaptivní šance mutace, protože evoluční algoritmus s ní přímo zobecňuje simulované žíhání (simulované žíhání má velikost populace <span class="math inline">\(1\)</span>). Zároveň jsem se rozhodl implementovat katastrofu, tedy náhodnou re-inicializaci části populace za účelem zlepšení diverzity, se kterou jsem měl před pokusem o deterministic crowding problém. Zaujal mě fakt, že deterministic crowding jsem zkoušel i ve zmíněné semestrální práci do BI-ZUM, taktéž bezúspěšně. Další pokusy o tuto niching metodu jsem proto odložil na později, vrátím se k ní v případě, že jiné postupy nepovedou k lepším výsledkům.</p>
<figure>
<img src="whitebox-2-default-adaptive-mutation.svg" alt="Adaptivní mutace a katastrofické události" /><figcaption aria-hidden="true">Adaptivní mutace a katastrofické události</figcaption>
</figure>
<figure>
<img src="whitebox-3-default-new-fitness-function.svg" alt="Začátky nové fitness funkce" /><figcaption aria-hidden="true">Začátky nové fitness funkce</figcaption>
</figure>
<figure>
<img src="assets/whitebox-heatmap-default-mix.svg" alt="Vývoj populace po 1000 generací" /><figcaption aria-hidden="true">Vývoj populace po 1000 generací</figcaption>
</figure>
<figure>
<img src="assets/whitebox-mutation-chance-error.svg" alt="Šance mutace vs. hustota chyb" /><figcaption aria-hidden="true">Šance mutace vs. hustota chyb</figcaption>
</figure>
<h3 id="black-box-vyhodnocení-hustoty-chyb">Black box: vyhodnocení hustoty chyb</h3>
<p><strong>TODO</strong></p>
<h2 id="implementace">Implementace</h2>
<p>Program začíná definicí datové struktury reprezentující instanci problému batohu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#problem-instance-definition-container" aria-controls="problem-instance-definition-container">&lt;&lt;problem-instance-definition&gt;&gt;=</button>
<div id="problem-instance-definition-container" class="collapse">
<div class="sourceCode" id="problem-instance-definition" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="problem-instance-definition-1"><a href="#problem-instance-definition-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">type</span> Id <span class="op">=</span> NonZeroU16<span class="op">;</span></span>
<span id="problem-instance-definition-2"><a href="#problem-instance-definition-2" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="problem-instance-definition-3"><a href="#problem-instance-definition-3" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Literal(<span class="kw">pub</span> <span class="dt">bool</span><span class="op">,</span> <span class="kw">pub</span> Id)<span class="op">;</span></span>
<span id="problem-instance-definition-4"><a href="#problem-instance-definition-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">type</span> Clause <span class="op">=</span> [Literal<span class="op">;</span> <span class="dv">3</span>]<span class="op">;</span></span>
<span id="problem-instance-definition-5"><a href="#problem-instance-definition-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="problem-instance-definition-6"><a href="#problem-instance-definition-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MAX_CLAUSES<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> <span class="dv">512</span><span class="op">;</span></span>
<span id="problem-instance-definition-7"><a href="#problem-instance-definition-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> MAX_VARIABLES<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> <span class="dv">256</span><span class="op">;</span></span>
<span id="problem-instance-definition-8"><a href="#problem-instance-definition-8" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="problem-instance-definition-9"><a href="#problem-instance-definition-9" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Instance <span class="op">{</span></span>
<span id="problem-instance-definition-10"><a href="#problem-instance-definition-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> id<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="problem-instance-definition-11"><a href="#problem-instance-definition-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> weights<span class="op">:</span> ArrayVec<span class="op">&lt;</span>NonZeroU16<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;,</span></span>
<span id="problem-instance-definition-12"><a href="#problem-instance-definition-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> total_weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="problem-instance-definition-13"><a href="#problem-instance-definition-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> clauses<span class="op">:</span> ArrayVec<span class="op">&lt;</span>Clause<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;,</span></span>
<span id="problem-instance-definition-14"><a href="#problem-instance-definition-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<p>Následující úryvek poskytuje ptačí pohled na strukturu souboru. Použité knihovny jsou importovány na začátku, následuje již zmíněná definice instance problému, dále funkce <code>main()</code>, parser, definice struktury řešení a její podpůrné funkce, samotné algoritmy řešiče a v neposlední řadě sada automatických testů.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-slash-src-slash-lib-dot-rs-container" aria-controls="solver-slash-src-slash-lib-dot-rs-container">&lt;&lt;solver/src/lib.rs&gt;&gt;=</button>
<div id="solver-slash-src-slash-lib-dot-rs-container" class="collapse">
<div class="sourceCode" id="cb3" data-file="solver/src/lib.rs" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>imports<span class="op">&gt;&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::result::</span><span class="dt">Result</span> <span class="kw">as</span> IOResult<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> list_input_files(set<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> r<span class="op">:</span> Range<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>IOResult<span class="op">&lt;</span>DirEntry<span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> f <span class="op">=</span> <span class="op">|</span>res<span class="op">:</span> <span class="op">&amp;</span>IOResult<span class="op">&lt;</span>DirEntry<span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">|</span> res<span class="op">.</span>as_ref()<span class="op">.</span>ok()<span class="op">.</span>filter(<span class="op">|</span>f<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file_name <span class="op">=</span> f<span class="op">.</span>file_name()<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file_name <span class="op">=</span> file_name<span class="op">.</span>to_str()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// keep only regular files</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        f<span class="op">.</span>file_type()<span class="op">.</span>unwrap()<span class="op">.</span>is_file() <span class="op">&amp;&amp;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... whose names start with the set name,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        file_name<span class="op">.</span>starts_with(set) <span class="op">&amp;&amp;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... continue with an integer between 0 and 15,</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        file_name[set<span class="op">.</span>len()<span class="op">..</span>]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>split(<span class="ch">&#39;_&#39;</span>)<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>()<span class="op">.</span>ok()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>n<span class="op">|</span> r<span class="op">.</span>contains(n))<span class="op">.</span>is_some() <span class="op">&amp;&amp;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ... and end with `_inst.dat` (for &quot;instance&quot;).</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        file_name<span class="op">.</span>ends_with(<span class="st">&quot;_inst.dat&quot;</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)<span class="op">.</span>is_some()<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(read_dir(<span class="st">&quot;./ds/&quot;</span>)<span class="op">?.</span>filter(f)<span class="op">.</span>collect())</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>problem<span class="op">-</span>instance<span class="op">-</span>definition<span class="op">&gt;&gt;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>solution<span class="op">-</span>definition<span class="op">&gt;&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>parser<span class="op">&gt;&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> IteratorRandomWeighted<span class="op">:</span> <span class="bu">Iterator</span> <span class="op">+</span> <span class="bu">Sized</span> <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> choose_weighted<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="op">?</span><span class="bu">Sized</span><span class="op">,</span> W<span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng<span class="op">,</span> f<span class="op">:</span> <span class="kw">fn</span>(<span class="dt">Self</span><span class="pp">::</span>Item) <span class="op">-&gt;</span> W) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">Self</span><span class="pp">::</span>Item<span class="op">&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        Rng<span class="op">:</span> <span class="pp">rand::</span>Rng<span class="op">,</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        W<span class="op">:</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="pp">core::ops::</span><span class="bu">AddAssign</span><span class="op">&lt;&amp;</span><span class="ot">&#39;a</span> W<span class="op">&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="pp">rand::distributions::uniform::</span>SampleUniform</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="pp">std::cmp::</span><span class="bu">PartialOrd</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="bu">Default</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>         <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">rand::prelude::</span><span class="op">*;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> dist <span class="op">=</span> <span class="pp">rand::distributions::WeightedIndex::</span>new(<span class="kw">self</span><span class="op">.</span>clone()<span class="op">.</span>map(f))<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>nth(dist<span class="op">.</span>sample(rng))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span><span class="op">&lt;</span>I<span class="op">&gt;</span> IteratorRandomWeighted <span class="kw">for</span> I <span class="kw">where</span> I<span class="op">:</span> <span class="bu">Iterator</span> <span class="op">+</span> <span class="bu">Sized</span> <span class="op">+</span> <span class="bu">Clone</span> <span class="op">{}</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Instance <span class="op">{</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> evolutionary<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="pp">rand::</span>Rng <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span> <span class="op">+</span> <span class="bu">Clone</span><span class="op">&gt;</span>(</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng<span class="op">,</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">mut</span> ecfg<span class="op">:</span> EvolutionaryConfig<span class="op">,</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        opt<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span>OptimalSolution<span class="op">&gt;</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">-&gt;</span> Solution <span class="op">{</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">rayon::prelude::</span><span class="op">*;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">std::iter::</span>repeat_with<span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="kw">impl</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>            <span class="kw">fn</span> crossover<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="pp">rand::</span>Rng<span class="op">&gt;</span>(</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                <span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="dt">Self</span><span class="op">,</span> evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig<span class="op">,</span> rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">-&gt;</span> [Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;;</span> <span class="dv">2</span>] <span class="op">{</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> cfgs <span class="op">=</span> [<span class="pp">Config::</span>zeroed()<span class="op">,</span> <span class="pp">Config::</span>zeroed()]<span class="op">;</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> weights <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> (i<span class="op">,</span> (l<span class="op">,</span> r)) <span class="kw">in</span> <span class="kw">self</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>cfg<span class="op">.</span>iter()</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>zip(other<span class="op">.</span>cfg<span class="op">.</span>iter())</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>take(<span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>weights<span class="op">.</span>len())</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>enumerate() <span class="op">{</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> bits <span class="op">=</span> <span class="kw">if</span> rng<span class="op">.</span>gen_bool(<span class="dv">0.5</span>) <span class="op">{</span> (<span class="op">*</span>l<span class="op">,</span> <span class="op">*</span>r) <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> (<span class="op">*</span>r<span class="op">,</span> <span class="op">*</span>l) <span class="op">};</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                    cfgs[<span class="dv">0</span>]<span class="op">.</span>set(i<span class="op">,</span> bits<span class="op">.</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                    cfgs[<span class="dv">1</span>]<span class="op">.</span>set(i<span class="op">,</span> bits<span class="op">.</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> w <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>weights[i]<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>                    weights[<span class="dv">0</span>] <span class="op">+=</span> w <span class="op">*</span> bits<span class="op">.</span><span class="dv">0</span> <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>                    weights[<span class="dv">1</span>] <span class="op">+=</span> w <span class="op">*</span> bits<span class="op">.</span><span class="dv">1</span> <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>                cfgs<span class="op">.</span>into_iter()</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>zip(weights<span class="op">.</span>into_iter())</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>(cfg<span class="op">,</span> weight)<span class="op">|</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>                        Solution <span class="op">{</span> weight<span class="op">,</span> cfg<span class="op">,</span> inst<span class="op">:</span> <span class="kw">self</span><span class="op">.</span>inst<span class="op">,</span> satisfied<span class="op">:</span> <span class="cn">false</span><span class="op">,</span> fitness<span class="op">:</span> <span class="dv">0</span> <span class="op">}</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>mutate_unsafe(evo_config<span class="op">,</span> rng))</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> Solution <span class="op">{</span> satisfied<span class="op">:</span> satisfied(<span class="op">&amp;</span>sln<span class="op">.</span>inst<span class="op">.</span>clauses<span class="op">,</span> <span class="op">&amp;</span>sln<span class="op">.</span>cfg)<span class="op">,</span> <span class="op">..</span>sln <span class="op">}</span>)</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> Solution <span class="op">{</span> fitness<span class="op">:</span> compute_fitness(<span class="op">&amp;</span>sln<span class="op">,</span> evo_config)<span class="op">,</span> <span class="op">..</span>sln <span class="op">}</span>)</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>_<span class="op">,</span> <span class="dv">2</span><span class="op">&gt;&gt;</span>()</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>into_inner()</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>unwrap()</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>            <span class="kw">pub</span> <span class="kw">fn</span> mutate_unsafe<span class="op">&lt;</span>Rng<span class="op">:</span> <span class="pp">rand::</span>Rng<span class="op">&gt;</span>(</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>                <span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig<span class="op">,</span> rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> new <span class="op">=</span> <span class="op">*</span><span class="kw">self</span><span class="op">;</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>weights<span class="op">.</span>len() <span class="op">{</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> flip <span class="op">=</span> rng<span class="op">.</span>gen_bool(evo_config<span class="op">.</span>mutation_chance)<span class="op">;</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>                    new<span class="op">.</span>set_unsafe(i<span class="op">,</span> <span class="kw">if</span> flip <span class="op">{</span> <span class="op">!</span><span class="kw">self</span><span class="op">.</span>cfg[i] <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="kw">self</span><span class="op">.</span>cfg[i] <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>                new</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> random <span class="op">=</span> <span class="op">{</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> ecfg <span class="op">=</span> ecfg<span class="op">;</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>            <span class="kw">move</span> <span class="op">|</span>rng<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Rng<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> cfg <span class="op">=</span> <span class="pp">Config::</span>zeroed()<span class="op">;</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> weight <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>weights<span class="op">.</span>len() <span class="op">{</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> b <span class="op">=</span> rng<span class="op">.</span>gen_bool(<span class="dv">0.5</span>)<span class="op">;</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>                    cfg<span class="op">.</span>set(i<span class="op">,</span> b)<span class="op">;</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>                    weight <span class="op">+=</span> <span class="kw">self</span><span class="op">.</span>weights[i]<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">u32</span> <span class="op">*</span> b <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                <span class="pp">Solution::</span>new(weight<span class="op">,</span> cfg<span class="op">,</span> <span class="kw">self</span><span class="op">,</span> <span class="op">&amp;</span>ecfg)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> stats(pop<span class="op">:</span> <span class="op">&amp;</span>[Solution]<span class="op">,</span> _evo_config<span class="op">:</span> EvolutionaryConfig<span class="op">,</span> opt<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span>OptimalSolution<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> identity <span class="op">=</span> <span class="pp">core::iter::</span>repeat(<span class="dv">0u16</span>)<span class="op">.</span>take(MAX_VARIABLES)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>_<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;&gt;</span>()<span class="op">.</span>into_inner()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> counts <span class="op">=</span> pop<span class="op">.</span>par_iter()</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>cfg<span class="op">.</span>iter()</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>b<span class="op">|</span> <span class="op">*</span>b <span class="kw">as</span> <span class="dt">u16</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>_<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;&gt;</span>()<span class="op">.</span>into_inner()<span class="op">.</span>unwrap()</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>reduce(<span class="op">||</span> identity<span class="op">,</span> <span class="op">|</span>l<span class="op">,</span> r<span class="op">|</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>                    l<span class="op">.</span>iter()<span class="op">.</span>zip(r<span class="op">.</span>iter())</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>(x<span class="op">,</span> y)<span class="op">|</span> x <span class="op">+</span> y)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>_<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;&gt;</span>()<span class="op">.</span>into_inner()<span class="op">.</span>unwrap()</span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>                )<span class="op">;</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> vars <span class="op">=</span> pop[<span class="dv">0</span>]<span class="op">.</span>inst<span class="op">.</span>weights<span class="op">.</span>len()<span class="op">;</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>            opt<span class="op">.</span>and_then(<span class="op">|</span>opt<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>                    pop<span class="op">.</span>iter()</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>filter(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>satisfied)</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> (<span class="dv">1</span><span class="op">,</span> sln<span class="op">.</span>weight <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> opt<span class="op">.</span>weight <span class="kw">as</span> <span class="dt">f64</span>))</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>reduce(<span class="op">|</span>acc<span class="op">,</span> (n<span class="op">,</span> w)<span class="op">|</span> (acc<span class="op">.</span><span class="dv">0</span> <span class="op">+</span> n<span class="op">,</span> acc<span class="op">.</span><span class="dv">1</span> <span class="op">+</span> w))</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>                        <span class="op">.</span>map(<span class="op">|</span>(count<span class="op">,</span> sum)<span class="op">|</span> <span class="dv">1.0</span> <span class="op">-</span> sum <span class="op">/</span> count <span class="kw">as</span> <span class="dt">f64</span>)</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span>)<span class="op">.</span>or(<span class="cn">Some</span>(<span class="dv">2.0</span>)) <span class="co">// fill in the error if there&#39;s no known optimum</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>into_iter()</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(counts<span class="op">.</span>into_iter()<span class="op">.</span>take(vars)<span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> x <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> pop<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">f64</span>))</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> x<span class="op">.</span>to_string())</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>intersperse(<span class="st">&quot; &quot;</span><span class="op">.</span>into())</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span>()</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> DISASTER_INTERVAL<span class="op">:</span> <span class="dt">u32</span> <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> MUTATION_ADJUSTMENT_INTERVAL<span class="op">:</span> <span class="dt">u32</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> MUTATION_ADJUSTMENT<span class="op">:</span> <span class="dt">f64</span> <span class="op">=</span> <span class="dv">1.0001</span><span class="op">;</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> population <span class="op">=</span> (<span class="dv">0</span><span class="op">..</span>ecfg<span class="op">.</span>population_size)<span class="op">.</span>map(<span class="op">|</span>_<span class="op">|</span> random(rng))<span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()<span class="op">;</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> buffer <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>with_capacity(population<span class="op">.</span>len() <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> shuffler<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Solution<span class="op">&gt;</span> <span class="op">=</span> buffer<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> best <span class="op">=</span> population[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;0 {}&quot;</span><span class="op">,</span> stats(<span class="op">&amp;</span>population[<span class="op">..</span>]<span class="op">,</span> ecfg<span class="op">,</span> opt))<span class="op">;</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">0</span><span class="op">..</span>ecfg<span class="op">.</span>generations)<span class="op">.</span>for_each(<span class="op">|</span>i<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> i <span class="op">%</span> DISASTER_INTERVAL <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>                population<span class="op">.</span>shuffle(rng)<span class="op">;</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> n <span class="op">=</span> (population<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">f64</span> <span class="op">*</span> <span class="dv">0.99</span>) <span class="kw">as</span> <span class="dt">usize</span><span class="op">;</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>                population<span class="op">.</span>drain(<span class="op">..</span> n)<span class="op">;</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>                population<span class="op">.</span>extend(repeat_with(<span class="op">||</span> random(rng))<span class="op">.</span>take(n))<span class="op">;</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>            population<span class="op">.</span>par_sort_by_key(<span class="op">|</span>sln<span class="op">|</span> <span class="op">-</span>(sln<span class="op">.</span>fitness <span class="kw">as</span> <span class="dt">i64</span>))<span class="op">;</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> (population[<span class="dv">0</span>]<span class="op">.</span>satisfied <span class="op">&amp;&amp;</span> <span class="op">!</span>best<span class="op">.</span>satisfied) <span class="op">||</span> population[<span class="dv">0</span>]<span class="op">.</span>fitness <span class="op">&gt;</span> best<span class="op">.</span>fitness <span class="op">{</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                best <span class="op">=</span> population[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>            shuffler<span class="op">.</span>par_extend(population<span class="op">.</span>par_iter())<span class="op">;</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>            shuffler<span class="op">.</span>shuffle(rng)<span class="op">;</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>            <span class="co">// move unsatisfying solutions to the end</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>            shuffler<span class="op">.</span>par_sort_by_key(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>fitness <span class="op">==</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>            <span class="co">// how many individuals to cross over</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> n <span class="op">=</span> population<span class="op">.</span>len() <span class="op">/</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>            buffer<span class="op">.</span>extend(shuffler<span class="op">.</span>drain(<span class="op">..</span>)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>zip(population<span class="op">.</span>drain(<span class="op">..</span> n <span class="op">*</span> <span class="dv">2</span>)<span class="op">.</span>take(n))</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>flat_map(<span class="op">|</span>(a<span class="op">,</span> b)<span class="op">|</span> <span class="op">{</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>                    a<span class="op">.</span>crossover(b<span class="op">,</span> <span class="op">&amp;</span>ecfg<span class="op">,</span> rng)<span class="op">.</span>into_iter()</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span>)</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>            population<span class="op">.</span>append(<span class="op">&amp;</span><span class="kw">mut</span> buffer)<span class="op">;</span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>            <span class="at">#[</span>allow<span class="at">(</span><span class="pp">clippy::</span>modulo_one<span class="at">)]</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> (ecfg<span class="op">.</span>generations <span class="op">/</span> <span class="dv">100</span>) <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>                <span class="pp">println!</span>(<span class="st">&quot;{} {}&quot;</span><span class="op">,</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> stats(<span class="op">&amp;</span>population[<span class="op">..</span>]<span class="op">,</span> ecfg<span class="op">,</span> opt))</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>            <span class="pp">assert_eq!</span>(population<span class="op">.</span>len()<span class="op">,</span> ecfg<span class="op">.</span>population_size)<span class="op">;</span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>            <span class="co">// adjust the mutation modifier adaptively</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> i <span class="op">%</span> MUTATION_ADJUSTMENT_INTERVAL <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> n <span class="op">=</span> population<span class="op">.</span>iter()</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>sln<span class="op">|</span> sln<span class="op">.</span>fitness)</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>filter(<span class="op">|</span>f<span class="op">|</span> <span class="op">*</span>f <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>count()<span class="op">;</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> n <span class="op">=</span> n <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> population<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>                ecfg<span class="op">.</span>mutation_chance <span class="op">=</span> <span class="kw">match</span> () <span class="op">{</span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>                    _ <span class="kw">if</span> n <span class="op">&gt;</span> <span class="dv">0.5</span> <span class="op">=&gt;</span> (ecfg<span class="op">.</span>mutation_chance <span class="op">*</span> MUTATION_ADJUSTMENT)<span class="op">.</span>min(<span class="dv">0.5</span>)<span class="op">,</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>                    _ <span class="kw">if</span> n <span class="op">&lt;</span> <span class="dv">0.2</span> <span class="op">=&gt;</span> (ecfg<span class="op">.</span>mutation_chance <span class="op">/</span> MUTATION_ADJUSTMENT)<span class="op">.</span>max(<span class="dv">0.0001</span>)<span class="op">,</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>                    _            <span class="op">=&gt;</span> ecfg<span class="op">.</span>mutation_chance</span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>                <span class="op">};</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>        best</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> dump(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">core::iter::</span>once<span class="op">;</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>        once(<span class="st">&quot;w&quot;</span><span class="op">.</span>into())</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>weights<span class="op">.</span>iter()</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>map(<span class="op">|</span>id<span class="op">|</span> id<span class="op">.</span>get())</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>chain(once(<span class="dv">0</span>))</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>map(<span class="op">|</span>w<span class="op">|</span> w<span class="op">.</span>to_string())</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>intersperse(<span class="st">&quot; &quot;</span><span class="op">.</span>into())</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>chain(once(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">.</span>into()))</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>clauses<span class="op">.</span>iter()<span class="op">.</span>flat_map(<span class="op">|</span>clause<span class="op">|</span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>            clause<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|&amp;</span>Literal(pos<span class="op">,</span> id)<span class="op">|</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>                    id<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">i16</span> <span class="op">*</span> <span class="kw">if</span> pos <span class="op">{</span> <span class="dv">1</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="op">-</span><span class="dv">1</span> <span class="op">}</span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(once(<span class="dv">0</span>))</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>l<span class="op">|</span> l<span class="op">.</span>to_string())</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>intersperse(<span class="st">&quot; &quot;</span><span class="op">.</span>into())</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(once(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">.</span>into()))</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>collect()</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>tests<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
<p>Řešení v podobě datové struktury <code>Solution</code> má kromě reference na instanci problému především bit array udávající množinu předmětů v pomyslném batohu. Zároveň nese informaci o počtu navštívených konfigurací při jeho výpočtu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solution-definition-container" aria-controls="solution-definition-container">&lt;&lt;solution-definition&gt;&gt;=</button>
<div id="solution-definition-container" class="collapse">
<div class="sourceCode" id="solution-definition" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solution-definition-1"><a href="#solution-definition-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">type</span> Config <span class="op">=</span> <span class="pp">BitArr!</span>(<span class="kw">for</span> MAX_VARIABLES)<span class="op">;</span></span>
<span id="solution-definition-2"><a href="#solution-definition-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-3"><a href="#solution-definition-3" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="solution-definition-4"><a href="#solution-definition-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-definition-5"><a href="#solution-definition-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="solution-definition-6"><a href="#solution-definition-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> fitness<span class="op">:</span> <span class="dt">u64</span><span class="op">,</span></span>
<span id="solution-definition-7"><a href="#solution-definition-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> cfg<span class="op">:</span> Config<span class="op">,</span></span>
<span id="solution-definition-8"><a href="#solution-definition-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance<span class="op">,</span></span>
<span id="solution-definition-9"><a href="#solution-definition-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> satisfied<span class="op">:</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="solution-definition-10"><a href="#solution-definition-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-11"><a href="#solution-definition-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-12"><a href="#solution-definition-12" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Clone</span><span class="at">)]</span></span>
<span id="solution-definition-13"><a href="#solution-definition-13" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> OptimalSolution <span class="op">{</span></span>
<span id="solution-definition-14"><a href="#solution-definition-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> full_id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="solution-definition-15"><a href="#solution-definition-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> id<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="solution-definition-16"><a href="#solution-definition-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="solution-definition-17"><a href="#solution-definition-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> cfg<span class="op">:</span> Config<span class="op">,</span></span>
<span id="solution-definition-18"><a href="#solution-definition-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> params<span class="op">:</span> InstanceParams<span class="op">,</span></span>
<span id="solution-definition-19"><a href="#solution-definition-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-20"><a href="#solution-definition-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-21"><a href="#solution-definition-21" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Clone</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> <span class="bu">Eq</span><span class="op">,</span> <span class="bu">Hash</span><span class="op">,</span> <span class="bu">PartialOrd</span><span class="op">,</span> <span class="bu">Ord</span><span class="at">)]</span></span>
<span id="solution-definition-22"><a href="#solution-definition-22" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> InstanceParams <span class="op">{</span></span>
<span id="solution-definition-23"><a href="#solution-definition-23" aria-hidden="true" tabindex="-1"></a>    variables<span class="op">:</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="solution-definition-24"><a href="#solution-definition-24" aria-hidden="true" tabindex="-1"></a>    clauses<span class="op">:</span> <span class="dt">u16</span><span class="op">,</span></span>
<span id="solution-definition-25"><a href="#solution-definition-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-26"><a href="#solution-definition-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-27"><a href="#solution-definition-27" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Clone</span><span class="op">,</span> <span class="bu">Copy</span><span class="op">,</span> <span class="bu">Debug</span><span class="op">,</span> <span class="bu">PartialEq</span><span class="op">,</span> Serialize<span class="op">,</span> Deserialize<span class="at">)]</span></span>
<span id="solution-definition-28"><a href="#solution-definition-28" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> EvolutionaryConfig <span class="op">{</span></span>
<span id="solution-definition-29"><a href="#solution-definition-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> set<span class="op">:</span> <span class="dt">char</span><span class="op">,</span></span>
<span id="solution-definition-30"><a href="#solution-definition-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> mutation_chance<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="solution-definition-31"><a href="#solution-definition-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> n_instances<span class="op">:</span> <span class="dt">u16</span><span class="op">,</span></span>
<span id="solution-definition-32"><a href="#solution-definition-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> generations<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="solution-definition-33"><a href="#solution-definition-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> population_size<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="solution-definition-34"><a href="#solution-definition-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-35"><a href="#solution-definition-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-36"><a href="#solution-definition-36" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span> <span class="kw">for</span> InstanceParams <span class="op">{</span></span>
<span id="solution-definition-37"><a href="#solution-definition-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> from(inst<span class="op">:</span> Instance) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="solution-definition-38"><a href="#solution-definition-38" aria-hidden="true" tabindex="-1"></a>        InstanceParams <span class="op">{</span></span>
<span id="solution-definition-39"><a href="#solution-definition-39" aria-hidden="true" tabindex="-1"></a>            variables<span class="op">:</span> inst<span class="op">.</span>weights<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u8</span><span class="op">,</span></span>
<span id="solution-definition-40"><a href="#solution-definition-40" aria-hidden="true" tabindex="-1"></a>            clauses<span class="op">:</span>   inst<span class="op">.</span>clauses<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">u16</span><span class="op">,</span></span>
<span id="solution-definition-41"><a href="#solution-definition-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-definition-42"><a href="#solution-definition-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-definition-43"><a href="#solution-definition-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-44"><a href="#solution-definition-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-45"><a href="#solution-definition-45" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span>OptimalSolution<span class="op">&gt;</span> <span class="kw">for</span> InstanceParams <span class="op">{</span></span>
<span id="solution-definition-46"><a href="#solution-definition-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> from(opt<span class="op">:</span> OptimalSolution) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="solution-definition-47"><a href="#solution-definition-47" aria-hidden="true" tabindex="-1"></a>        opt<span class="op">.</span>params</span>
<span id="solution-definition-48"><a href="#solution-definition-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-definition-49"><a href="#solution-definition-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-definition-50"><a href="#solution-definition-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-definition-51"><a href="#solution-definition-51" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>solution<span class="op">-</span>helpers<span class="op">&gt;&gt;</span></span></code></pre></div>
</div>
</div>
<p>Protože se strukturami typu <code>Solution</code> se v algoritmech pracuje hojně, implementoval jsem pro ně koncept řazení a pomocné metody k počítání navštívených konfigurací a přidávání předmětů do batohu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solution-helpers-container" aria-controls="solution-helpers-container">&lt;&lt;solution-helpers&gt;&gt;=</button>
<div id="solution-helpers-container" class="collapse">
<div class="sourceCode" id="solution-helpers" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="solution-helpers-1"><a href="#solution-helpers-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="bu">PartialOrd</span> <span class="kw">for</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-2"><a href="#solution-helpers-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> partial_cmp(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">cmp::</span>Ordering<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-3"><a href="#solution-helpers-3" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(<span class="kw">self</span><span class="op">.</span>weight<span class="op">.</span>cmp(<span class="op">&amp;</span>other<span class="op">.</span>weight))</span>
<span id="solution-helpers-4"><a href="#solution-helpers-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-5"><a href="#solution-helpers-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-6"><a href="#solution-helpers-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-7"><a href="#solution-helpers-7" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="bu">Ord</span> <span class="kw">for</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-8"><a href="#solution-helpers-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> cmp(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Self</span>) <span class="op">-&gt;</span> <span class="pp">cmp::</span>Ordering <span class="op">{</span></span>
<span id="solution-helpers-9"><a href="#solution-helpers-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>partial_cmp(other)<span class="op">.</span>unwrap()</span>
<span id="solution-helpers-10"><a href="#solution-helpers-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-11"><a href="#solution-helpers-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-12"><a href="#solution-helpers-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-13"><a href="#solution-helpers-13" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>allow<span class="at">(</span>unused<span class="at">)]</span></span>
<span id="solution-helpers-14"><a href="#solution-helpers-14" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-15"><a href="#solution-helpers-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> with(<span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-16"><a href="#solution-helpers-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>set(i<span class="op">,</span> <span class="cn">true</span>)</span>
<span id="solution-helpers-17"><a href="#solution-helpers-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-18"><a href="#solution-helpers-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-19"><a href="#solution-helpers-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> without(<span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-20"><a href="#solution-helpers-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>set(i<span class="op">,</span> <span class="cn">false</span>)</span>
<span id="solution-helpers-21"><a href="#solution-helpers-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-22"><a href="#solution-helpers-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-23"><a href="#solution-helpers-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> invert(<span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-24"><a href="#solution-helpers-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>weights<span class="op">.</span>len() <span class="op">{</span></span>
<span id="solution-helpers-25"><a href="#solution-helpers-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>set_unsafe(i<span class="op">,</span> <span class="op">!</span><span class="kw">self</span><span class="op">.</span>cfg[i])<span class="op">;</span></span>
<span id="solution-helpers-26"><a href="#solution-helpers-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-helpers-27"><a href="#solution-helpers-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>satisfied <span class="op">=</span> satisfied(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>clauses<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>cfg)<span class="op">;</span></span>
<span id="solution-helpers-28"><a href="#solution-helpers-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span></span>
<span id="solution-helpers-29"><a href="#solution-helpers-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-30"><a href="#solution-helpers-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-31"><a href="#solution-helpers-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> set(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> set<span class="op">:</span> <span class="dt">bool</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-32"><a href="#solution-helpers-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>set_unsafe(i<span class="op">,</span> set)<span class="op">;</span></span>
<span id="solution-helpers-33"><a href="#solution-helpers-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>satisfied <span class="op">=</span> satisfied(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>clauses<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>cfg)<span class="op">;</span></span>
<span id="solution-helpers-34"><a href="#solution-helpers-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span><span class="kw">self</span></span>
<span id="solution-helpers-35"><a href="#solution-helpers-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-36"><a href="#solution-helpers-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-37"><a href="#solution-helpers-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> set_unsafe(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> set<span class="op">:</span> <span class="dt">bool</span>) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-38"><a href="#solution-helpers-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> w <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>weights[i]<span class="op">;</span></span>
<span id="solution-helpers-39"><a href="#solution-helpers-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> k <span class="op">=</span> <span class="kw">if</span> set <span class="op">{</span> <span class="dv">1</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="op">-</span><span class="dv">1</span> <span class="op">};</span></span>
<span id="solution-helpers-40"><a href="#solution-helpers-40" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">self</span><span class="op">.</span>cfg[i] <span class="op">!=</span> set <span class="op">{</span></span>
<span id="solution-helpers-41"><a href="#solution-helpers-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>cfg<span class="op">.</span>set(i<span class="op">,</span> set)<span class="op">;</span></span>
<span id="solution-helpers-42"><a href="#solution-helpers-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>weight <span class="op">=</span> (<span class="kw">self</span><span class="op">.</span>weight <span class="kw">as</span> <span class="dt">i32</span> <span class="op">+</span> k <span class="op">*</span> w<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">i32</span>) <span class="kw">as</span> <span class="dt">u32</span><span class="op">;</span></span>
<span id="solution-helpers-43"><a href="#solution-helpers-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="solution-helpers-44"><a href="#solution-helpers-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span><span class="kw">self</span></span>
<span id="solution-helpers-45"><a href="#solution-helpers-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-46"><a href="#solution-helpers-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-47"><a href="#solution-helpers-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> default(inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance<span class="op">,</span> evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-48"><a href="#solution-helpers-48" aria-hidden="true" tabindex="-1"></a>        <span class="pp">Solution::</span>new(<span class="dv">0</span><span class="op">,</span> <span class="pp">Config::</span><span class="kw">default</span>()<span class="op">,</span> inst<span class="op">,</span> evo_config)</span>
<span id="solution-helpers-49"><a href="#solution-helpers-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-50"><a href="#solution-helpers-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-51"><a href="#solution-helpers-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new(weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> cfg<span class="op">:</span> Config<span class="op">,</span> inst<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Instance<span class="op">,</span> evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="solution-helpers-52"><a href="#solution-helpers-52" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> sln <span class="op">=</span> Solution <span class="op">{</span></span>
<span id="solution-helpers-53"><a href="#solution-helpers-53" aria-hidden="true" tabindex="-1"></a>            weight<span class="op">,</span> cfg<span class="op">,</span> inst<span class="op">,</span> satisfied<span class="op">:</span> satisfied(<span class="op">&amp;</span>inst<span class="op">.</span>clauses<span class="op">,</span> <span class="op">&amp;</span>cfg)<span class="op">,</span> fitness<span class="op">:</span> <span class="dv">0</span></span>
<span id="solution-helpers-54"><a href="#solution-helpers-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="solution-helpers-55"><a href="#solution-helpers-55" aria-hidden="true" tabindex="-1"></a>        Solution <span class="op">{</span> fitness<span class="op">:</span> compute_fitness(<span class="op">&amp;</span>sln<span class="op">,</span> evo_config)<span class="op">,</span> <span class="op">..</span>sln <span class="op">}</span></span>
<span id="solution-helpers-56"><a href="#solution-helpers-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-57"><a href="#solution-helpers-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-58"><a href="#solution-helpers-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> valid(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="solution-helpers-59"><a href="#solution-helpers-59" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> Solution <span class="op">{</span> weight<span class="op">,</span> cfg<span class="op">,</span> inst<span class="op">,</span> satisfied<span class="op">,</span> fitness <span class="op">}</span> <span class="op">=</span> <span class="op">*</span><span class="kw">self</span><span class="op">;</span></span>
<span id="solution-helpers-60"><a href="#solution-helpers-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> Instance <span class="op">{</span> weights<span class="op">,</span> clauses<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=</span> inst<span class="op">;</span></span>
<span id="solution-helpers-61"><a href="#solution-helpers-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-62"><a href="#solution-helpers-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> computed_weight <span class="op">=</span> weights</span>
<span id="solution-helpers-63"><a href="#solution-helpers-63" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>iter()</span>
<span id="solution-helpers-64"><a href="#solution-helpers-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>zip(cfg)</span>
<span id="solution-helpers-65"><a href="#solution-helpers-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>map(<span class="op">|</span>(w<span class="op">,</span> b)<span class="op">|</span> <span class="op">{</span></span>
<span id="solution-helpers-66"><a href="#solution-helpers-66" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> b <span class="op">{</span> w<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">u32</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="dv">0</span> <span class="op">}</span></span>
<span id="solution-helpers-67"><a href="#solution-helpers-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span>)</span>
<span id="solution-helpers-68"><a href="#solution-helpers-68" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="pp">sum::</span><span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>()<span class="op">;</span></span>
<span id="solution-helpers-69"><a href="#solution-helpers-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-70"><a href="#solution-helpers-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> computed_fitness <span class="op">=</span> compute_fitness(<span class="kw">self</span><span class="op">,</span> evo_config)<span class="op">;</span></span>
<span id="solution-helpers-71"><a href="#solution-helpers-71" aria-hidden="true" tabindex="-1"></a>        computed_fitness <span class="op">==</span> fitness <span class="op">&amp;&amp;</span> computed_weight <span class="op">==</span> weight <span class="op">&amp;&amp;</span> satisfied</span>
<span id="solution-helpers-72"><a href="#solution-helpers-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-73"><a href="#solution-helpers-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-74"><a href="#solution-helpers-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> dump(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="solution-helpers-75"><a href="#solution-helpers-75" aria-hidden="true" tabindex="-1"></a>        dump_solution(<span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>id<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>weight<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>cfg<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>inst<span class="op">.</span>clone()<span class="op">.</span>into())</span>
<span id="solution-helpers-76"><a href="#solution-helpers-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-77"><a href="#solution-helpers-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-78"><a href="#solution-helpers-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-79"><a href="#solution-helpers-79" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> OptimalSolution <span class="op">{</span></span>
<span id="solution-helpers-80"><a href="#solution-helpers-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> <span class="kw">fn</span> dump(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="solution-helpers-81"><a href="#solution-helpers-81" aria-hidden="true" tabindex="-1"></a>        dump_solution(<span class="kw">self</span><span class="op">.</span>id<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>weight<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>cfg<span class="op">,</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>clone()<span class="op">.</span>into())</span>
<span id="solution-helpers-82"><a href="#solution-helpers-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="solution-helpers-83"><a href="#solution-helpers-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-84"><a href="#solution-helpers-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-85"><a href="#solution-helpers-85" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> dump_solution(id<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span> weight<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span> cfg<span class="op">:</span> <span class="op">&amp;</span>Config<span class="op">,</span> params<span class="op">:</span> <span class="op">&amp;</span>InstanceParams) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="solution-helpers-86"><a href="#solution-helpers-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">core::iter::</span>once<span class="op">;</span></span>
<span id="solution-helpers-87"><a href="#solution-helpers-87" aria-hidden="true" tabindex="-1"></a>    once(<span class="pp">format!</span>(<span class="st">&quot;uf{}-0{}&quot;</span><span class="op">,</span> params<span class="op">.</span>variables<span class="op">,</span> id))</span>
<span id="solution-helpers-88"><a href="#solution-helpers-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>chain(once(weight<span class="op">.</span>to_string()))</span>
<span id="solution-helpers-89"><a href="#solution-helpers-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>chain((<span class="dv">1</span><span class="op">..=</span>params<span class="op">.</span>variables <span class="kw">as</span> <span class="dt">usize</span>)</span>
<span id="solution-helpers-90"><a href="#solution-helpers-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>i<span class="op">|</span> <span class="kw">if</span> cfg[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">{</span> <span class="dv">1</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="op">-</span><span class="dv">1</span> <span class="op">}</span> <span class="op">*</span> i <span class="kw">as</span> <span class="dt">i16</span>)</span>
<span id="solution-helpers-91"><a href="#solution-helpers-91" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>chain(once(<span class="dv">0</span>))</span>
<span id="solution-helpers-92"><a href="#solution-helpers-92" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>id<span class="op">|</span> id<span class="op">.</span>to_string())</span>
<span id="solution-helpers-93"><a href="#solution-helpers-93" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="solution-helpers-94"><a href="#solution-helpers-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>intersperse(<span class="st">&quot; &quot;</span><span class="op">.</span>into())</span>
<span id="solution-helpers-95"><a href="#solution-helpers-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>collect()</span>
<span id="solution-helpers-96"><a href="#solution-helpers-96" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-97"><a href="#solution-helpers-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-98"><a href="#solution-helpers-98" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> compute_fitness(sln<span class="op">:</span> <span class="op">&amp;</span>Solution<span class="op">,</span> _evo_config<span class="op">:</span> <span class="op">&amp;</span>EvolutionaryConfig) <span class="op">-&gt;</span> <span class="dt">u64</span> <span class="op">{</span></span>
<span id="solution-helpers-99"><a href="#solution-helpers-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sat_clauses<span class="op">:</span> <span class="dt">u32</span> <span class="op">=</span> sln<span class="op">.</span>inst<span class="op">.</span>clauses<span class="op">.</span>iter()</span>
<span id="solution-helpers-100"><a href="#solution-helpers-100" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>clause<span class="op">|</span></span>
<span id="solution-helpers-101"><a href="#solution-helpers-101" aria-hidden="true" tabindex="-1"></a>            clause<span class="op">.</span>iter()<span class="op">.</span>all(<span class="op">|&amp;</span>Literal(pos<span class="op">,</span> id)<span class="op">|</span></span>
<span id="solution-helpers-102"><a href="#solution-helpers-102" aria-hidden="true" tabindex="-1"></a>                pos <span class="op">==</span> sln<span class="op">.</span>cfg[id<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">usize</span> <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="solution-helpers-103"><a href="#solution-helpers-103" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="solution-helpers-104"><a href="#solution-helpers-104" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="solution-helpers-105"><a href="#solution-helpers-105" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>sat<span class="op">|</span> sat <span class="kw">as</span> <span class="dt">u32</span>)</span>
<span id="solution-helpers-106"><a href="#solution-helpers-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>sum()<span class="op">;</span></span>
<span id="solution-helpers-107"><a href="#solution-helpers-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-108"><a href="#solution-helpers-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sat_component <span class="op">=</span> (<span class="dv">1u32</span> <span class="op">&lt;&lt;</span> <span class="dv">12</span>) <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solution-helpers-109"><a href="#solution-helpers-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> weight_component <span class="op">=</span> (<span class="dv">1u32</span> <span class="op">&lt;&lt;</span> <span class="dv">8</span>) <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solution-helpers-110"><a href="#solution-helpers-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> score <span class="op">=</span> sat_component <span class="op">*</span> sat_clauses <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> sln<span class="op">.</span>inst<span class="op">.</span>clauses<span class="op">.</span>len() <span class="kw">as</span> <span class="dt">f64</span></span>
<span id="solution-helpers-111"><a href="#solution-helpers-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> weight_component <span class="op">*</span> sln<span class="op">.</span>weight <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> sln<span class="op">.</span>inst<span class="op">.</span>total_weight <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="solution-helpers-112"><a href="#solution-helpers-112" aria-hidden="true" tabindex="-1"></a>    score <span class="kw">as</span> <span class="dt">u64</span></span>
<span id="solution-helpers-113"><a href="#solution-helpers-113" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="solution-helpers-114"><a href="#solution-helpers-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="solution-helpers-115"><a href="#solution-helpers-115" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> satisfied(clauses<span class="op">:</span> <span class="op">&amp;</span>ArrayVec<span class="op">&lt;</span>Clause<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;,</span> cfg<span class="op">:</span> <span class="op">&amp;</span>Config) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="solution-helpers-116"><a href="#solution-helpers-116" aria-hidden="true" tabindex="-1"></a>    clauses<span class="op">.</span>iter()<span class="op">.</span>all(<span class="op">|</span>clause<span class="op">|</span> clause</span>
<span id="solution-helpers-117"><a href="#solution-helpers-117" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>iter()</span>
<span id="solution-helpers-118"><a href="#solution-helpers-118" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>any(<span class="op">|&amp;</span>Literal(pos<span class="op">,</span> id)<span class="op">|</span> pos <span class="op">==</span> cfg[id<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">usize</span> <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="solution-helpers-119"><a href="#solution-helpers-119" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="solution-helpers-120"><a href="#solution-helpers-120" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h2 id="závěr">Závěr</h2>
<p><strong>TODO</strong></p>
<h2 id="appendix">Appendix</h2>
<p>Dodatek obsahuje nezajímavé části implementace, jako je import symbolů z knihoven.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#imports-container" aria-controls="imports-container">&lt;&lt;imports&gt;&gt;=</button>
<div id="imports-container" class="collapse">
<div class="sourceCode" id="imports" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="imports-1"><a href="#imports-1" aria-hidden="true" tabindex="-1"></a><span class="at">#![</span>feature<span class="at">(</span>iter_intersperse<span class="at">)]</span></span>
<span id="imports-2"><a href="#imports-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="imports-3"><a href="#imports-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">serde::</span><span class="op">{</span>Deserialize<span class="op">,</span> Serialize<span class="op">};</span></span>
<span id="imports-4"><a href="#imports-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span>cmp<span class="op">,</span></span>
<span id="imports-5"><a href="#imports-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">ops::</span>Range<span class="op">,</span></span>
<span id="imports-6"><a href="#imports-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">str</span><span class="pp">::</span><span class="bu">FromStr</span><span class="op">,</span></span>
<span id="imports-7"><a href="#imports-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">io::</span><span class="op">{</span><span class="bu">BufRead</span><span class="op">,</span> BufReader<span class="op">},</span></span>
<span id="imports-8"><a href="#imports-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">collections::</span><span class="op">{</span>HashMap<span class="op">},</span></span>
<span id="imports-9"><a href="#imports-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">fs::</span><span class="op">{</span>read_dir<span class="op">,</span> File<span class="op">,</span> DirEntry<span class="op">},</span></span>
<span id="imports-10"><a href="#imports-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">num::</span>NonZeroU16<span class="op">,</span></span>
<span id="imports-11"><a href="#imports-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="imports-12"><a href="#imports-12" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span>Context<span class="op">,</span> <span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="imports-13"><a href="#imports-13" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">bitvec::prelude::</span>BitArr<span class="op">;</span></span>
<span id="imports-14"><a href="#imports-14" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">arrayvec::</span>ArrayVec<span class="op">;</span></span>
<span id="imports-15"><a href="#imports-15" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">rand::prelude::</span>SliceRandom<span class="op">;</span></span>
<span id="imports-16"><a href="#imports-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="imports-17"><a href="#imports-17" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="imports-18"><a href="#imports-18" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> quickcheck_macros<span class="op">;</span></span></code></pre></div>
</div>
</div>
<p>Zpracování vstupu zajišťuje jednoduchý parser pracující řádek po řádku. Pro testy je tu parser formátu souborů s optimálními řešeními.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#parser-container" aria-controls="parser-container">&lt;&lt;parser&gt;&gt;=</button>
<div id="parser-container" class="collapse">
<div class="sourceCode" id="parser" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="parser-1"><a href="#parser-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;&lt;</span>boilerplate<span class="op">&gt;&gt;</span></span>
<span id="parser-2"><a href="#parser-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-3"><a href="#parser-3" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> parse_clauses<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="dt">String</span><span class="op">&gt;&gt;</span>(lines<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> T) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>Clause<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="parser-4"><a href="#parser-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> to_literal<span class="op">:</span> <span class="kw">fn</span>(<span class="dt">i16</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>Literal<span class="op">&gt;</span> <span class="op">=</span> <span class="op">|</span>n<span class="op">|</span> <span class="cn">Ok</span>(Literal(</span>
<span id="parser-5"><a href="#parser-5" aria-hidden="true" tabindex="-1"></a>        n<span class="op">.</span>is_positive()<span class="op">,</span> <span class="pp">NonZeroU16::</span>new(n<span class="op">.</span>abs() <span class="kw">as</span> <span class="dt">u16</span>)<span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;variables start from 1&quot;</span>))<span class="op">?</span></span>
<span id="parser-6"><a href="#parser-6" aria-hidden="true" tabindex="-1"></a>    ))<span class="op">;</span></span>
<span id="parser-7"><a href="#parser-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> clauses <span class="op">=</span> <span class="pp">ArrayVec::</span>new()<span class="op">;</span></span>
<span id="parser-8"><a href="#parser-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-9"><a href="#parser-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> line <span class="kw">in</span> lines <span class="op">{</span></span>
<span id="parser-10"><a href="#parser-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> numbers <span class="op">=</span> line<span class="op">.</span>split_whitespace()<span class="op">;</span></span>
<span id="parser-11"><a href="#parser-11" aria-hidden="true" tabindex="-1"></a>        clauses<span class="op">.</span>push([</span>
<span id="parser-12"><a href="#parser-12" aria-hidden="true" tabindex="-1"></a>            to_literal(numbers<span class="op">.</span>parse_next()<span class="op">?</span>)<span class="op">?,</span></span>
<span id="parser-13"><a href="#parser-13" aria-hidden="true" tabindex="-1"></a>            to_literal(numbers<span class="op">.</span>parse_next()<span class="op">?</span>)<span class="op">?,</span></span>
<span id="parser-14"><a href="#parser-14" aria-hidden="true" tabindex="-1"></a>            to_literal(numbers<span class="op">.</span>parse_next()<span class="op">?</span>)<span class="op">?,</span></span>
<span id="parser-15"><a href="#parser-15" aria-hidden="true" tabindex="-1"></a>        ])<span class="op">;</span></span>
<span id="parser-16"><a href="#parser-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-17"><a href="#parser-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-18"><a href="#parser-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(clauses)</span>
<span id="parser-19"><a href="#parser-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-20"><a href="#parser-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-21"><a href="#parser-21" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> parse_solution_line<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">BufRead</span><span class="op">&gt;</span>(<span class="kw">mut</span> stream<span class="op">:</span> T<span class="op">,</span> params<span class="op">:</span> InstanceParams) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>OptimalSolution<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="parser-22"><a href="#parser-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="parser-23"><a href="#parser-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> stream<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input)<span class="op">?</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="parser-24"><a href="#parser-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="cn">Ok</span>(<span class="cn">None</span>)</span>
<span id="parser-25"><a href="#parser-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-26"><a href="#parser-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-27"><a href="#parser-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> line <span class="op">=</span> input<span class="op">.</span>split_whitespace()<span class="op">;</span></span>
<span id="parser-28"><a href="#parser-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> full_id<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> line<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-29"><a href="#parser-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> id <span class="op">=</span> full_id<span class="op">.</span>split(<span class="ch">&#39;-&#39;</span>)<span class="op">.</span>skip(<span class="dv">1</span>)<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-30"><a href="#parser-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> weight <span class="op">=</span> line<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-31"><a href="#parser-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-32"><a href="#parser-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> cfg <span class="op">=</span> <span class="pp">Config::</span><span class="kw">default</span>()<span class="op">;</span></span>
<span id="parser-33"><a href="#parser-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="parser-34"><a href="#parser-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="parser-35"><a href="#parser-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a<span class="op">:</span> <span class="dt">i16</span> <span class="op">=</span> line<span class="op">.</span>parse_next()<span class="op">?;</span></span>
<span id="parser-36"><a href="#parser-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> a <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span> <span class="kw">break</span> <span class="op">}</span></span>
<span id="parser-37"><a href="#parser-37" aria-hidden="true" tabindex="-1"></a>        cfg<span class="op">.</span>set(i<span class="op">,</span> a<span class="op">.</span>is_positive())<span class="op">;</span></span>
<span id="parser-38"><a href="#parser-38" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="parser-39"><a href="#parser-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-40"><a href="#parser-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-41"><a href="#parser-41" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(<span class="cn">Some</span>(OptimalSolution <span class="op">{</span>full_id<span class="op">,</span> id<span class="op">,</span> weight<span class="op">,</span> cfg<span class="op">,</span> params<span class="op">}</span>))</span>
<span id="parser-42"><a href="#parser-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-43"><a href="#parser-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-44"><a href="#parser-44" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> load_instances(set<span class="op">:</span> <span class="dt">char</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="parser-45"><a href="#parser-45" aria-hidden="true" tabindex="-1"></a>    read_dir(<span class="st">&quot;../data/&quot;</span>)<span class="op">?.</span>filter_map(<span class="op">|</span>entry<span class="op">|</span> entry<span class="op">.</span>ok()</span>
<span id="parser-46"><a href="#parser-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>entry<span class="op">|</span></span>
<span id="parser-47"><a href="#parser-47" aria-hidden="true" tabindex="-1"></a>            entry<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap()<span class="op">.</span>ends_with(<span class="op">&amp;</span>(set<span class="op">.</span>to_string() <span class="op">+</span> <span class="st">&quot;1&quot;</span>))</span>
<span id="parser-48"><a href="#parser-48" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="parser-49"><a href="#parser-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>and_then(<span class="op">|</span>entry<span class="op">|</span></span>
<span id="parser-50"><a href="#parser-50" aria-hidden="true" tabindex="-1"></a>            entry<span class="op">.</span>file_type()<span class="op">.</span>ok()<span class="op">.</span>filter(<span class="op">|&amp;</span>typ<span class="op">|</span> typ<span class="op">.</span>is_dir())<span class="op">.</span>and(<span class="cn">Some</span>(entry))</span>
<span id="parser-51"><a href="#parser-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="parser-52"><a href="#parser-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="parser-53"><a href="#parser-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>flat_map(<span class="op">|</span>dir<span class="op">|</span> <span class="op">{</span></span>
<span id="parser-54"><a href="#parser-54" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> params <span class="op">=</span> params_from_filename(<span class="op">&amp;</span>dir<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap())<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="parser-55"><a href="#parser-55" aria-hidden="true" tabindex="-1"></a>        read_dir(dir<span class="op">.</span>path())<span class="op">.</span>into_iter()</span>
<span id="parser-56"><a href="#parser-56" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>flatten()<span class="op">.</span>flatten()</span>
<span id="parser-57"><a href="#parser-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>map(<span class="kw">move</span> <span class="op">|</span>file<span class="op">|</span> (params<span class="op">,</span> file))</span>
<span id="parser-58"><a href="#parser-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)</span>
<span id="parser-59"><a href="#parser-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>map(<span class="op">|</span>(_params<span class="op">,</span> file)<span class="op">|</span> <span class="op">{</span></span>
<span id="parser-60"><a href="#parser-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> id <span class="op">=</span> file<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap()<span class="op">.</span>split(<span class="ch">&#39;-&#39;</span>)</span>
<span id="parser-61"><a href="#parser-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>nth(<span class="dv">1</span>)<span class="op">.</span>unwrap()<span class="op">.</span>split(<span class="ch">&#39;.&#39;</span>)<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">.</span>parse()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="parser-62"><a href="#parser-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-63"><a href="#parser-63" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> lines <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">.</span>unwrap())</span>
<span id="parser-64"><a href="#parser-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>lines()</span>
<span id="parser-65"><a href="#parser-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>map(<span class="op">|</span>l<span class="op">|</span> l<span class="op">.</span>unwrap())<span class="op">;</span></span>
<span id="parser-66"><a href="#parser-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-67"><a href="#parser-67" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> weights_row <span class="op">=</span> lines<span class="op">.</span>find(<span class="op">|</span>s<span class="op">|</span> s<span class="op">.</span>starts_with(<span class="ch">&#39;w&#39;</span>))</span>
<span id="parser-68"><a href="#parser-68" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;could not find the weights row&quot;</span>))<span class="op">?;</span></span>
<span id="parser-69"><a href="#parser-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-70"><a href="#parser-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> weights<span class="op">:</span> ArrayVec<span class="op">&lt;</span>NonZeroU16<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;</span> <span class="op">=</span> weights_row</span>
<span id="parser-71"><a href="#parser-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>split_whitespace()</span>
<span id="parser-72"><a href="#parser-72" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>skip(<span class="dv">1</span>)</span>
<span id="parser-73"><a href="#parser-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>flat_map(<span class="op">|</span>w<span class="op">|</span> w <span class="co">/* will fail for w == 0 */</span><span class="op">.</span>parse()<span class="op">.</span>into_iter())<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="parser-74"><a href="#parser-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-75"><a href="#parser-75" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> lines <span class="op">=</span> lines<span class="op">.</span>filter(<span class="op">|</span>l<span class="op">|</span> <span class="op">!</span>l<span class="op">.</span>starts_with(<span class="ch">&#39;c&#39;</span>))<span class="op">;</span></span>
<span id="parser-76"><a href="#parser-76" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> clauses <span class="op">=</span> parse_clauses(<span class="op">&amp;</span><span class="kw">mut</span> lines)<span class="op">?;</span></span>
<span id="parser-77"><a href="#parser-77" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> total_weight <span class="op">=</span> weights<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> x<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">u32</span>)<span class="op">.</span>sum()<span class="op">;</span></span>
<span id="parser-78"><a href="#parser-78" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(Instance <span class="op">{</span> id<span class="op">,</span> weights<span class="op">,</span> clauses<span class="op">,</span> total_weight <span class="op">}</span>)</span>
<span id="parser-79"><a href="#parser-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)<span class="op">.</span>collect()</span>
<span id="parser-80"><a href="#parser-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-81"><a href="#parser-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-82"><a href="#parser-82" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> params_from_filename(filename<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>InstanceParams<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="parser-83"><a href="#parser-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> params <span class="op">=</span> filename[<span class="dv">3</span><span class="op">..</span>]<span class="op">.</span>split(<span class="ch">&#39;-&#39;</span>)<span class="op">.</span>take(<span class="dv">2</span>)<span class="op">.</span>map(<span class="op">|</span>n<span class="op">|</span> n<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">u16</span><span class="op">&gt;</span>())<span class="op">;</span></span>
<span id="parser-84"><a href="#parser-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> variables <span class="op">=</span> params<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">?</span> <span class="kw">as</span> <span class="dt">u8</span><span class="op">;</span></span>
<span id="parser-85"><a href="#parser-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> clauses <span class="op">=</span> params<span class="op">.</span>next()<span class="op">.</span>unwrap()<span class="op">?;</span></span>
<span id="parser-86"><a href="#parser-86" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(InstanceParams <span class="op">{</span> variables<span class="op">,</span> clauses <span class="op">}</span>)</span>
<span id="parser-87"><a href="#parser-87" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="parser-88"><a href="#parser-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-89"><a href="#parser-89" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">fn</span> load_solutions(set<span class="op">:</span> <span class="dt">char</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>HashMap<span class="op">&lt;</span>(InstanceParams<span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="parser-90"><a href="#parser-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> solutions <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="parser-91"><a href="#parser-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-92"><a href="#parser-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> files <span class="op">=</span> read_dir(<span class="st">&quot;../data/&quot;</span>)<span class="op">?</span></span>
<span id="parser-93"><a href="#parser-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>filter(<span class="op">|</span>res<span class="op">|</span> res<span class="op">.</span>as_ref()<span class="op">.</span>ok()<span class="op">.</span>filter(<span class="op">|</span>f<span class="op">|</span> <span class="op">{</span></span>
<span id="parser-94"><a href="#parser-94" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> name <span class="op">=</span> f<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="parser-95"><a href="#parser-95" aria-hidden="true" tabindex="-1"></a>            f<span class="op">.</span>file_type()<span class="op">.</span>unwrap()<span class="op">.</span>is_file() <span class="op">&amp;&amp;</span></span>
<span id="parser-96"><a href="#parser-96" aria-hidden="true" tabindex="-1"></a>            name<span class="op">.</span>ends_with(<span class="op">&amp;</span>(set<span class="op">.</span>to_string() <span class="op">+</span> <span class="st">&quot;-opt.dat&quot;</span>))</span>
<span id="parser-97"><a href="#parser-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span>)<span class="op">.</span>is_some())<span class="op">;</span></span>
<span id="parser-98"><a href="#parser-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-99"><a href="#parser-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> file <span class="kw">in</span> files <span class="op">{</span></span>
<span id="parser-100"><a href="#parser-100" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="parser-101"><a href="#parser-101" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> filename <span class="op">=</span> file<span class="op">.</span>file_name()<span class="op">.</span>into_string()<span class="op">.</span>expect(<span class="st">&quot;FS error&quot;</span>)<span class="op">;</span></span>
<span id="parser-102"><a href="#parser-102" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> params <span class="op">=</span> params_from_filename(<span class="op">&amp;</span>filename)<span class="op">?;</span></span>
<span id="parser-103"><a href="#parser-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-104"><a href="#parser-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> stream <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="parser-105"><a href="#parser-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(opt) <span class="op">=</span> parse_solution_line(<span class="op">&amp;</span><span class="kw">mut</span> stream<span class="op">,</span> params)<span class="op">?</span> <span class="op">{</span></span>
<span id="parser-106"><a href="#parser-106" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> prev <span class="op">=</span> solutions<span class="op">.</span>insert((params<span class="op">,</span> opt<span class="op">.</span>id)<span class="op">,</span> opt<span class="op">.</span>clone())<span class="op">;</span></span>
<span id="parser-107"><a href="#parser-107" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> prev<span class="op">.</span>is_some() <span class="op">{</span></span>
<span id="parser-108"><a href="#parser-108" aria-hidden="true" tabindex="-1"></a>                <span class="pp">eprintln!</span>(</span>
<span id="parser-109"><a href="#parser-109" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;WARN: solution to ({:?}, {}), full ID: {}, is not unique&quot;</span><span class="op">,</span></span>
<span id="parser-110"><a href="#parser-110" aria-hidden="true" tabindex="-1"></a>                    params<span class="op">,</span></span>
<span id="parser-111"><a href="#parser-111" aria-hidden="true" tabindex="-1"></a>                    opt<span class="op">.</span>id<span class="op">,</span></span>
<span id="parser-112"><a href="#parser-112" aria-hidden="true" tabindex="-1"></a>                    opt<span class="op">.</span>full_id<span class="op">,</span></span>
<span id="parser-113"><a href="#parser-113" aria-hidden="true" tabindex="-1"></a>                )<span class="op">;</span></span>
<span id="parser-114"><a href="#parser-114" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="parser-115"><a href="#parser-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="parser-116"><a href="#parser-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="parser-117"><a href="#parser-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="parser-118"><a href="#parser-118" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(solutions)</span>
<span id="parser-119"><a href="#parser-119" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<p>Trait <code>Boilerplate</code> definuje funkci <code>parse_next</code> pro zkrácení zápisu zpracování vstupu.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#boilerplate-container" aria-controls="boilerplate-container">&lt;&lt;boilerplate&gt;&gt;=</button>
<div id="boilerplate-container" class="collapse">
<div class="sourceCode" id="boilerplate" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="boilerplate-1"><a href="#boilerplate-1" aria-hidden="true" tabindex="-1"></a><span class="kw">trait</span> Boilerplate <span class="op">{</span></span>
<span id="boilerplate-2"><a href="#boilerplate-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> parse_next<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">FromStr</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="boilerplate-3"><a href="#boilerplate-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> <span class="op">&lt;</span>T <span class="kw">as</span> <span class="bu">FromStr</span><span class="op">&gt;</span><span class="pp">::</span><span class="cn">Err</span><span class="op">:</span> <span class="pp">std::error::</span><span class="bu">Error</span> <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span> <span class="op">+</span> <span class="ot">&#39;static</span><span class="op">;</span></span>
<span id="boilerplate-4"><a href="#boilerplate-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="boilerplate-5"><a href="#boilerplate-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="boilerplate-6"><a href="#boilerplate-6" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">,</span> Iter<span class="op">&gt;</span> Boilerplate <span class="kw">for</span> Iter <span class="kw">where</span> Iter<span class="op">:</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> <span class="dt">str</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="boilerplate-7"><a href="#boilerplate-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> parse_next<span class="op">&lt;</span>T<span class="op">:</span> <span class="bu">FromStr</span><span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>T<span class="op">&gt;</span></span>
<span id="boilerplate-8"><a href="#boilerplate-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> <span class="op">&lt;</span>T <span class="kw">as</span> <span class="bu">FromStr</span><span class="op">&gt;</span><span class="pp">::</span><span class="cn">Err</span><span class="op">:</span> <span class="pp">std::error::</span><span class="bu">Error</span> <span class="op">+</span> <span class="bu">Send</span> <span class="op">+</span> <span class="bu">Sync</span> <span class="op">+</span> <span class="ot">&#39;static</span> <span class="op">{</span></span>
<span id="boilerplate-9"><a href="#boilerplate-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="dt">str</span> <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>next()<span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;unexpected end of input&quot;</span>))<span class="op">?;</span></span>
<span id="boilerplate-10"><a href="#boilerplate-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">str</span><span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span>T<span class="op">&gt;</span>()</span>
<span id="boilerplate-11"><a href="#boilerplate-11" aria-hidden="true" tabindex="-1"></a>           <span class="op">.</span>with_context(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;cannot parse {}&quot;</span><span class="op">,</span> <span class="dt">str</span>))</span>
<span id="boilerplate-12"><a href="#boilerplate-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="boilerplate-13"><a href="#boilerplate-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3 id="měření-výkonu">Měření výkonu</h3>
<p>Benchmark z minulého úkolu postavený na knihovně <a href="https://crates.io/crates/criterion"><code>Criterion.rs</code></a> se nachází v souboru níže. Pro měření těchto experimentů ale nebyl použit.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#solver-slash-benches-slash-bench-dot-rs-container" aria-controls="solver-slash-benches-slash-bench-dot-rs-container">&lt;&lt;solver/benches/bench.rs&gt;&gt;=</button>
<div id="solver-slash-benches-slash-bench-dot-rs-container" class="collapse">
<div class="sourceCode" id="cb4" data-file="solver/benches/bench.rs" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> solver<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">solver::</span><span class="op">*;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span><span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span><span class="op">{</span><span class="pp">collections::</span>HashMap<span class="op">,</span> <span class="pp">fs::</span>File<span class="op">,</span> <span class="pp">io::</span><span class="op">{</span>BufReader<span class="op">,</span> <span class="bu">Write</span><span class="op">},</span> <span class="pp">ops::</span>Range<span class="op">,</span> <span class="pp">time::</span>Duration<span class="op">};</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">criterion::</span><span class="op">{</span>criterion_group<span class="op">,</span> criterion_main<span class="op">,</span> Criterion<span class="op">,</span> BenchmarkId<span class="op">};</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> full(c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> algs <span class="op">=</span> get_algorithms()<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> solutions <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ranges <span class="op">=</span> <span class="pp">HashMap::</span>from([</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;bb&quot;</span><span class="op">,</span>     <span class="dv">0</span><span class="op">..=</span><span class="dv">25</span>)<span class="op">,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpw&quot;</span><span class="op">,</span>    <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;dpc&quot;</span><span class="op">,</span>    <span class="dv">0</span><span class="op">..=</span><span class="dv">20</span>)<span class="op">,</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas1&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;fptas2&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">22</span>)<span class="op">,</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;greedy&quot;</span><span class="op">,</span> <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        (<span class="st">&quot;redux&quot;</span><span class="op">,</span>  <span class="dv">0</span><span class="op">..=</span><span class="dv">32</span>)<span class="op">,</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    ])<span class="op">;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> input<span class="op">:</span> HashMap<span class="op">&lt;</span>(<span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">,</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> ns <span class="op">=</span> [<span class="dv">4</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">25</span><span class="op">,</span> <span class="dv">27</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">32</span>]<span class="op">;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sets <span class="op">=</span> [<span class="st">&quot;NK&quot;</span><span class="op">,</span> <span class="st">&quot;ZKC&quot;</span><span class="op">,</span> <span class="st">&quot;ZKW&quot;</span>]<span class="op">;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> set <span class="kw">in</span> sets <span class="op">{</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        solutions<span class="op">.</span>insert(set<span class="op">,</span> load_solutions(set)<span class="op">?</span>)<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> n <span class="kw">in</span> ns <span class="op">{</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            input<span class="op">.</span>insert((set<span class="op">,</span> n)<span class="op">,</span> load_input(set<span class="op">,</span> n <span class="op">..</span> n <span class="op">+</span> <span class="dv">1</span>)<span class="op">?</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>into_iter()</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>rev()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>take(<span class="dv">100</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>collect()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    benchmark(algs<span class="op">,</span> c<span class="op">,</span> <span class="op">&amp;</span>ns<span class="op">,</span> <span class="op">&amp;</span>sets<span class="op">,</span> ranges<span class="op">,</span> solutions<span class="op">,</span> input)<span class="op">?;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> benchmark(</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    algs<span class="op">:</span> <span class="pp">std::collections::</span>BTreeMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="kw">fn</span>(<span class="op">&amp;</span>Instance) <span class="op">-&gt;</span> Solution<span class="op">&gt;,</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion<span class="op">,</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    ns<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u32</span>]<span class="op">,</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    sets<span class="op">:</span> <span class="op">&amp;</span>[<span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span>]<span class="op">,</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    ranges<span class="op">:</span> HashMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="pp">std::ops::</span>RangeInclusive<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;&gt;,</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">:</span> HashMap<span class="op">&lt;&amp;</span><span class="dt">str</span><span class="op">,</span> HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;&gt;,</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    input<span class="op">:</span> HashMap<span class="op">&lt;</span>(<span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> <span class="dt">u32</span>)<span class="op">,</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="pp">anyhow::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(<span class="kw">for</span> set <span class="kw">in</span> sets <span class="op">{</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">for</span> (name<span class="op">,</span> alg) <span class="kw">in</span> algs<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> <span class="kw">mut</span> group <span class="op">=</span> c<span class="op">.</span>benchmark_group(<span class="pp">format!</span>(<span class="st">&quot;{}-{}&quot;</span><span class="op">,</span> set<span class="op">,</span> name))<span class="op">;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>            group<span class="op">.</span>sample_size(<span class="dv">10</span>)<span class="op">.</span>warm_up_time(<span class="pp">Duration::</span>from_millis(<span class="dv">200</span>))<span class="op">;</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> n <span class="kw">in</span> ns <span class="op">{</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">!</span>ranges<span class="op">.</span>get(<span class="op">*</span>name)<span class="op">.</span>filter(<span class="op">|</span>r<span class="op">|</span> r<span class="op">.</span>contains(<span class="op">&amp;</span>n))<span class="op">.</span>is_some()</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">||</span> (<span class="op">*</span>name <span class="op">==</span> <span class="st">&quot;bb&quot;</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>n <span class="op">&gt;</span> <span class="dv">22</span> <span class="op">&amp;&amp;</span> <span class="op">*</span>set <span class="op">==</span> <span class="st">&quot;ZKW&quot;</span>) <span class="op">{</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> (max<span class="op">,</span> avg<span class="op">,</span> nonzero_n) <span class="op">=</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                    measure(<span class="op">&amp;</span><span class="kw">mut</span> group<span class="op">,</span> <span class="op">*</span>alg<span class="op">,</span> <span class="op">&amp;</span>solutions[set]<span class="op">,</span> <span class="op">*</span>n<span class="op">,</span> <span class="op">&amp;</span>input[<span class="op">&amp;</span>(<span class="op">*</span>set<span class="op">,</span> <span class="op">*</span>n)])<span class="op">;</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                <span class="pp">eprintln!</span>(<span class="st">&quot;max: {}, avg: {}, n: {} vs real n: {}&quot;</span><span class="op">,</span> max<span class="op">,</span> avg<span class="op">,</span> nonzero_n<span class="op">,</span> n)<span class="op">;</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> avg <span class="op">=</span> avg <span class="op">/</span> nonzero_n <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> <span class="kw">mut</span> file <span class="op">=</span> <span class="pp">File::</span>create(<span class="pp">format!</span>(<span class="st">&quot;../docs/measurements/{}_{}_{}.txt&quot;</span><span class="op">,</span> set<span class="op">,</span> name<span class="op">,</span> n))<span class="op">?;</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>                file<span class="op">.</span>write_all(<span class="pp">format!</span>(<span class="st">&quot;max,avg</span><span class="sc">\n</span><span class="st">{},{}&quot;</span><span class="op">,</span> max<span class="op">,</span> avg)<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>            group<span class="op">.</span>finish()<span class="op">;</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> measure(</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    group<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">criterion::</span>BenchmarkGroup<span class="op">&lt;</span><span class="pp">criterion::measurement::</span>WallTime<span class="op">&gt;,</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    alg<span class="op">:</span> <span class="kw">for</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="kw">fn</span>(<span class="op">&amp;</span><span class="ot">&#39;a</span> Instance) <span class="op">-&gt;</span> Solution<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;,</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">:</span> <span class="op">&amp;</span>HashMap<span class="op">&lt;</span>(<span class="dt">u32</span><span class="op">,</span> <span class="dt">i32</span>)<span class="op">,</span> OptimalSolution<span class="op">&gt;,</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    n<span class="op">:</span> <span class="dt">u32</span><span class="op">,</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    instances<span class="op">:</span> <span class="op">&amp;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> (<span class="dt">f64</span><span class="op">,</span> <span class="dt">f64</span><span class="op">,</span> <span class="dt">u32</span>) <span class="op">{</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> stats <span class="op">=</span> (<span class="dv">0.0</span><span class="op">,</span> <span class="dv">0.0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    group<span class="op">.</span>bench_with_input(</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        <span class="pp">BenchmarkId::</span>from_parameter(n)<span class="op">,</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>        instances<span class="op">,</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span>b<span class="op">,</span> ins<span class="op">|</span> b<span class="op">.</span>iter(</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>            <span class="op">||</span> ins<span class="op">.</span>iter()<span class="op">.</span>for_each(<span class="op">|</span>inst<span class="op">|</span> <span class="op">{</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> sln <span class="op">=</span> alg(inst)<span class="op">;</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> optimal <span class="op">=</span> <span class="op">&amp;</span>solutions[<span class="op">&amp;</span>(n<span class="op">,</span> inst<span class="op">.</span>id)]<span class="op">;</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> optimal<span class="op">.</span>cost <span class="op">!=</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> error <span class="op">=</span> <span class="dv">1.0</span> <span class="op">-</span> sln<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> optimal<span class="op">.</span>cost <span class="kw">as</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> (max<span class="op">,</span> avg<span class="op">,</span> n) <span class="op">=</span> stats<span class="op">;</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>                    stats <span class="op">=</span> (<span class="kw">if</span> error <span class="op">&gt;</span> max <span class="op">{</span> error <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> max <span class="op">},</span> avg <span class="op">+</span> error<span class="op">,</span> n <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span>)</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    stats</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> load_input(set<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> r<span class="op">:</span> Range<span class="op">&lt;</span><span class="dt">u32</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> instances <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> file <span class="kw">in</span> list_input_files(set<span class="op">,</span> r)<span class="op">?</span> <span class="op">{</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> file <span class="op">=</span> file<span class="op">?;</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> r <span class="op">=</span> <span class="pp">BufReader::</span>new(<span class="pp">File::</span>open(file<span class="op">.</span>path())<span class="op">?</span>)<span class="op">;</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        <span class="kw">while</span> <span class="kw">let</span> <span class="cn">Some</span>(inst) <span class="op">=</span> parse_line(<span class="op">&amp;</span><span class="kw">mut</span> r)<span class="op">?</span> <span class="op">{</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>            instances<span class="op">.</span>push(inst)<span class="op">;</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(instances)</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> proxy(c<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Criterion) <span class="op">{</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    full(c)<span class="op">.</span>unwrap()</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="pp">criterion_group!</span>(benches<span class="op">,</span> proxy)<span class="op">;</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="pp">criterion_main!</span>(benches)<span class="op">;</span></span></code></pre></div>
</div>
</div>
<h3 id="spouštění-jednotlivých-řešičů">Spouštění jednotlivých řešičů</h3>
<p>Projekt podporuje sestavení spustitelného souboru schopného zpracovat libovolný vstup ze zadání za pomoci algoritmu zvoleného na příkazové řádce. Zdrojový kód tohoto rozhraní se nachází v souboru <code>solver/src/bin/main.rs</code>. Na standardní výstup vypisuje cenu a chybu řešení, spoléhá ovšem na to, že mezi optimálními řešeními najde i to pro kombinaci velikosti a ID zadané instance.</p>
<div class="annotated-code">
<p><span><em>«solver/src/bin/main.rs»=</em></span></p>
<div class="sourceCode" id="cb5" data-file="solver/src/bin/main.rs"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="kw">crate</span> solver<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::mem::</span>size_of<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">rayon::prelude::</span><span class="op">*;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">solver::</span><span class="op">*;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">anyhow::</span><span class="op">{</span><span class="dt">Result</span><span class="op">,</span> anyhow<span class="op">};</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> evo_config<span class="op">:</span> EvolutionaryConfig <span class="op">=</span> <span class="pp">serde_json::</span>from_str(<span class="pp">std::env::</span>args()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>get(<span class="dv">1</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>ok_or_else(<span class="op">||</span> <span class="pp">anyhow!</span>(<span class="st">&quot;Expected the evolutionary configuration in JSON format as the first argument&quot;</span>))<span class="op">?</span>)<span class="op">?;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> solutions <span class="op">=</span> load_solutions(evo_config<span class="op">.</span>set)<span class="op">?;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> rng<span class="op">:</span> <span class="pp">rand_chacha::</span>ChaCha8Rng <span class="op">=</span> <span class="pp">rand::SeedableRng::</span>seed_from_u64(<span class="dv">42</span>)<span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;info:</span><span class="sc">\n\</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Id size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Literal size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Clause size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Config size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Solution size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="st">        |   Instance size: {}</span><span class="sc">\n\</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="st">        &quot;</span><span class="op">,</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Id<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Literal<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Clause<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Config<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Solution<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="pp">size_of::</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span>()<span class="op">,</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> instances <span class="op">=</span> load_instances(evo_config<span class="op">.</span>set)<span class="op">?</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>into_par_iter()</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>map(<span class="op">|</span>inst<span class="op">|</span> (inst<span class="op">.</span>clone()<span class="op">.</span>into()<span class="op">,</span> inst))</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>(InstanceParams<span class="op">,</span> _)<span class="op">&gt;&gt;</span>()<span class="op">;</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    instances<span class="op">.</span>par_sort_unstable_by(<span class="op">|</span>(p1<span class="op">,</span> i1)<span class="op">,</span> (p2<span class="op">,</span> i2)<span class="op">|</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        p1<span class="op">.</span>cmp(p2)<span class="op">.</span>then(i1<span class="op">.</span>id<span class="op">.</span>cmp(<span class="op">&amp;</span>i2<span class="op">.</span>id))</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    solutions<span class="op">.</span>iter()<span class="op">.</span>for_each(<span class="op">|</span>((params<span class="op">,</span> _)<span class="op">,</span> opt)<span class="op">|</span> <span class="op">{</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// some instances (e.g. 33 in M1) have been removed,</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">// but their optimal solutions are still here</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(inst_index) <span class="op">=</span> instances<span class="op">.</span>binary_search_by(</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">|</span>(p<span class="op">,</span> inst)<span class="op">|</span> p<span class="op">.</span>cmp(params)<span class="op">.</span>then(inst<span class="op">.</span>id<span class="op">.</span>cmp(<span class="op">&amp;</span>opt<span class="op">.</span>id))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">{</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> inst <span class="op">=</span> <span class="op">&amp;</span>instances[inst_index]<span class="op">.</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> sln <span class="op">=</span> <span class="pp">Solution::</span>new(opt<span class="op">.</span>weight<span class="op">,</span> opt<span class="op">.</span>cfg<span class="op">,</span> inst<span class="op">,</span> <span class="op">&amp;</span>evo_config)<span class="op">;</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>            <span class="pp">assert!</span>(sln<span class="op">.</span>valid(<span class="op">&amp;</span>evo_config)<span class="op">,</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;optimal solution to instance {} is invalid (satisfied: {})</span><span class="sc">\n</span><span class="st">{}&quot;</span><span class="op">,</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                inst<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                sln<span class="op">.</span>satisfied<span class="op">,</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                opt<span class="op">.</span>dump()<span class="op">,</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>            )<span class="op">;</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    instances<span class="op">.</span>into_iter()<span class="op">.</span>take(evo_config<span class="op">.</span>n_instances <span class="kw">as</span> <span class="dt">usize</span>)<span class="op">.</span>for_each(<span class="op">|</span>(_params<span class="op">,</span> inst)<span class="op">|</span> <span class="op">{</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        <span class="kw">use</span> <span class="pp">std::time::</span>Instant<span class="op">;</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">// println!(&quot;solving {} ({:?} from set {})&quot;, inst.id, params, evo_config.set);</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> rng <span class="op">=</span> rng<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> optimal <span class="op">=</span> solutions<span class="op">.</span>get(<span class="op">&amp;</span>(inst<span class="op">.</span>clone()<span class="op">.</span>into()<span class="op">,</span> inst<span class="op">.</span>id))<span class="op">;</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> now <span class="op">=</span> <span class="pp">Instant::</span>now()<span class="op">;</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> sln <span class="op">=</span> inst<span class="op">.</span>evolutionary(<span class="op">&amp;</span><span class="kw">mut</span> rng<span class="op">,</span> evo_config<span class="op">,</span> optimal)<span class="op">;</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> time <span class="op">=</span> now<span class="op">.</span>elapsed()<span class="op">.</span>as_millis()<span class="op">;</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> error <span class="op">=</span> optimal<span class="op">.</span>map(<span class="op">|</span>opt<span class="op">|</span> <span class="dv">1.0</span> <span class="op">-</span> sln<span class="op">.</span>weight <span class="kw">as</span> <span class="dt">f64</span> <span class="op">/</span> opt<span class="op">.</span>weight <span class="kw">as</span> <span class="dt">f64</span>)<span class="op">;</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;done: {time} {id} {satisfied} {valid} {weight} {err}&quot;</span><span class="op">,</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            time <span class="op">=</span> time<span class="op">,</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>            id <span class="op">=</span> inst<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>            satisfied <span class="op">=</span> sln<span class="op">.</span>satisfied<span class="op">,</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>            valid <span class="op">=</span> sln<span class="op">.</span>valid(<span class="op">&amp;</span>evo_config)<span class="op">,</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>            weight <span class="op">=</span> sln<span class="op">.</span>weight<span class="op">,</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>            err <span class="op">=</span> error<span class="op">.</span>unwrap_or(<span class="dv">2.0</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert!</span>(<span class="op">!</span>sln<span class="op">.</span>satisfied <span class="op">||</span> sln<span class="op">.</span>valid(<span class="op">&amp;</span>evo_config)<span class="op">,</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;the following satisfied solution isn&#39;t valid! Instance {}:</span><span class="sc">\n</span><span class="st">{}&quot;</span><span class="op">,</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>            inst<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            sln<span class="op">.</span>dump()</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>        <span class="pp">assert!</span>(<span class="op">!</span>sln<span class="op">.</span>satisfied <span class="op">||</span> error<span class="op">.</span>is_none() <span class="op">||</span> error<span class="op">.</span>unwrap() <span class="op">&gt;=</span> <span class="dv">0.0</span><span class="op">,</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;the following satisfied solution has a negative error of {:?}!</span><span class="sc">\n</span><span class="st">{}</span><span class="sc">\n</span><span class="st">Instance {}:</span><span class="sc">\n</span><span class="st">{}&quot;</span><span class="op">,</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>            error<span class="op">,</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>            sln<span class="op">.</span>dump()<span class="op">,</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>            inst<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>            inst<span class="op">.</span>dump()<span class="op">,</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">// println!(&quot;ours:    {}&quot;, sln.dump());</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        <span class="co">// println!(&quot;optimal: {}\n&quot;, optimal.map(|opt| opt.dump()).unwrap_or_else(|| &quot;None&quot;.into()));</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Funkci příslušnou vybranému algoritmu vrátíme jako hodnotu tohoto bloku:</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#select-algorithm-container" aria-controls="select-algorithm-container">&lt;&lt;select-algorithm&gt;&gt;=</button>
<div id="select-algorithm-container" class="collapse">
<div class="sourceCode" id="select-algorithm" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="select-algorithm-1"><a href="#select-algorithm-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> args<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="pp">std::env::</span>args()<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="select-algorithm-2"><a href="#select-algorithm-2" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> args<span class="op">.</span>len() <span class="op">&gt;=</span> <span class="dv">2</span> <span class="op">{</span></span>
<span id="select-algorithm-3"><a href="#select-algorithm-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> alg <span class="op">=</span> <span class="op">&amp;</span>args[<span class="dv">1</span>][<span class="op">..</span>]<span class="op">;</span></span>
<span id="select-algorithm-4"><a href="#select-algorithm-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="op">&amp;</span>f) <span class="op">=</span> algorithms<span class="op">.</span>get(alg) <span class="op">{</span></span>
<span id="select-algorithm-5"><a href="#select-algorithm-5" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(Right(f))</span>
<span id="select-algorithm-6"><a href="#select-algorithm-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> alg <span class="op">==</span> <span class="st">&quot;sa&quot;</span> <span class="op">{</span> <span class="at">#[</span>allow<span class="at">(</span><span class="pp">clippy::</span>or_fun_call<span class="at">)]</span> <span class="op">{</span> <span class="co">// simulated annealing</span></span>
<span id="select-algorithm-7"><a href="#select-algorithm-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> iter <span class="op">=</span> args[<span class="dv">2</span><span class="op">..</span>]<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span><span class="dt">str</span><span class="op">|</span> <span class="op">&amp;</span><span class="dt">str</span>[<span class="op">..</span>])<span class="op">;</span></span>
<span id="select-algorithm-8"><a href="#select-algorithm-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> max_iterations <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-9"><a href="#select-algorithm-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> scaling_factor <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-10"><a href="#select-algorithm-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> temp_modifier <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-11"><a href="#select-algorithm-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> equilibrium_width <span class="op">=</span> iter<span class="op">.</span>next()<span class="op">.</span>ok_or(<span class="pp">anyhow!</span>(<span class="st">&quot;not enough params&quot;</span>))<span class="op">?.</span>parse()<span class="op">?;</span></span>
<span id="select-algorithm-12"><a href="#select-algorithm-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Ok</span>(Left((max_iterations<span class="op">,</span> scaling_factor<span class="op">,</span> temp_modifier<span class="op">,</span> equilibrium_width)))</span>
<span id="select-algorithm-13"><a href="#select-algorithm-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="select-algorithm-14"><a href="#select-algorithm-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Err</span>(<span class="pp">anyhow!</span>(<span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">{}</span><span class="sc">\&quot;</span><span class="st"> is not a known algorithm&quot;</span><span class="op">,</span> alg))</span>
<span id="select-algorithm-15"><a href="#select-algorithm-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="select-algorithm-16"><a href="#select-algorithm-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="select-algorithm-17"><a href="#select-algorithm-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(</span>
<span id="select-algorithm-18"><a href="#select-algorithm-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Usage: {} &lt;algorithm&gt;</span><span class="sc">\n\t</span><span class="st">where &lt;algorithm&gt; is one of {}</span><span class="sc">\n\t</span><span class="st">or &#39;sa&#39; for simulated annealing.&quot;</span><span class="op">,</span></span>
<span id="select-algorithm-19"><a href="#select-algorithm-19" aria-hidden="true" tabindex="-1"></a>        args[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="select-algorithm-20"><a href="#select-algorithm-20" aria-hidden="true" tabindex="-1"></a>        algorithms<span class="op">.</span>keys()<span class="op">.</span>map(<span class="bu">ToString</span><span class="pp">::</span>to_string)<span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()<span class="op">.</span>join(<span class="st">&quot;, &quot;</span>)</span>
<span id="select-algorithm-21"><a href="#select-algorithm-21" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="select-algorithm-22"><a href="#select-algorithm-22" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Err</span>(<span class="pp">anyhow!</span>(<span class="st">&quot;Expected 1 argument, got {}&quot;</span><span class="op">,</span> args<span class="op">.</span>len() <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="select-algorithm-23"><a href="#select-algorithm-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3 id="automatické-testy">Automatické testy</h3>
<p>Implementaci doplňují automatické testy k ověření správnosti, včetně property-based testu s knihovnou <a href="https://github.com/BurntSushi/quickcheck">quickcheck</a>.</p>
<div class="fold-block">
<button class="btn btn-outline-primary btn-sm fold-toggle" type="button" data-toggle="collapse" data-target="#tests-container" aria-controls="tests-container">&lt;&lt;tests&gt;&gt;=</button>
<div id="tests-container" class="collapse">
<div class="sourceCode" id="tests" style="max-height: 50vh"><pre class="sourceCode rust bootstrap-fold overflow-auto"><code class="sourceCode rust"><span id="tests-1"><a href="#tests-1" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>cfg<span class="at">(</span>test<span class="at">)]</span></span>
<span id="tests-2"><a href="#tests-2" aria-hidden="true" tabindex="-1"></a><span class="kw">mod</span> tests <span class="op">{</span></span>
<span id="tests-3"><a href="#tests-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="kw">super</span><span class="pp">::</span><span class="op">*;</span></span>
<span id="tests-4"><a href="#tests-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">use</span> <span class="pp">quickcheck::</span><span class="op">{</span>Arbitrary<span class="op">,</span> Gen<span class="op">};</span></span>
<span id="tests-5"><a href="#tests-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-6"><a href="#tests-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>derive<span class="at">(</span><span class="bu">Clone</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="tests-7"><a href="#tests-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">#[</span>repr<span class="at">(</span>transparent<span class="at">)]</span></span>
<span id="tests-8"><a href="#tests-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> ArrayVecProxy<span class="op">&lt;</span>T<span class="op">,</span> <span class="kw">const</span> CAP<span class="op">:</span> <span class="dt">usize</span><span class="op">&gt;</span>(ArrayVec<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span>)<span class="op">;</span></span>
<span id="tests-9"><a href="#tests-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-10"><a href="#tests-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> LiteralProxy <span class="op">=</span> ArrayVecProxy<span class="op">&lt;</span>Literal<span class="op">,</span> <span class="dv">3</span><span class="op">&gt;;</span></span>
<span id="tests-11"><a href="#tests-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> ClauseProxy <span class="op">=</span> ArrayVecProxy<span class="op">&lt;</span>LiteralProxy<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;;</span></span>
<span id="tests-12"><a href="#tests-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-13"><a href="#tests-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span><span class="op">&lt;</span>T<span class="op">,</span> <span class="kw">const</span> CAP<span class="op">:</span> <span class="dt">usize</span><span class="op">&gt;</span> <span class="bu">From</span><span class="op">&lt;</span>ArrayVec<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;&gt;</span> <span class="kw">for</span> ArrayVecProxy<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-14"><a href="#tests-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> from(av<span class="op">:</span> ArrayVec<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="tests-15"><a href="#tests-15" aria-hidden="true" tabindex="-1"></a>            ArrayVecProxy(av)</span>
<span id="tests-16"><a href="#tests-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-17"><a href="#tests-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-18"><a href="#tests-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-19"><a href="#tests-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span><span class="op">&lt;</span>T<span class="op">,</span> <span class="kw">const</span> CAP<span class="op">:</span> <span class="dt">usize</span><span class="op">&gt;</span> <span class="bu">From</span><span class="op">&lt;</span>ArrayVecProxy<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;&gt;</span> <span class="kw">for</span> ArrayVec<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-20"><a href="#tests-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> from(ArrayVecProxy(av)<span class="op">:</span> ArrayVecProxy<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="tests-21"><a href="#tests-21" aria-hidden="true" tabindex="-1"></a>            av</span>
<span id="tests-22"><a href="#tests-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-23"><a href="#tests-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-24"><a href="#tests-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-25"><a href="#tests-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span><span class="op">&lt;</span>T<span class="op">:</span> Arbitrary <span class="op">+</span> <span class="pp">core::fmt::</span><span class="bu">Debug</span><span class="op">,</span> <span class="kw">const</span> CAP<span class="op">:</span> <span class="dt">usize</span><span class="op">&gt;</span> Arbitrary <span class="kw">for</span> ArrayVecProxy<span class="op">&lt;</span>T<span class="op">,</span> CAP<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="tests-26"><a href="#tests-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> arbitrary(g<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Gen) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="tests-27"><a href="#tests-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> arr<span class="op">:</span> [T<span class="op">;</span> CAP] <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>arbitrary(g)</span>
<span id="tests-28"><a href="#tests-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>into_iter()</span>
<span id="tests-29"><a href="#tests-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>take(CAP)</span>
<span id="tests-30"><a href="#tests-30" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;&gt;</span>()</span>
<span id="tests-31"><a href="#tests-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>try_into()</span>
<span id="tests-32"><a href="#tests-32" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="tests-33"><a href="#tests-33" aria-hidden="true" tabindex="-1"></a>            ArrayVecProxy(arr<span class="op">.</span>into())</span>
<span id="tests-34"><a href="#tests-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-35"><a href="#tests-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-36"><a href="#tests-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> shrink(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="dt">Self</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="tests-37"><a href="#tests-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">Box</span><span class="pp">::</span>new(<span class="kw">self</span><span class="op">.</span><span class="dv">0</span><span class="op">.</span>clone()</span>
<span id="tests-38"><a href="#tests-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>into_iter()</span>
<span id="tests-39"><a href="#tests-39" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span><span class="pp">collect::</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>T<span class="op">&gt;&gt;</span>()</span>
<span id="tests-40"><a href="#tests-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>shrink()</span>
<span id="tests-41"><a href="#tests-41" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>map(<span class="op">|</span>vec<span class="op">|</span> <span class="op">{</span></span>
<span id="tests-42"><a href="#tests-42" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">let</span> arr<span class="op">:</span> [T<span class="op">;</span> CAP] <span class="op">=</span> vec<span class="op">.</span>try_into()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="tests-43"><a href="#tests-43" aria-hidden="true" tabindex="-1"></a>                    ArrayVecProxy(arr<span class="op">.</span>into())</span>
<span id="tests-44"><a href="#tests-44" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span>)</span>
<span id="tests-45"><a href="#tests-45" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="tests-46"><a href="#tests-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-47"><a href="#tests-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-48"><a href="#tests-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-49"><a href="#tests-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span> Arbitrary <span class="kw">for</span> Literal <span class="op">{</span></span>
<span id="tests-50"><a href="#tests-50" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> arbitrary(g<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Gen) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="tests-51"><a href="#tests-51" aria-hidden="true" tabindex="-1"></a>            Literal(<span class="dt">bool</span><span class="pp">::</span>arbitrary(g)<span class="op">,</span> <span class="pp">Id::</span>arbitrary(g))</span>
<span id="tests-52"><a href="#tests-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-53"><a href="#tests-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-54"><a href="#tests-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-55"><a href="#tests-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">impl</span> Arbitrary <span class="kw">for</span> Instance <span class="op">{</span></span>
<span id="tests-56"><a href="#tests-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> arbitrary(g<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Gen) <span class="op">-&gt;</span> Instance <span class="op">{</span></span>
<span id="tests-57"><a href="#tests-57" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> proxy<span class="op">:</span> ArrayVec<span class="op">&lt;</span>LiteralProxy<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;</span> <span class="op">=</span> (<span class="pp">ArrayVecProxy::</span>arbitrary(g) <span class="kw">as</span> ClauseProxy)<span class="op">.</span>into()<span class="op">;</span></span>
<span id="tests-58"><a href="#tests-58" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> weights<span class="op">:</span> ArrayVec<span class="op">&lt;</span>NonZeroU16<span class="op">,</span> MAX_VARIABLES<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">ArrayVecProxy::</span>arbitrary(g)<span class="op">.</span>into()<span class="op">;</span></span>
<span id="tests-59"><a href="#tests-59" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> total_weight <span class="op">=</span> weights<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>x<span class="op">|</span> x<span class="op">.</span>get() <span class="kw">as</span> <span class="dt">u32</span>)<span class="op">.</span>sum()<span class="op">;</span></span>
<span id="tests-60"><a href="#tests-60" aria-hidden="true" tabindex="-1"></a>            Instance <span class="op">{</span></span>
<span id="tests-61"><a href="#tests-61" aria-hidden="true" tabindex="-1"></a>                id<span class="op">:</span> <span class="dt">i32</span><span class="pp">::</span>arbitrary(g)<span class="op">,</span></span>
<span id="tests-62"><a href="#tests-62" aria-hidden="true" tabindex="-1"></a>                weights<span class="op">,</span></span>
<span id="tests-63"><a href="#tests-63" aria-hidden="true" tabindex="-1"></a>                total_weight<span class="op">,</span></span>
<span id="tests-64"><a href="#tests-64" aria-hidden="true" tabindex="-1"></a>                clauses<span class="op">:</span> proxy<span class="op">.</span>into_iter()<span class="op">.</span>map(<span class="op">|</span>clause<span class="op">|</span> clause<span class="op">.</span><span class="dv">0</span><span class="op">.</span>into_inner()<span class="op">.</span>unwrap())<span class="op">.</span>collect()<span class="op">,</span></span>
<span id="tests-65"><a href="#tests-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="tests-66"><a href="#tests-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-67"><a href="#tests-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="tests-68"><a href="#tests-68" aria-hidden="true" tabindex="-1"></a>        <span class="kw">fn</span> shrink(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="dt">Self</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="tests-69"><a href="#tests-69" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> data <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>clone()<span class="op">;</span></span>
<span id="tests-70"><a href="#tests-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">#[</span>allow<span class="at">(</span><span class="pp">clippy::</span>needless_collect<span class="at">)]</span></span>
<span id="tests-71"><a href="#tests-71" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> chain<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Instance<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">quickcheck::</span>empty_shrinker()</span>
<span id="tests-72"><a href="#tests-72" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(<span class="kw">self</span><span class="op">.</span>id<span class="op">.</span>shrink()<span class="op">.</span>map(<span class="op">|</span>id<span class="op">|</span> Instance <span class="op">{</span>id<span class="op">,</span> <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone()<span class="op">}</span>))</span>
<span id="tests-73"><a href="#tests-73" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(ArrayVecProxy(<span class="kw">self</span><span class="op">.</span>weights<span class="op">.</span>clone())</span>
<span id="tests-74"><a href="#tests-74" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>shrink()</span>
<span id="tests-75"><a href="#tests-75" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>weights<span class="op">|</span> Instance <span class="op">{</span></span>
<span id="tests-76"><a href="#tests-76" aria-hidden="true" tabindex="-1"></a>                        weights<span class="op">:</span> weights<span class="op">.</span>into()<span class="op">,</span></span>
<span id="tests-77"><a href="#tests-77" aria-hidden="true" tabindex="-1"></a>                        <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone()</span>
<span id="tests-78"><a href="#tests-78" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span>)</span>
<span id="tests-79"><a href="#tests-79" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="tests-80"><a href="#tests-80" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>chain(ArrayVecProxy(</span>
<span id="tests-81"><a href="#tests-81" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">self</span><span class="op">.</span>clauses<span class="op">.</span>clone()</span>
<span id="tests-82"><a href="#tests-82" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span>into_iter()</span>
<span id="tests-83"><a href="#tests-83" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span>map(<span class="op">|</span>c<span class="op">|</span> ArrayVecProxy(c<span class="op">.</span>into()))</span>
<span id="tests-84"><a href="#tests-84" aria-hidden="true" tabindex="-1"></a>                            <span class="op">.</span>collect()</span>
<span id="tests-85"><a href="#tests-85" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="tests-86"><a href="#tests-86" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>shrink()</span>
<span id="tests-87"><a href="#tests-87" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>map(<span class="op">|</span>clauses<span class="op">|</span> <span class="op">{</span></span>
<span id="tests-88"><a href="#tests-88" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">let</span> av<span class="op">:</span> ArrayVec<span class="op">&lt;</span>LiteralProxy<span class="op">,</span> MAX_CLAUSES<span class="op">&gt;</span> <span class="op">=</span> clauses<span class="op">.</span>into()<span class="op">;</span></span>
<span id="tests-89"><a href="#tests-89" aria-hidden="true" tabindex="-1"></a>                        Instance <span class="op">{</span></span>
<span id="tests-90"><a href="#tests-90" aria-hidden="true" tabindex="-1"></a>                            clauses<span class="op">:</span> av<span class="op">.</span>into_iter()<span class="op">.</span>map(<span class="op">|</span>clause<span class="op">|</span> clause<span class="op">.</span><span class="dv">0</span><span class="op">.</span>into_inner()<span class="op">.</span>unwrap())<span class="op">.</span>collect()<span class="op">,</span></span>
<span id="tests-91"><a href="#tests-91" aria-hidden="true" tabindex="-1"></a>                            <span class="op">..</span>(<span class="op">&amp;</span>data)<span class="op">.</span>clone()</span>
<span id="tests-92"><a href="#tests-92" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="tests-93"><a href="#tests-93" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span>)</span>
<span id="tests-94"><a href="#tests-94" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span>filter(<span class="op">|</span>i<span class="op">|</span> <span class="op">!</span>i<span class="op">.</span>clauses<span class="op">.</span>is_empty())</span>
<span id="tests-95"><a href="#tests-95" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="tests-96"><a href="#tests-96" aria-hidden="true" tabindex="-1"></a>                <span class="op">.</span>collect()<span class="op">;</span></span>
<span id="tests-97"><a href="#tests-97" aria-hidden="true" tabindex="-1"></a>            <span class="dt">Box</span><span class="pp">::</span>new(chain<span class="op">.</span>into_iter())</span>
<span id="tests-98"><a href="#tests-98" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="tests-99"><a href="#tests-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="tests-100"><a href="#tests-100" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div></main>



<script type="text/javascript">
  function init() {
    var hiddenElements = document.getElementsByClassName('doctestResult');
    for (var i = 0; i < hiddenElements.length; i++) {
      var element = hiddenElements[i];
      var details = document.createElement('details');
      var summary = document.createElement('summary');
      summary.innerHTML = 'Program output';
      details.id = element.id;
      details.innerHTML = element.innerHTML;
      details.className = element.className;
      details.style.display = 'block';
      details.appendChild(summary);
      element.parentNode.replaceChild(details, element);
    }
  }

  // when the page is loaded, run init
  document.addEventListener('DOMContentLoaded', init);
</script>

<!-- Bootstrap 4.5.0 -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

<!-- Mathjax -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>
